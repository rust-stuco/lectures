<!DOCTYPE html><html lang="en-US"><head><title>Ownership Revisited</title><meta property="og:title" content="Ownership Revisited"><meta charset="UTF-8"><meta name="viewport" content="width=device-width,height=device-height,initial-scale=1.0"><meta name="apple-mobile-web-app-capable" content="yes"><meta http-equiv="X-UA-Compatible" content="ie=edge"><meta property="og:type" content="website"><meta name="twitter:card" content="summary"><style>@media screen{body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button,body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container button,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container button{appearance:none;background-color:initial;border:0;color:inherit;cursor:pointer;font-size:inherit;opacity:.8;outline:none;padding:0;transition:opacity .2s linear;-webkit-tap-highlight-color:transparent}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button:disabled,body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button:disabled,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container button:disabled,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container button:disabled{cursor:not-allowed;opacity:.15!important}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button:hover,body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button:hover,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container button:hover,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container button:hover{opacity:1}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button:hover:active,body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button:hover:active,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container button:hover:active,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container button:hover:active{opacity:.6}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button:hover:not(:disabled),body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button:hover:not(:disabled),body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container button:hover:not(:disabled),body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container button:hover:not(:disabled){transition:none}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=prev],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=prev],body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container button.bespoke-marp-presenter-info-page-prev{background:#0000 url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiNmZmYiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgc3Ryb2tlLXdpZHRoPSI1IiBkPSJNNjggOTAgMjggNTBsNDAtNDAiLz48L3N2Zz4=") no-repeat 50%;background-size:contain;overflow:hidden;text-indent:100%;white-space:nowrap}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=next],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=next],body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container button.bespoke-marp-presenter-info-page-next{background:#0000 url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiNmZmYiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgc3Ryb2tlLXdpZHRoPSI1IiBkPSJtMzIgOTAgNDAtNDAtNDAtNDAiLz48L3N2Zz4=") no-repeat 50%;background-size:contain;overflow:hidden;text-indent:100%;white-space:nowrap}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=fullscreen],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=fullscreen]{background:#0000 url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48ZGVmcz48c3R5bGU+LmF7ZmlsbDpub25lO3N0cm9rZTojZmZmO3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2Utd2lkdGg6NXB4fTwvc3R5bGU+PC9kZWZzPjxyZWN0IHdpZHRoPSI4MCIgaGVpZ2h0PSI2MCIgeD0iMTAiIHk9IjIwIiBjbGFzcz0iYSIgcng9IjUuNjciLz48cGF0aCBkPSJNNDAgNzBIMjBWNTBtMjAgMEwyMCA3MG00MC00MGgyMHYyMG0tMjAgMCAyMC0yMCIgY2xhc3M9ImEiLz48L3N2Zz4=") no-repeat 50%;background-size:contain;overflow:hidden;text-indent:100%;white-space:nowrap}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button.exit[data-bespoke-marp-osc=fullscreen],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button.exit[data-bespoke-marp-osc=fullscreen]{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48ZGVmcz48c3R5bGU+LmF7ZmlsbDpub25lO3N0cm9rZTojZmZmO3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2Utd2lkdGg6NXB4fTwvc3R5bGU+PC9kZWZzPjxyZWN0IHdpZHRoPSI4MCIgaGVpZ2h0PSI2MCIgeD0iMTAiIHk9IjIwIiBjbGFzcz0iYSIgcng9IjUuNjciLz48cGF0aCBkPSJNMjAgNTBoMjB2MjBtLTIwIDAgMjAtMjBtNDAgMEg2MFYzMG0yMCAwTDYwIDUwIiBjbGFzcz0iYSIvPjwvc3ZnPg==")}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=presenter],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=presenter]{background:#0000 url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiNmZmYiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgc3Ryb2tlLXdpZHRoPSI1IiBkPSJNODcuOCA0Ny41Qzg5IDUwIDg3LjcgNTIgODUgNTJIMzVhOC43IDguNyAwIDAgMS03LjItNC41bC0xNS42LTMxQzExIDE0IDEyLjIgMTIgMTUgMTJoNTBhOC44IDguOCAwIDAgMSA3LjIgNC41ek02MCA1MnYzNm0tMTAgMGgyME00NSA0MmgyMCIvPjwvc3ZnPg==") no-repeat 50%;background-size:contain;overflow:hidden;text-indent:100%;white-space:nowrap}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container button.bespoke-marp-presenter-note-bigger{background:#0000 url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48cGF0aCBzdHJva2U9IiNmZmYiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgc3Ryb2tlLXdpZHRoPSI1IiBkPSJNMTIgNTBoODBNNTIgOTBWMTAiLz48L3N2Zz4=") no-repeat 50%;background-size:contain;overflow:hidden;text-indent:100%;white-space:nowrap}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container button.bespoke-marp-presenter-note-smaller{background:#0000 url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiNmZmYiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgc3Ryb2tlLXdpZHRoPSI1IiBkPSJNMTIgNTBoODAiLz48L3N2Zz4=") no-repeat 50%;background-size:contain;overflow:hidden;text-indent:100%;white-space:nowrap}}@keyframes __bespoke_marp_transition_reduced_outgoing__{0%{opacity:1}to{opacity:0}}@keyframes __bespoke_marp_transition_reduced_incoming__{0%{mix-blend-mode:plus-lighter;opacity:0}to{mix-blend-mode:plus-lighter;opacity:1}}.bespoke-marp-note,.bespoke-marp-osc,.bespoke-progress-parent{display:none;transition:none}@media screen{::view-transition-group(*){animation-duration:var(--marp-bespoke-transition-animation-duration,.5s);animation-timing-function:ease}::view-transition-new(*),::view-transition-old(*){animation-delay:0s;animation-direction:var(--marp-bespoke-transition-animation-direction,normal);animation-duration:var(--marp-bespoke-transition-animation-duration,.5s);animation-fill-mode:both;animation-name:var(--marp-bespoke-transition-animation-name,var(--marp-bespoke-transition-animation-name-fallback,__bespoke_marp_transition_no_animation__));mix-blend-mode:normal}::view-transition-old(*){--marp-bespoke-transition-animation-name-fallback:__bespoke_marp_transition_reduced_outgoing__;animation-timing-function:ease}::view-transition-new(*){--marp-bespoke-transition-animation-name-fallback:__bespoke_marp_transition_reduced_incoming__;animation-timing-function:ease}::view-transition-new(root),::view-transition-old(root){animation-timing-function:linear}::view-transition-new(__bespoke_marp_transition_osc__),::view-transition-old(__bespoke_marp_transition_osc__){animation-duration:0s!important;animation-name:__bespoke_marp_transition_osc__!important}::view-transition-new(__bespoke_marp_transition_osc__){opacity:0!important}.bespoke-marp-transition-warming-up::view-transition-group(*),.bespoke-marp-transition-warming-up::view-transition-new(*),.bespoke-marp-transition-warming-up::view-transition-old(*){animation-play-state:paused!important}body,html{height:100%;margin:0}body{background:#000;overflow:hidden}svg.bespoke-marp-slide{content-visibility:hidden;opacity:0;pointer-events:none;z-index:-1}svg.bespoke-marp-slide:not(.bespoke-marp-active) *{view-transition-name:none!important}svg.bespoke-marp-slide.bespoke-marp-active{content-visibility:visible;opacity:1;pointer-events:auto;z-index:0}svg.bespoke-marp-slide.bespoke-marp-active.bespoke-marp-active-ready *{animation-name:__bespoke_marp__!important}@supports not (content-visibility:hidden){svg.bespoke-marp-slide[data-bespoke-marp-load=hideable]{display:none}svg.bespoke-marp-slide[data-bespoke-marp-load=hideable].bespoke-marp-active{display:block}}}@media screen and (prefers-reduced-motion:reduce){svg.bespoke-marp-slide *{view-transition-name:none!important}}@media screen{[data-bespoke-marp-fragment=inactive]{visibility:hidden}body[data-bespoke-view=""] .bespoke-marp-parent,body[data-bespoke-view=next] .bespoke-marp-parent{inset:0;position:absolute}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc,body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc{background:#000000a6;border-radius:7px;bottom:50px;color:#fff;contain:paint;display:block;font-family:Helvetica,Arial,sans-serif;font-size:16px;left:50%;line-height:0;opacity:1;padding:12px;position:absolute;touch-action:manipulation;transform:translateX(-50%);transition:opacity .2s linear;-webkit-user-select:none;user-select:none;white-space:nowrap;will-change:transform;z-index:1;view-transition-name:__bespoke_marp_transition_osc__}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>*,body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>*{margin-left:6px}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>:first-child,body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>:first-child{margin-left:0}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>span,body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>span{opacity:.8}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>span[data-bespoke-marp-osc=page],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>span[data-bespoke-marp-osc=page]{display:inline-block;min-width:140px;text-align:center}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=fullscreen],body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=next],body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=presenter],body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=prev],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=fullscreen],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=next],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=presenter],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=prev]{height:32px;line-height:32px;width:32px}body[data-bespoke-view=""] .bespoke-marp-parent.bespoke-marp-inactive,body[data-bespoke-view=next] .bespoke-marp-parent.bespoke-marp-inactive{cursor:none}body[data-bespoke-view=""] .bespoke-marp-parent.bespoke-marp-inactive>.bespoke-marp-osc,body[data-bespoke-view=next] .bespoke-marp-parent.bespoke-marp-inactive>.bespoke-marp-osc{opacity:0;pointer-events:none}body[data-bespoke-view=""] svg.bespoke-marp-slide,body[data-bespoke-view=next] svg.bespoke-marp-slide{height:100%;left:0;position:absolute;top:0;width:100%}body[data-bespoke-view=""] .bespoke-progress-parent{background:#222;display:flex;height:5px;width:100%}body[data-bespoke-view=""] .bespoke-progress-parent+.bespoke-marp-parent{top:5px}body[data-bespoke-view=""] .bespoke-progress-parent .bespoke-progress-bar{background:#0288d1;flex:0 0 0;transition:flex-basis .2s cubic-bezier(0,1,1,1)}body[data-bespoke-view=next]{background:#0000}body[data-bespoke-view=presenter]{background:#161616}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container{display:grid;font-family:Helvetica,Arial,sans-serif;grid-template:"current dragbar next" minmax(140px,1fr) "current dragbar note" 2fr "info    dragbar note" 3em;grid-template-columns:minmax(3px,var(--bespoke-marp-presenter-split-ratio,66%)) 0 minmax(3px,1fr);height:100%;left:0;position:absolute;top:0;width:100%}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-parent{grid-area:current;overflow:hidden;position:relative}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-parent svg.bespoke-marp-slide{height:calc(100% - 40px);left:20px;pointer-events:none;position:absolute;top:20px;-webkit-user-select:none;user-select:none;width:calc(100% - 40px)}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-parent svg.bespoke-marp-slide.bespoke-marp-active{filter:drop-shadow(0 3px 10px rgba(0,0,0,.5))}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-dragbar-container{background:#0288d1;cursor:col-resize;grid-area:dragbar;margin-left:-3px;opacity:0;position:relative;transition:opacity .4s linear .1s;width:6px;z-index:10}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-dragbar-container:hover{opacity:1}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-dragbar-container.active{opacity:1;transition-delay:0s}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-next-container{background:#222;cursor:pointer;display:none;grid-area:next;overflow:hidden;position:relative}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-next-container.active{display:block}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-next-container iframe.bespoke-marp-presenter-next{background:#0000;border:0;display:block;filter:drop-shadow(0 3px 10px rgba(0,0,0,.5));height:calc(100% - 40px);left:20px;pointer-events:none;position:absolute;top:20px;-webkit-user-select:none;user-select:none;width:calc(100% - 40px)}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container{background:#222;color:#eee;grid-area:note;position:relative;z-index:1}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container button{height:1.5em;line-height:1.5em;width:1.5em}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-presenter-note-wrapper{display:block;inset:0;position:absolute}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-presenter-note-buttons{background:#000000a6;border-radius:4px;bottom:0;display:flex;gap:4px;margin:12px;opacity:0;padding:6px;pointer-events:none;position:absolute;right:0;transition:opacity .2s linear}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-presenter-note-buttons:focus-within,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-presenter-note-wrapper:focus-within+.bespoke-marp-presenter-note-buttons,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container:hover .bespoke-marp-presenter-note-buttons{opacity:1;pointer-events:auto}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-note{box-sizing:border-box;font-size:calc(1.1em*var(--bespoke-marp-note-font-scale, 1));height:calc(100% - 40px);margin:20px;overflow:auto;padding-right:3px;white-space:pre-wrap;width:calc(100% - 40px);word-wrap:break-word;scrollbar-color:#eeeeee80 #0000;scrollbar-width:thin}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-note::-webkit-scrollbar{width:6px}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-note::-webkit-scrollbar-track{background:#0000}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-note::-webkit-scrollbar-thumb{background:#eeeeee80;border-radius:6px}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-note:empty{pointer-events:none}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-note.active{display:block}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-note p:first-child{margin-top:0}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-note p:last-child{margin-bottom:0}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container{align-items:center;box-sizing:border-box;color:#eee;display:flex;flex-wrap:nowrap;grid-area:info;justify-content:center;overflow:hidden;padding:0 10px}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container .bespoke-marp-presenter-info-page,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container .bespoke-marp-presenter-info-time,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container .bespoke-marp-presenter-info-timer{box-sizing:border-box;display:block;padding:0 10px;white-space:nowrap;width:100%}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container button{height:1.5em;line-height:1.5em;width:1.5em}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container .bespoke-marp-presenter-info-page{order:2;text-align:center}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container .bespoke-marp-presenter-info-page .bespoke-marp-presenter-info-page-text{display:inline-block;min-width:120px;text-align:center}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container .bespoke-marp-presenter-info-time{color:#999;order:1;text-align:left}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container .bespoke-marp-presenter-info-timer{color:#999;order:3;text-align:right}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container .bespoke-marp-presenter-info-timer:hover{cursor:pointer}}@media print{.bespoke-marp-presenter-info-container,.bespoke-marp-presenter-next-container,.bespoke-marp-presenter-note-container{display:none}}</style><style>@import url('https://fonts.googleapis.com/css2?family=Zilla+Slab:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap');@import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Mono:wght@100..900&family=Noto+Sans:ital,wght@0,100..900;1,100..900&display=swap');div#\:\$p > svg > foreignObject > section{width:1280px;height:720px;box-sizing:border-box;overflow:hidden;position:relative;scroll-snap-align:center center;-webkit-text-size-adjust:100%;text-size-adjust:100%}div#\:\$p > svg > foreignObject > section::after{bottom:0;content:attr(data-marpit-pagination);padding:inherit;pointer-events:none;position:absolute;right:0}div#\:\$p > svg > foreignObject > section:not([data-marpit-pagination])::after{display:none}div#\:\$p > svg > foreignObject > section :is(h1, marp-h1){font-size:2em;margin-block:0.67em}div#\:\$p > svg > foreignObject > section video::-webkit-media-controls{will-change:transform}@page {size:1280px 720px;margin:0}@media print{html, body{background-color:#fff;margin:0;page-break-inside:avoid;break-inside:avoid-page}div#\:\$p > svg > foreignObject > section{page-break-before:always;break-before:page}div#\:\$p > svg > foreignObject > section, div#\:\$p > svg > foreignObject > section *{-webkit-print-color-adjust:exact!important;animation-delay:0s!important;animation-duration:0s!important;color-adjust:exact!important;print-color-adjust:exact!important;transition:none!important}div#\:\$p > svg[data-marpit-svg]{display:block;height:100vh;width:100vw}}/*!
 * Marp default theme.
 *
 * @theme default
 * @author Yuki Hattori
 *
 * @auto-scaling true
 * @size 16:9 1280px 720px
 * @size 4:3 960px 720px
 */div#\:\$p > svg > foreignObject > section{--base-size-4:calc(var(--marpit-root-font-size, 1rem) * 0.25);--base-size-8:calc(var(--marpit-root-font-size, 1rem) * 0.5);--base-size-16:calc(var(--marpit-root-font-size, 1rem) * 1);--base-size-24:calc(var(--marpit-root-font-size, 1rem) * 1.5);--base-size-40:calc(var(--marpit-root-font-size, 1rem) * 2.5);--base-text-weight-normal:400;--base-text-weight-medium:500;--base-text-weight-semibold:600;--fontStack-monospace:ui-monospace, SFMono-Regular, SF Mono, Menlo, Consolas, Liberation Mono, monospace;--fgColor-accent:Highlight;}div#\:\$p > svg > foreignObject > section [data-theme=light],div#\:\$p > svg > foreignObject > section{color-scheme:light;--focus-outlineColor:#0969da;--fgColor-default:#1f2328;--fgColor-muted:#59636e;--fgColor-accent:#0969da;--fgColor-success:#1a7f37;--fgColor-attention:#9a6700;--fgColor-danger:#d1242f;--fgColor-done:#8250df;--bgColor-default:#fff;--bgColor-muted:#f6f8fa;--bgColor-neutral-muted:#818b981f;--bgColor-attention-muted:#fff8c5;--borderColor-default:#d1d9e0;--borderColor-muted:#d1d9e0b3;--borderColor-neutral-muted:#d1d9e0b3;--borderColor-accent-emphasis:#0969da;--borderColor-success-emphasis:#1a7f37;--borderColor-attention-emphasis:#9a6700;--borderColor-danger-emphasis:#cf222e;--borderColor-done-emphasis:#8250df;--color-prettylights-syntax-comment:#59636e;--color-prettylights-syntax-constant:#0550ae;--color-prettylights-syntax-constant-other-reference-link:#0a3069;--color-prettylights-syntax-entity:#6639ba;--color-prettylights-syntax-storage-modifier-import:#1f2328;--color-prettylights-syntax-entity-tag:#0550ae;--color-prettylights-syntax-keyword:#cf222e;--color-prettylights-syntax-string:#0a3069;--color-prettylights-syntax-variable:#953800;--color-prettylights-syntax-brackethighlighter-unmatched:#82071e;--color-prettylights-syntax-brackethighlighter-angle:#59636e;--color-prettylights-syntax-invalid-illegal-text:#f6f8fa;--color-prettylights-syntax-invalid-illegal-bg:#82071e;--color-prettylights-syntax-carriage-return-text:#f6f8fa;--color-prettylights-syntax-carriage-return-bg:#cf222e;--color-prettylights-syntax-string-regexp:#116329;--color-prettylights-syntax-markup-list:#3b2300;--color-prettylights-syntax-markup-heading:#0550ae;--color-prettylights-syntax-markup-italic:#1f2328;--color-prettylights-syntax-markup-bold:#1f2328;--color-prettylights-syntax-markup-deleted-text:#82071e;--color-prettylights-syntax-markup-deleted-bg:#ffebe9;--color-prettylights-syntax-markup-inserted-text:#116329;--color-prettylights-syntax-markup-inserted-bg:#dafbe1;--color-prettylights-syntax-markup-changed-text:#953800;--color-prettylights-syntax-markup-changed-bg:#ffd8b5;--color-prettylights-syntax-markup-ignored-text:#d1d9e0;--color-prettylights-syntax-markup-ignored-bg:#0550ae;--color-prettylights-syntax-meta-diff-range:#8250df;--color-prettylights-syntax-sublimelinter-gutter-mark:#818b98;}div#\:\$p > svg > foreignObject > section [data-theme=dark],div#\:\$p > svg > foreignObject > section:where(.invert){color-scheme:dark;--focus-outlineColor:#1f6feb;--fgColor-default:#f0f6fc;--fgColor-muted:#9198a1;--fgColor-accent:#4493f8;--fgColor-success:#3fb950;--fgColor-attention:#d29922;--fgColor-danger:#f85149;--fgColor-done:#ab7df8;--bgColor-default:#0d1117;--bgColor-muted:#151b23;--bgColor-neutral-muted:#656c7633;--bgColor-attention-muted:#bb800926;--borderColor-default:#3d444d;--borderColor-muted:#3d444db3;--borderColor-neutral-muted:#3d444db3;--borderColor-accent-emphasis:#1f6feb;--borderColor-success-emphasis:#238636;--borderColor-attention-emphasis:#9e6a03;--borderColor-danger-emphasis:#da3633;--borderColor-done-emphasis:#8957e5;--color-prettylights-syntax-comment:#9198a1;--color-prettylights-syntax-constant:#79c0ff;--color-prettylights-syntax-constant-other-reference-link:#a5d6ff;--color-prettylights-syntax-entity:#d2a8ff;--color-prettylights-syntax-storage-modifier-import:#f0f6fc;--color-prettylights-syntax-entity-tag:#7ee787;--color-prettylights-syntax-keyword:#ff7b72;--color-prettylights-syntax-string:#a5d6ff;--color-prettylights-syntax-variable:#ffa657;--color-prettylights-syntax-brackethighlighter-unmatched:#f85149;--color-prettylights-syntax-brackethighlighter-angle:#9198a1;--color-prettylights-syntax-invalid-illegal-text:#f0f6fc;--color-prettylights-syntax-invalid-illegal-bg:#8e1519;--color-prettylights-syntax-carriage-return-text:#f0f6fc;--color-prettylights-syntax-carriage-return-bg:#b62324;--color-prettylights-syntax-string-regexp:#7ee787;--color-prettylights-syntax-markup-list:#f2cc60;--color-prettylights-syntax-markup-heading:#1f6feb;--color-prettylights-syntax-markup-italic:#f0f6fc;--color-prettylights-syntax-markup-bold:#f0f6fc;--color-prettylights-syntax-markup-deleted-text:#ffdcd7;--color-prettylights-syntax-markup-deleted-bg:#67060c;--color-prettylights-syntax-markup-inserted-text:#aff5b4;--color-prettylights-syntax-markup-inserted-bg:#033a16;--color-prettylights-syntax-markup-changed-text:#ffdfb6;--color-prettylights-syntax-markup-changed-bg:#5a1e02;--color-prettylights-syntax-markup-ignored-text:#f0f6fc;--color-prettylights-syntax-markup-ignored-bg:#1158c7;--color-prettylights-syntax-meta-diff-range:#d2a8ff;--color-prettylights-syntax-sublimelinter-gutter-mark:#3d444d;}div#\:\$p > svg > foreignObject > section{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;background-color:var(--bgColor-default);color:var(--fgColor-default);font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Noto Sans,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji;font-size:16px;line-height:1.5;margin:0;word-wrap:break-word}div#\:\$p > svg > foreignObject > section{--marpit-root-font-size:16px;}div#\:\$p > svg > foreignObject > section :is(h1, marp-h1):hover .anchor .octicon-link:before,div#\:\$p > svg > foreignObject > section :is(h2, marp-h2):hover .anchor .octicon-link:before,div#\:\$p > svg > foreignObject > section :is(h3, marp-h3):hover .anchor .octicon-link:before,div#\:\$p > svg > foreignObject > section :is(h4, marp-h4):hover .anchor .octicon-link:before,div#\:\$p > svg > foreignObject > section :is(h5, marp-h5):hover .anchor .octicon-link:before,div#\:\$p > svg > foreignObject > section :is(h6, marp-h6):hover .anchor .octicon-link:before{background-color:currentColor;content:" ";display:inline-block;height:16px;-webkit-mask-image:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 0 0 1.06 1.06l1.25-1.25a2 2 0 1 1 2.83 2.83l-2.5 2.5a2 2 0 0 1-2.83 0 .75.75 0 0 0-1.06 1.06 3.5 3.5 0 0 0 4.95 0l2.5-2.5a3.5 3.5 0 0 0-4.95-4.95zm-4.69 9.64a2 2 0 0 1 0-2.83l2.5-2.5a2 2 0 0 1 2.83 0 .75.75 0 0 0 1.06-1.06 3.5 3.5 0 0 0-4.95 0l-2.5 2.5a3.5 3.5 0 0 0 4.95 4.95l1.25-1.25a.75.75 0 0 0-1.06-1.06l-1.25 1.25a2 2 0 0 1-2.83 0"/></svg>');mask-image:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 0 0 1.06 1.06l1.25-1.25a2 2 0 1 1 2.83 2.83l-2.5 2.5a2 2 0 0 1-2.83 0 .75.75 0 0 0-1.06 1.06 3.5 3.5 0 0 0 4.95 0l2.5-2.5a3.5 3.5 0 0 0-4.95-4.95zm-4.69 9.64a2 2 0 0 1 0-2.83l2.5-2.5a2 2 0 0 1 2.83 0 .75.75 0 0 0 1.06-1.06 3.5 3.5 0 0 0-4.95 0l-2.5 2.5a3.5 3.5 0 0 0 4.95 4.95l1.25-1.25a.75.75 0 0 0-1.06-1.06l-1.25 1.25a2 2 0 0 1-2.83 0"/></svg>');width:16px}div#\:\$p > svg > foreignObject > section details,div#\:\$p > svg > foreignObject > section figcaption,div#\:\$p > svg > foreignObject > section figure{display:block}div#\:\$p > svg > foreignObject > section summary{display:list-item}div#\:\$p > svg > foreignObject > section [hidden]{display:none!important}div#\:\$p > svg > foreignObject > section a{background-color:transparent;color:var(--fgColor-accent);text-decoration:none}div#\:\$p > svg > foreignObject > section abbr[title]{border-bottom:none;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}div#\:\$p > svg > foreignObject > section b,div#\:\$p > svg > foreignObject > section strong{font-weight:var(--base-text-weight-semibold, 600)}div#\:\$p > svg > foreignObject > section dfn{font-style:italic}div#\:\$p > svg > foreignObject > section :is(h1, marp-h1){border-bottom:1px solid var(--borderColor-muted);font-size:2em;font-weight:var(--base-text-weight-semibold, 600);margin:.67em 0;padding-bottom:.3em}div#\:\$p > svg > foreignObject > section mark{background-color:var(--bgColor-attention-muted);color:var(--fgColor-default)}div#\:\$p > svg > foreignObject > section small{font-size:90%}div#\:\$p > svg > foreignObject > section sub,div#\:\$p > svg > foreignObject > section sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}div#\:\$p > svg > foreignObject > section sub{bottom:-.25em}div#\:\$p > svg > foreignObject > section sup{top:-.5em}div#\:\$p > svg > foreignObject > section img{border-style:none;box-sizing:content-box;max-width:100%}div#\:\$p > svg > foreignObject > section code,div#\:\$p > svg > foreignObject > section kbd,div#\:\$p > svg > foreignObject > section :is(pre, marp-pre),div#\:\$p > svg > foreignObject > section samp{font-family:monospace;font-size:1em}div#\:\$p > svg > foreignObject > section figure{margin:1em var(--base-size-40)}div#\:\$p > svg > foreignObject > section hr{background:transparent;background-color:var(--borderColor-default);border:0;box-sizing:content-box;height:.25em;margin:var(--base-size-24) 0;overflow:hidden;padding:0}div#\:\$p > svg > foreignObject > section input{font:inherit;font-family:inherit;font-size:inherit;line-height:inherit;margin:0;overflow:visible}div#\:\$p > svg > foreignObject > section [type=button],div#\:\$p > svg > foreignObject > section [type=reset],div#\:\$p > svg > foreignObject > section [type=submit]{-webkit-appearance:button;-moz-appearance:button;appearance:button}div#\:\$p > svg > foreignObject > section [type=checkbox],div#\:\$p > svg > foreignObject > section [type=radio]{box-sizing:border-box;padding:0}div#\:\$p > svg > foreignObject > section [type=number]::-webkit-inner-spin-button,div#\:\$p > svg > foreignObject > section [type=number]::-webkit-outer-spin-button{height:auto}div#\:\$p > svg > foreignObject > section [type=search]::-webkit-search-cancel-button,div#\:\$p > svg > foreignObject > section [type=search]::-webkit-search-decoration{-webkit-appearance:none;appearance:none}div#\:\$p > svg > foreignObject > section ::-webkit-input-placeholder{color:inherit;opacity:.54}div#\:\$p > svg > foreignObject > section ::-webkit-file-upload-button{-webkit-appearance:button;appearance:button;font:inherit}div#\:\$p > svg > foreignObject > section a:hover{text-decoration:underline}div#\:\$p > svg > foreignObject > section ::-moz-placeholder{color:var(--fgColor-muted);opacity:1}div#\:\$p > svg > foreignObject > section ::placeholder{color:var(--fgColor-muted);opacity:1}div#\:\$p > svg > foreignObject > section hr:after,div#\:\$p > svg > foreignObject > section hr:before{content:"";display:table}div#\:\$p > svg > foreignObject > section hr:after{clear:both}div#\:\$p > svg > foreignObject > section table{border-collapse:collapse;border-spacing:0;display:block;font-variant:tabular-nums;max-width:100%;overflow:auto;width:-moz-max-content;width:max-content}div#\:\$p > svg > foreignObject > section td,div#\:\$p > svg > foreignObject > section th{padding:0}div#\:\$p > svg > foreignObject > section details summary{cursor:pointer}div#\:\$p > svg > foreignObject > section [role=button]:focus,div#\:\$p > svg > foreignObject > section a:focus,div#\:\$p > svg > foreignObject > section input[type=checkbox]:focus,div#\:\$p > svg > foreignObject > section input[type=radio]:focus{box-shadow:none;outline:2px solid var(--focus-outlineColor);outline-offset:-2px}div#\:\$p > svg > foreignObject > section [role=button]:focus:not(:focus-visible),div#\:\$p > svg > foreignObject > section a:focus:not(:focus-visible),div#\:\$p > svg > foreignObject > section input[type=checkbox]:focus:not(:focus-visible),div#\:\$p > svg > foreignObject > section input[type=radio]:focus:not(:focus-visible){outline:1px solid transparent}div#\:\$p > svg > foreignObject > section [role=button]:focus-visible,div#\:\$p > svg > foreignObject > section a:focus-visible,div#\:\$p > svg > foreignObject > section input[type=checkbox]:focus-visible,div#\:\$p > svg > foreignObject > section input[type=radio]:focus-visible{box-shadow:none;outline:2px solid var(--focus-outlineColor);outline-offset:-2px}div#\:\$p > svg > foreignObject > section a:not([class]):focus,div#\:\$p > svg > foreignObject > section a:not([class]):focus-visible,div#\:\$p > svg > foreignObject > section input[type=checkbox]:focus,div#\:\$p > svg > foreignObject > section input[type=checkbox]:focus-visible,div#\:\$p > svg > foreignObject > section input[type=radio]:focus,div#\:\$p > svg > foreignObject > section input[type=radio]:focus-visible{outline-offset:0}div#\:\$p > svg > foreignObject > section kbd{background-color:var(--bgColor-muted);border-bottom-color:var(--borderColor-neutral-muted);border:1px solid var(--borderColor-neutral-muted);border-radius:6px;box-shadow:inset 0 -1px 0 var(--borderColor-neutral-muted);color:var(--fgColor-default);display:inline-block;font:11px var(--fontStack-monospace, ui-monospace, SFMono-Regular, SF Mono, Menlo, Consolas, Liberation Mono, monospace);line-height:10px;padding:var(--base-size-4);vertical-align:middle}div#\:\$p > svg > foreignObject > section :is(h1, marp-h1),div#\:\$p > svg > foreignObject > section :is(h2, marp-h2),div#\:\$p > svg > foreignObject > section :is(h3, marp-h3),div#\:\$p > svg > foreignObject > section :is(h4, marp-h4),div#\:\$p > svg > foreignObject > section :is(h5, marp-h5),div#\:\$p > svg > foreignObject > section :is(h6, marp-h6){font-weight:var(--base-text-weight-semibold, 600);line-height:1.25;margin-bottom:var(--base-size-16);margin-top:var(--base-size-24)}div#\:\$p > svg > foreignObject > section :is(h2, marp-h2){border-bottom:1px solid var(--borderColor-muted);font-size:1.5em;padding-bottom:.3em}div#\:\$p > svg > foreignObject > section :is(h2, marp-h2),div#\:\$p > svg > foreignObject > section :is(h3, marp-h3){font-weight:var(--base-text-weight-semibold, 600)}div#\:\$p > svg > foreignObject > section :is(h3, marp-h3){font-size:1.25em}div#\:\$p > svg > foreignObject > section :is(h4, marp-h4){font-size:1em}div#\:\$p > svg > foreignObject > section :is(h4, marp-h4),div#\:\$p > svg > foreignObject > section :is(h5, marp-h5){font-weight:var(--base-text-weight-semibold, 600)}div#\:\$p > svg > foreignObject > section :is(h5, marp-h5){font-size:.875em}div#\:\$p > svg > foreignObject > section :is(h6, marp-h6){color:var(--fgColor-muted);font-size:.85em;font-weight:var(--base-text-weight-semibold, 600)}div#\:\$p > svg > foreignObject > section p{margin-bottom:10px;margin-top:0}div#\:\$p > svg > foreignObject > section blockquote{border-left:.25em solid var(--borderColor-default);color:var(--fgColor-muted);margin:0;padding:0 1em}div#\:\$p > svg > foreignObject > section ol,div#\:\$p > svg > foreignObject > section ul{margin-bottom:0;margin-top:0;padding-left:2em}div#\:\$p > svg > foreignObject > section ol ol,div#\:\$p > svg > foreignObject > section ul ol{list-style-type:lower-roman}div#\:\$p > svg > foreignObject > section ol ol ol,div#\:\$p > svg > foreignObject > section ol ul ol,div#\:\$p > svg > foreignObject > section ul ol ol,div#\:\$p > svg > foreignObject > section ul ul ol{list-style-type:lower-alpha}div#\:\$p > svg > foreignObject > section dd{margin-left:0}div#\:\$p > svg > foreignObject > section code,div#\:\$p > svg > foreignObject > section :is(pre, marp-pre),div#\:\$p > svg > foreignObject > section samp,div#\:\$p > svg > foreignObject > section tt{font-family:var(--fontStack-monospace, ui-monospace, SFMono-Regular, SF Mono, Menlo, Consolas, Liberation Mono, monospace);font-size:12px}div#\:\$p > svg > foreignObject > section :is(pre, marp-pre){margin-bottom:0;margin-top:0;word-wrap:normal}div#\:\$p > svg > foreignObject > section .octicon{display:inline-block;overflow:visible!important;vertical-align:text-bottom;fill:currentColor}div#\:\$p > svg > foreignObject > section input::-webkit-inner-spin-button,div#\:\$p > svg > foreignObject > section input::-webkit-outer-spin-button{-webkit-appearance:none;appearance:none;margin:0}div#\:\$p > svg > foreignObject > section .mr-2{margin-right:var(--base-size-8, 8px)!important}div#\:\$p > svg > foreignObject > section:after,div#\:\$p > svg > foreignObject > section:before{display:table}div#\:\$p > svg > foreignObject > section:after{clear:both}div#\:\$p > svg > foreignObject > section>:first-child{margin-top:0!important}div#\:\$p > svg > foreignObject > section>:last-child{margin-bottom:0!important}div#\:\$p > svg > foreignObject > section a:not([href]){color:inherit;text-decoration:none}div#\:\$p > svg > foreignObject > section .absent{color:var(--fgColor-danger)}div#\:\$p > svg > foreignObject > section .anchor{float:left;line-height:1;margin-left:-20px;padding-right:var(--base-size-4)}div#\:\$p > svg > foreignObject > section .anchor:focus{outline:none}div#\:\$p > svg > foreignObject > section blockquote,div#\:\$p > svg > foreignObject > section details,div#\:\$p > svg > foreignObject > section dl,div#\:\$p > svg > foreignObject > section ol,div#\:\$p > svg > foreignObject > section p,div#\:\$p > svg > foreignObject > section :is(pre, marp-pre),div#\:\$p > svg > foreignObject > section table,div#\:\$p > svg > foreignObject > section ul{margin-bottom:var(--base-size-16);margin-top:0}div#\:\$p > svg > foreignObject > section blockquote>:first-child{margin-top:0}div#\:\$p > svg > foreignObject > section blockquote>:last-child{margin-bottom:0}div#\:\$p > svg > foreignObject > section :is(h1, marp-h1) .octicon-link,div#\:\$p > svg > foreignObject > section :is(h2, marp-h2) .octicon-link,div#\:\$p > svg > foreignObject > section :is(h3, marp-h3) .octicon-link,div#\:\$p > svg > foreignObject > section :is(h4, marp-h4) .octicon-link,div#\:\$p > svg > foreignObject > section :is(h5, marp-h5) .octicon-link,div#\:\$p > svg > foreignObject > section :is(h6, marp-h6) .octicon-link{color:var(--fgColor-default);vertical-align:middle;visibility:hidden}div#\:\$p > svg > foreignObject > section :is(h1, marp-h1):hover .anchor,div#\:\$p > svg > foreignObject > section :is(h2, marp-h2):hover .anchor,div#\:\$p > svg > foreignObject > section :is(h3, marp-h3):hover .anchor,div#\:\$p > svg > foreignObject > section :is(h4, marp-h4):hover .anchor,div#\:\$p > svg > foreignObject > section :is(h5, marp-h5):hover .anchor,div#\:\$p > svg > foreignObject > section :is(h6, marp-h6):hover .anchor{text-decoration:none}div#\:\$p > svg > foreignObject > section :is(h1, marp-h1):hover .anchor .octicon-link,div#\:\$p > svg > foreignObject > section :is(h2, marp-h2):hover .anchor .octicon-link,div#\:\$p > svg > foreignObject > section :is(h3, marp-h3):hover .anchor .octicon-link,div#\:\$p > svg > foreignObject > section :is(h4, marp-h4):hover .anchor .octicon-link,div#\:\$p > svg > foreignObject > section :is(h5, marp-h5):hover .anchor .octicon-link,div#\:\$p > svg > foreignObject > section :is(h6, marp-h6):hover .anchor .octicon-link{visibility:visible}div#\:\$p > svg > foreignObject > section :is(h1, marp-h1) code,div#\:\$p > svg > foreignObject > section :is(h1, marp-h1) tt,div#\:\$p > svg > foreignObject > section :is(h2, marp-h2) code,div#\:\$p > svg > foreignObject > section :is(h2, marp-h2) tt,div#\:\$p > svg > foreignObject > section :is(h3, marp-h3) code,div#\:\$p > svg > foreignObject > section :is(h3, marp-h3) tt,div#\:\$p > svg > foreignObject > section :is(h4, marp-h4) code,div#\:\$p > svg > foreignObject > section :is(h4, marp-h4) tt,div#\:\$p > svg > foreignObject > section :is(h5, marp-h5) code,div#\:\$p > svg > foreignObject > section :is(h5, marp-h5) tt,div#\:\$p > svg > foreignObject > section :is(h6, marp-h6) code,div#\:\$p > svg > foreignObject > section :is(h6, marp-h6) tt{font-size:inherit;padding:0 .2em}div#\:\$p > svg > foreignObject > section summary :is(h1, marp-h1),div#\:\$p > svg > foreignObject > section summary :is(h2, marp-h2),div#\:\$p > svg > foreignObject > section summary :is(h3, marp-h3),div#\:\$p > svg > foreignObject > section summary :is(h4, marp-h4),div#\:\$p > svg > foreignObject > section summary :is(h5, marp-h5),div#\:\$p > svg > foreignObject > section summary :is(h6, marp-h6){display:inline-block}div#\:\$p > svg > foreignObject > section summary :is(h1, marp-h1) .anchor,div#\:\$p > svg > foreignObject > section summary :is(h2, marp-h2) .anchor,div#\:\$p > svg > foreignObject > section summary :is(h3, marp-h3) .anchor,div#\:\$p > svg > foreignObject > section summary :is(h4, marp-h4) .anchor,div#\:\$p > svg > foreignObject > section summary :is(h5, marp-h5) .anchor,div#\:\$p > svg > foreignObject > section summary :is(h6, marp-h6) .anchor{margin-left:-40px}div#\:\$p > svg > foreignObject > section summary :is(h1, marp-h1),div#\:\$p > svg > foreignObject > section summary :is(h2, marp-h2){border-bottom:0;padding-bottom:0}div#\:\$p > svg > foreignObject > section ol.no-list,div#\:\$p > svg > foreignObject > section ul.no-list{list-style-type:none;padding:0}div#\:\$p > svg > foreignObject > section ol[type="a s"]{list-style-type:lower-alpha}div#\:\$p > svg > foreignObject > section ol[type="A s"]{list-style-type:upper-alpha}div#\:\$p > svg > foreignObject > section ol[type="i s"]{list-style-type:lower-roman}div#\:\$p > svg > foreignObject > section ol[type="I s"]{list-style-type:upper-roman}div#\:\$p > svg > foreignObject > section div>ol:not([type]),div#\:\$p > svg > foreignObject > section ol[type="1"]{list-style-type:decimal}div#\:\$p > svg > foreignObject > section ol ol,div#\:\$p > svg > foreignObject > section ol ul,div#\:\$p > svg > foreignObject > section ul ol,div#\:\$p > svg > foreignObject > section ul ul{margin-bottom:0;margin-top:0}div#\:\$p > svg > foreignObject > section li>p{margin-top:var(--base-size-16)}div#\:\$p > svg > foreignObject > section li+li{margin-top:.25em}div#\:\$p > svg > foreignObject > section dl{padding:0}div#\:\$p > svg > foreignObject > section dl dt{font-size:1em;font-style:italic;font-weight:var(--base-text-weight-semibold, 600);margin-top:var(--base-size-16);padding:0}div#\:\$p > svg > foreignObject > section dl dd{margin-bottom:var(--base-size-16);padding:0 var(--base-size-16)}div#\:\$p > svg > foreignObject > section table th{font-weight:var(--base-text-weight-semibold, 600)}div#\:\$p > svg > foreignObject > section table td,div#\:\$p > svg > foreignObject > section table th{border:1px solid var(--borderColor-default);padding:6px 13px}div#\:\$p > svg > foreignObject > section table td>:last-child{margin-bottom:0}div#\:\$p > svg > foreignObject > section table tr{background-color:var(--bgColor-default);border-top:1px solid var(--borderColor-muted)}div#\:\$p > svg > foreignObject > section table tr:nth-child(2n){background-color:var(--bgColor-muted)}div#\:\$p > svg > foreignObject > section table img{background-color:transparent}div#\:\$p > svg > foreignObject > section img[align=right]{padding-left:20px}div#\:\$p > svg > foreignObject > section img[align=left]{padding-right:20px}div#\:\$p > svg > foreignObject > section .emoji{background-color:transparent;max-width:none;vertical-align:text-top}div#\:\$p > svg > foreignObject > section :is(span, marp-span).frame,div#\:\$p > svg > foreignObject > section :is(span, marp-span).frame>:is(span, marp-span){display:block;overflow:hidden}div#\:\$p > svg > foreignObject > section :is(span, marp-span).frame>:is(span, marp-span){border:1px solid var(--borderColor-default);float:left;margin:13px 0 0;padding:7px;width:auto}div#\:\$p > svg > foreignObject > section :is(span, marp-span).frame :is(span, marp-span) img{display:block;float:left}div#\:\$p > svg > foreignObject > section :is(span, marp-span).frame :is(span, marp-span) :is(span, marp-span){clear:both;color:var(--fgColor-default);display:block;padding:5px 0 0}div#\:\$p > svg > foreignObject > section :is(span, marp-span).align-center{clear:both;display:block;overflow:hidden}div#\:\$p > svg > foreignObject > section :is(span, marp-span).align-center>:is(span, marp-span){display:block;margin:13px auto 0;overflow:hidden;text-align:center}div#\:\$p > svg > foreignObject > section :is(span, marp-span).align-center :is(span, marp-span) img{margin:0 auto;text-align:center}div#\:\$p > svg > foreignObject > section :is(span, marp-span).align-right{clear:both;display:block;overflow:hidden}div#\:\$p > svg > foreignObject > section :is(span, marp-span).align-right>:is(span, marp-span){display:block;margin:13px 0 0;overflow:hidden;text-align:right}div#\:\$p > svg > foreignObject > section :is(span, marp-span).align-right :is(span, marp-span) img{margin:0;text-align:right}div#\:\$p > svg > foreignObject > section :is(span, marp-span).float-left{display:block;float:left;margin-right:13px;overflow:hidden}div#\:\$p > svg > foreignObject > section :is(span, marp-span).float-left :is(span, marp-span){margin:13px 0 0}div#\:\$p > svg > foreignObject > section :is(span, marp-span).float-right{display:block;float:right;margin-left:13px;overflow:hidden}div#\:\$p > svg > foreignObject > section :is(span, marp-span).float-right>:is(span, marp-span){display:block;margin:13px auto 0;overflow:hidden;text-align:right}div#\:\$p > svg > foreignObject > section code,div#\:\$p > svg > foreignObject > section tt{background-color:var(--bgColor-neutral-muted);border-radius:6px;font-size:85%;margin:0;padding:.2em .4em;white-space:break-spaces}div#\:\$p > svg > foreignObject > section code br,div#\:\$p > svg > foreignObject > section tt br{display:none}div#\:\$p > svg > foreignObject > section del code{text-decoration:inherit}div#\:\$p > svg > foreignObject > section samp{font-size:85%}div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) code{font-size:100%}div#\:\$p > svg > foreignObject > section :is(pre, marp-pre)>code{background:transparent;border:0;margin:0;padding:0;white-space:pre;word-break:normal}div#\:\$p > svg > foreignObject > section .highlight{margin-bottom:var(--base-size-16)}div#\:\$p > svg > foreignObject > section .highlight :is(pre, marp-pre){margin-bottom:0;word-break:normal}div#\:\$p > svg > foreignObject > section :is(pre, marp-pre){background-color:var(--bgColor-muted);border-radius:6px;color:var(--fgColor-default);font-size:85%;line-height:1.45;overflow:auto;padding:var(--base-size-16)}div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) code,div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) tt{display:inline;line-height:inherit;margin:0;max-width:auto;overflow:visible;padding:0;word-wrap:normal;background-color:transparent;border:0}div#\:\$p > svg > foreignObject > section .csv-data td,div#\:\$p > svg > foreignObject > section .csv-data th{font-size:12px;line-height:1;overflow:hidden;padding:5px;text-align:left;white-space:nowrap}div#\:\$p > svg > foreignObject > section .csv-data .blob-num{background:var(--bgColor-default);border:0;padding:10px var(--base-size-8) 9px;text-align:right}div#\:\$p > svg > foreignObject > section .csv-data tr{border-top:0}div#\:\$p > svg > foreignObject > section .csv-data th{background:var(--bgColor-muted);border-top:0;font-weight:var(--base-text-weight-semibold, 600)}div#\:\$p > svg > foreignObject > section [data-footnote-ref]:before{content:"["}div#\:\$p > svg > foreignObject > section [data-footnote-ref]:after{content:"]"}div#\:\$p > svg > foreignObject > section .footnotes{border-top:1px solid var(--borderColor-default);color:var(--fgColor-muted);font-size:12px}div#\:\$p > svg > foreignObject > section div#\:\$p > svg > foreignObject > section section.footnotes{--marpit-root-font-size:12px;}div#\:\$p > svg > foreignObject > section .footnotes ol,div#\:\$p > svg > foreignObject > section .footnotes ol ul{padding-left:var(--base-size-16)}div#\:\$p > svg > foreignObject > section .footnotes ol ul{display:inline-block;margin-top:var(--base-size-16)}div#\:\$p > svg > foreignObject > section .footnotes li{position:relative}div#\:\$p > svg > foreignObject > section .footnotes li:target:before{border:2px solid var(--borderColor-accent-emphasis);border-radius:6px;bottom:calc(var(--base-size-8)*-1);content:"";left:calc(var(--base-size-24)*-1);pointer-events:none;position:absolute;right:calc(var(--base-size-8)*-1);top:calc(var(--base-size-8)*-1)}div#\:\$p > svg > foreignObject > section .footnotes li:target{color:var(--fgColor-default)}div#\:\$p > svg > foreignObject > section .footnotes .data-footnote-backref g-emoji{font-family:monospace}div#\:\$p > svg > foreignObject > section body:has(:modal){padding-right:var(--dialog-scrollgutter)!important}div#\:\$p > svg > foreignObject > section .pl-c{color:var(--color-prettylights-syntax-comment)}div#\:\$p > svg > foreignObject > section .pl-c1,div#\:\$p > svg > foreignObject > section .pl-s .pl-v{color:var(--color-prettylights-syntax-constant)}div#\:\$p > svg > foreignObject > section .pl-e,div#\:\$p > svg > foreignObject > section .pl-en{color:var(--color-prettylights-syntax-entity)}div#\:\$p > svg > foreignObject > section .pl-s .pl-s1,div#\:\$p > svg > foreignObject > section .pl-smi{color:var(--color-prettylights-syntax-storage-modifier-import)}div#\:\$p > svg > foreignObject > section .pl-ent{color:var(--color-prettylights-syntax-entity-tag)}div#\:\$p > svg > foreignObject > section .pl-k{color:var(--color-prettylights-syntax-keyword)}div#\:\$p > svg > foreignObject > section .pl-pds,div#\:\$p > svg > foreignObject > section .pl-s,div#\:\$p > svg > foreignObject > section .pl-s .pl-pse .pl-s1,div#\:\$p > svg > foreignObject > section .pl-sr,div#\:\$p > svg > foreignObject > section .pl-sr .pl-cce,div#\:\$p > svg > foreignObject > section .pl-sr .pl-sra,div#\:\$p > svg > foreignObject > section .pl-sr .pl-sre{color:var(--color-prettylights-syntax-string)}div#\:\$p > svg > foreignObject > section .pl-smw,div#\:\$p > svg > foreignObject > section .pl-v{color:var(--color-prettylights-syntax-variable)}div#\:\$p > svg > foreignObject > section .pl-bu{color:var(--color-prettylights-syntax-brackethighlighter-unmatched)}div#\:\$p > svg > foreignObject > section .pl-ii{background-color:var(--color-prettylights-syntax-invalid-illegal-bg);color:var(--color-prettylights-syntax-invalid-illegal-text)}div#\:\$p > svg > foreignObject > section .pl-c2{background-color:var(--color-prettylights-syntax-carriage-return-bg);color:var(--color-prettylights-syntax-carriage-return-text)}div#\:\$p > svg > foreignObject > section .pl-sr .pl-cce{color:var(--color-prettylights-syntax-string-regexp);font-weight:700}div#\:\$p > svg > foreignObject > section .pl-ml{color:var(--color-prettylights-syntax-markup-list)}div#\:\$p > svg > foreignObject > section .pl-mh,div#\:\$p > svg > foreignObject > section .pl-mh .pl-en,div#\:\$p > svg > foreignObject > section .pl-ms{color:var(--color-prettylights-syntax-markup-heading);font-weight:700}div#\:\$p > svg > foreignObject > section .pl-mi{color:var(--color-prettylights-syntax-markup-italic);font-style:italic}div#\:\$p > svg > foreignObject > section .pl-mb{color:var(--color-prettylights-syntax-markup-bold);font-weight:700}div#\:\$p > svg > foreignObject > section .pl-md{background-color:var(--color-prettylights-syntax-markup-deleted-bg);color:var(--color-prettylights-syntax-markup-deleted-text)}div#\:\$p > svg > foreignObject > section .pl-mi1{background-color:var(--color-prettylights-syntax-markup-inserted-bg);color:var(--color-prettylights-syntax-markup-inserted-text)}div#\:\$p > svg > foreignObject > section .pl-mc{background-color:var(--color-prettylights-syntax-markup-changed-bg);color:var(--color-prettylights-syntax-markup-changed-text)}div#\:\$p > svg > foreignObject > section .pl-mi2{background-color:var(--color-prettylights-syntax-markup-ignored-bg);color:var(--color-prettylights-syntax-markup-ignored-text)}div#\:\$p > svg > foreignObject > section .pl-mdr{color:var(--color-prettylights-syntax-meta-diff-range);font-weight:700}div#\:\$p > svg > foreignObject > section .pl-ba{color:var(--color-prettylights-syntax-brackethighlighter-angle)}div#\:\$p > svg > foreignObject > section .pl-sg{color:var(--color-prettylights-syntax-sublimelinter-gutter-mark)}div#\:\$p > svg > foreignObject > section .pl-corl{color:var(--color-prettylights-syntax-constant-other-reference-link);text-decoration:underline}div#\:\$p > svg > foreignObject > section [role=button]:focus:not(:focus-visible),div#\:\$p > svg > foreignObject > section [role=tabpanel][tabindex="0"]:focus:not(:focus-visible),div#\:\$p > svg > foreignObject > section a:focus:not(:focus-visible),div#\:\$p > svg > foreignObject > section button:focus:not(:focus-visible),div#\:\$p > svg > foreignObject > section summary:focus:not(:focus-visible){box-shadow:none;outline:none}div#\:\$p > svg > foreignObject > section [tabindex="0"]:focus:not(:focus-visible),div#\:\$p > svg > foreignObject > section details-dialog:focus:not(:focus-visible){outline:none}div#\:\$p > svg > foreignObject > section g-emoji{display:inline-block;font-family:Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol;font-size:1em;font-style:normal!important;font-weight:var(--base-text-weight-normal, 400);line-height:1;min-width:1ch;vertical-align:-.075em}div#\:\$p > svg > foreignObject > section g-emoji img{height:1em;width:1em}div#\:\$p > svg > foreignObject > section .task-list-item{list-style-type:none}div#\:\$p > svg > foreignObject > section .task-list-item label{font-weight:var(--base-text-weight-normal, 400)}div#\:\$p > svg > foreignObject > section .task-list-item.enabled label{cursor:pointer}div#\:\$p > svg > foreignObject > section .task-list-item+.task-list-item{margin-top:var(--base-size-4)}div#\:\$p > svg > foreignObject > section .task-list-item .handle{display:none}div#\:\$p > svg > foreignObject > section .task-list-item-checkbox{margin:0 .2em .25em -1.4em;vertical-align:middle}div#\:\$p > svg > foreignObject > section ul:dir(rtl) .task-list-item-checkbox{margin:0 -1.6em .25em .2em}div#\:\$p > svg > foreignObject > section ol:dir(rtl) .task-list-item-checkbox{margin:0 -1.6em .25em .2em}div#\:\$p > svg > foreignObject > section .contains-task-list:focus-within .task-list-item-convert-container,div#\:\$p > svg > foreignObject > section .contains-task-list:hover .task-list-item-convert-container{display:block;height:24px;overflow:visible;width:auto;clip:auto}div#\:\$p > svg > foreignObject > section ::-webkit-calendar-picker-indicator{filter:invert(50%)}div#\:\$p > svg > foreignObject > section .markdown-alert{border-left:.25em solid var(--borderColor-default);color:inherit;margin-bottom:var(--base-size-16);padding:var(--base-size-8) var(--base-size-16)}div#\:\$p > svg > foreignObject > section .markdown-alert>:first-child{margin-top:0}div#\:\$p > svg > foreignObject > section .markdown-alert>:last-child{margin-bottom:0}div#\:\$p > svg > foreignObject > section .markdown-alert .markdown-alert-title{align-items:center;display:flex;font-weight:var(--base-text-weight-medium, 500);line-height:1}div#\:\$p > svg > foreignObject > section .markdown-alert.markdown-alert-note{border-left-color:var(--borderColor-accent-emphasis)}div#\:\$p > svg > foreignObject > section .markdown-alert.markdown-alert-note .markdown-alert-title{color:var(--fgColor-accent)}div#\:\$p > svg > foreignObject > section .markdown-alert.markdown-alert-important{border-left-color:var(--borderColor-done-emphasis)}div#\:\$p > svg > foreignObject > section .markdown-alert.markdown-alert-important .markdown-alert-title{color:var(--fgColor-done)}div#\:\$p > svg > foreignObject > section .markdown-alert.markdown-alert-warning{border-left-color:var(--borderColor-attention-emphasis)}div#\:\$p > svg > foreignObject > section .markdown-alert.markdown-alert-warning .markdown-alert-title{color:var(--fgColor-attention)}div#\:\$p > svg > foreignObject > section .markdown-alert.markdown-alert-tip{border-left-color:var(--borderColor-success-emphasis)}div#\:\$p > svg > foreignObject > section .markdown-alert.markdown-alert-tip .markdown-alert-title{color:var(--fgColor-success)}div#\:\$p > svg > foreignObject > section .markdown-alert.markdown-alert-caution{border-left-color:var(--borderColor-danger-emphasis)}div#\:\$p > svg > foreignObject > section .markdown-alert.markdown-alert-caution .markdown-alert-title{color:var(--fgColor-danger)}div#\:\$p > svg > foreignObject > section>:first-child>.heading-element:first-child{margin-top:0!important}div#\:\$p > svg > foreignObject > section .highlight :is(pre, marp-pre):has(+.zeroclipboard-container){min-height:52px}div#\:\$p > svg > foreignObject > section :is(h1, marp-h1){color:var(--h1-color);font-size:1.6em}div#\:\$p > svg > foreignObject > section :is(h1, marp-h1),div#\:\$p > svg > foreignObject > section :is(h2, marp-h2){border-bottom:none}div#\:\$p > svg > foreignObject > section :is(h2, marp-h2){font-size:1.3em}div#\:\$p > svg > foreignObject > section :is(h3, marp-h3){font-size:1.1em}div#\:\$p > svg > foreignObject > section :is(h4, marp-h4){font-size:1.05em}div#\:\$p > svg > foreignObject > section :is(h5, marp-h5){font-size:1em}div#\:\$p > svg > foreignObject > section :is(h6, marp-h6){font-size:.9em}div#\:\$p > svg > foreignObject > section :is(h1, marp-h1) strong,div#\:\$p > svg > foreignObject > section :is(h2, marp-h2) strong,div#\:\$p > svg > foreignObject > section :is(h3, marp-h3) strong,div#\:\$p > svg > foreignObject > section :is(h4, marp-h4) strong,div#\:\$p > svg > foreignObject > section :is(h5, marp-h5) strong,div#\:\$p > svg > foreignObject > section :is(h6, marp-h6) strong{color:var(--heading-strong-color);font-weight:inherit}div#\:\$p > svg > foreignObject > section :is(h1, marp-h1)::part(auto-scaling),div#\:\$p > svg > foreignObject > section :is(h2, marp-h2)::part(auto-scaling),div#\:\$p > svg > foreignObject > section :is(h3, marp-h3)::part(auto-scaling),div#\:\$p > svg > foreignObject > section :is(h4, marp-h4)::part(auto-scaling),div#\:\$p > svg > foreignObject > section :is(h5, marp-h5)::part(auto-scaling),div#\:\$p > svg > foreignObject > section :is(h6, marp-h6)::part(auto-scaling){max-height:563px}div#\:\$p > svg > foreignObject > section hr{height:0;padding-top:.25em}div#\:\$p > svg > foreignObject > section img{background-color:transparent}div#\:\$p > svg > foreignObject > section :is(pre, marp-pre){border:1px solid var(--borderColor-default);line-height:1.15;overflow:visible}div#\:\$p > svg > foreignObject > section :is(pre, marp-pre)::part(auto-scaling){max-height:529px}div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs){color:var(--color-prettylights-syntax-storage-modifier-import)}div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-doctag),div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-keyword),div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-meta .hljs-keyword),div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-template-tag),div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-template-variable),div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-type),div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-variable.language_){color:var(--color-prettylights-syntax-keyword)}div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-title),div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-title.class_),div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-title.class_.inherited__),div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-title.function_){color:var(--color-prettylights-syntax-entity)}div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-attr),div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-attribute),div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-literal),div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-meta),div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-number),div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-operator),div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-selector-attr),div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-selector-class),div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-selector-id),div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-variable){color:var(--color-prettylights-syntax-constant)}div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-meta .hljs-string),div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-regexp),div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-string){color:var(--color-prettylights-syntax-string)}div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-built_in),div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-symbol){color:var(--color-prettylights-syntax-variable)}div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-code),div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-comment),div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-formula){color:var(--color-prettylights-syntax-comment)}div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-name),div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-quote),div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-selector-pseudo),div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-selector-tag){color:var(--color-prettylights-syntax-entity-tag)}div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-subst){color:var(--color-prettylights-syntax-storage-modifier-import)}div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-section){color:var(--color-prettylights-syntax-markup-heading);font-weight:700}div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-bullet){color:var(--color-prettylights-syntax-markup-list)}div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-emphasis){color:var(--color-prettylights-syntax-markup-italic);font-style:italic}div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-strong){color:var(--color-prettylights-syntax-markup-bold);font-weight:700}div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-addition){background-color:var(--color-prettylights-syntax-markup-inserted-bg);color:var(--color-prettylights-syntax-markup-inserted-text)}div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-deletion){background-color:var(--color-prettylights-syntax-markup-deleted-bg);color:var(--color-prettylights-syntax-markup-deleted-text)}div#\:\$p > svg > foreignObject > section footer,div#\:\$p > svg > foreignObject > section header{color:var(--header-footer-color);font-size:18px;left:30px;margin:0;position:absolute}div#\:\$p > svg > foreignObject > section header{top:21px}div#\:\$p > svg > foreignObject > section footer{bottom:21px}div#\:\$p > svg > foreignObject > section{--h1-color:#246;--header-footer-color:hsla(0,0%,40%,.75);--heading-strong-color:#48c;--paginate-color:#777;--base-size-4:4px;--base-size-8:8px;--base-size-16:16px;--base-size-24:24px;--base-size-40:40px;align-items:stretch;display:block;flex-flow:column nowrap;font-size:29px;height:720px;padding:78.5px;place-content:safe center center;width:1280px}div#\:\$p > svg > foreignObject > section{--marpit-root-font-size:29px;}div#\:\$p > svg > foreignObject > section:where(.invert){--h1-color:#cee7ff;--header-footer-color:hsla(0,0%,60%,.75);--heading-strong-color:#7bf;--paginate-color:#999;}div#\:\$p > svg > foreignObject > section>:last-child,div#\:\$p > svg > foreignObject > section[data-footer]>:nth-last-child(2){margin-bottom:0}div#\:\$p > svg > foreignObject > section>:first-child,div#\:\$p > svg > foreignObject > section>header:first-child+*{margin-top:0}div#\:\$p > svg > foreignObject > section:after{bottom:21px;color:var(--paginate-color);font-size:24px;padding:0;position:absolute;right:30px}div#\:\$p > svg > foreignObject > section:after{--marpit-root-font-size:24px;}div#\:\$p > svg > foreignObject > section[data-color] :is(h1, marp-h1),div#\:\$p > svg > foreignObject > section[data-color] :is(h2, marp-h2),div#\:\$p > svg > foreignObject > section[data-color] :is(h3, marp-h3),div#\:\$p > svg > foreignObject > section[data-color] :is(h4, marp-h4),div#\:\$p > svg > foreignObject > section[data-color] :is(h5, marp-h5),div#\:\$p > svg > foreignObject > section[data-color] :is(h6, marp-h6){color:currentcolor}div#\:\$p > svg > foreignObject > :where(section){container-type:size}div#\:\$p > svg > foreignObject > section img[data-marp-twemoji]{background:transparent;height:1em;margin:0 .05em 0 .1em;vertical-align:-.1em;width:1em}div#\:\$p > svg > foreignObject > section.communism :is(h2, marp-h2), div#\:\$p > svg > foreignObject > section.communism :is(h1, marp-h1), div#\:\$p > svg > foreignObject > section.communism :is(h3, marp-h3){font-family:'Zilla Slab', Impact, Haettenschweiler, 'Arial Narrow Bold', sans-serif;color:#fc9c36;font-size:calc(var(--marpit-root-font-size, 1rem) * 2);font-weight:bold;font-style:italic;text-shadow:3px 3px 0 #000;line-height:0;max-width:65%}div#\:\$p > svg > foreignObject > section.communism :is(h1, marp-h1){font-size:calc(var(--marpit-root-font-size, 1rem) * 3);line-height:1}div#\:\$p > svg > foreignObject > section.communism :is(h3, marp-h3){font-size:calc(var(--marpit-root-font-size, 1rem) * 1);line-height:1}div#\:\$p > svg > foreignObject > section.communism :is(h4, marp-h4){font-family:'Zilla Slab', Impact, Haettenschweiler, 'Arial Narrow Bold', sans-serif}div#\:\$p > svg > foreignObject > section.communism{background-image:url('../images/bg4.jpg');background-size:cover}div#\:\$p > svg > foreignObject > section.communism2{background-image:url('../images/bg5.jpg');background-size:cover}div#\:\$p > svg > foreignObject > section :is(h6, marp-h6){margin-top:calc(var(--marpit-root-font-size, 1rem) * 0.25);font-size:calc(var(--marpit-root-font-size, 1rem) * 0.75);line-height:0}div#\:\$p > svg > foreignObject > section :is(h1, marp-h1), div#\:\$p > svg > foreignObject > section :is(h2, marp-h2), div#\:\$p > svg > foreignObject > section :is(h3, marp-h3), div#\:\$p > svg > foreignObject > section :is(h4, marp-h4), div#\:\$p > svg > foreignObject > section :is(h5, marp-h5), div#\:\$p > svg > foreignObject > section :is(h6, marp-h6){font-family:'Zilla Slab', Impact, Haettenschweiler, 'Arial Narrow Bold', sans-serif}div#\:\$p > svg > foreignObject > section .columns{display:grid;grid-template-columns:repeat(2, minmax(0, 1fr));gap:calc(var(--marpit-root-font-size, 1rem) * 1)}div#\:\$p > svg > foreignObject > section center{display:flex;justify-content:center}div#\:\$p > svg > foreignObject > section{font-family:"Noto Sans"}div#\:\$p > svg > foreignObject > section code{font-family:"Noto Sans Mono"}div#\:\$p > svg > foreignObject > section .container{display:flex;gap:16px}div#\:\$p > svg > foreignObject > section .col{flex:1}div#\:\$p > svg > foreignObject > section[data-marpit-advanced-background="background"]{columns:initial!important;display:block!important;padding:0!important}div#\:\$p > svg > foreignObject > section[data-marpit-advanced-background="background"]::before, div#\:\$p > svg > foreignObject > section[data-marpit-advanced-background="background"]::after, div#\:\$p > svg > foreignObject > section[data-marpit-advanced-background="content"]::before, div#\:\$p > svg > foreignObject > section[data-marpit-advanced-background="content"]::after{display:none!important}div#\:\$p > svg > foreignObject > section[data-marpit-advanced-background="background"] > div[data-marpit-advanced-background-container]{all:initial;display:flex;flex-direction:row;height:100%;overflow:hidden;width:100%}div#\:\$p > svg > foreignObject > section[data-marpit-advanced-background="background"] > div[data-marpit-advanced-background-container][data-marpit-advanced-background-direction="vertical"]{flex-direction:column}div#\:\$p > svg > foreignObject > section[data-marpit-advanced-background="background"][data-marpit-advanced-background-split] > div[data-marpit-advanced-background-container]{width:var(--marpit-advanced-background-split, 50%)}div#\:\$p > svg > foreignObject > section[data-marpit-advanced-background="background"][data-marpit-advanced-background-split="right"] > div[data-marpit-advanced-background-container]{margin-left:calc(100% - var(--marpit-advanced-background-split, 50%))}div#\:\$p > svg > foreignObject > section[data-marpit-advanced-background="background"] > div[data-marpit-advanced-background-container] > figure{all:initial;background-position:center;background-repeat:no-repeat;background-size:cover;flex:auto;margin:0}div#\:\$p > svg > foreignObject > section[data-marpit-advanced-background="background"] > div[data-marpit-advanced-background-container] > figure > figcaption{position:absolute;border:0;clip:rect(0, 0, 0, 0);height:1px;margin:-1px;overflow:hidden;padding:0;white-space:nowrap;width:1px}div#\:\$p > svg > foreignObject > section[data-marpit-advanced-background="content"], div#\:\$p > svg > foreignObject > section[data-marpit-advanced-background="pseudo"]{background:transparent!important}div#\:\$p > svg > foreignObject > section[data-marpit-advanced-background="pseudo"], div#\:\$p > svg[data-marpit-svg] > foreignObject[data-marpit-advanced-background="pseudo"]{pointer-events:none!important}div#\:\$p > svg > foreignObject > section[data-marpit-advanced-background-split]{width:100%;height:100%}
</style></head><body><div class="bespoke-marp-osc"><button data-bespoke-marp-osc="prev" tabindex="-1" title="Previous slide">Previous slide</button><span data-bespoke-marp-osc="page"></span><button data-bespoke-marp-osc="next" tabindex="-1" title="Next slide">Next slide</button><button data-bespoke-marp-osc="fullscreen" tabindex="-1" title="Toggle fullscreen (f)">Toggle fullscreen</button><button data-bespoke-marp-osc="presenter" tabindex="-1" title="Open presenter view (p)">Open presenter view</button></div><div id=":$p"><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="1" data-paginate="true" data-class="communism invert" data-theme="rust" lang="en-US" class="communism invert" data-marpit-pagination="1" style="--paginate:true;--class:communism invert;--theme:rust;" data-marpit-pagination-total="102">
<h2 id="intro-to-rust-lang">Intro to Rust Lang</h2>
<h1 id="ownership-revisited">Ownership Revisited</h1>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="2" data-marpit-fragments="4" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="2" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="ownership-revisited-1">Ownership Revisited</h1>
<p>Today, we'll provide another way of thinking about ownership:</p>
<ul>
<li data-marpit-fragment="1">Not just avoiding compile errors, but uncovering:
<ul>
<li data-marpit-fragment="2">How the borrow checker works</li>
<li data-marpit-fragment="3">The purpose of the borrow checker</li>
</ul>
</li>
<li data-marpit-fragment="4">How do we write safer code by working <em>with</em> the borrow checker?</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="3" data-marpit-fragments="2" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="3" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="the-rules">The Rules</h1>
<p>At the beginning of this course, we learned two sets of rules...</p>
<ul>
<li data-marpit-fragment="1">Ownership rules</li>
<li data-marpit-fragment="2">Borrowing rules</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="4" data-marpit-fragments="3" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="4" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="rules-of-ownership">Rules of Ownership</h1>
<ul>
<li data-marpit-fragment="1">Each value in Rust has an <em>owner</em></li>
<li data-marpit-fragment="2">A value can only have one owner at a time</li>
<li data-marpit-fragment="3">When the owner goes out of scope, the value will be <em>dropped</em></li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="5" data-marpit-fragments="4" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="5" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="rules-of-borrowing">Rules of Borrowing</h1>
<ul>
<li data-marpit-fragment="1">At any given time, you may have either
<ul>
<li data-marpit-fragment="2">One mutable (exclusive) reference to data</li>
<li data-marpit-fragment="3">Any number of immutable (shared) references to the same data</li>
</ul>
</li>
<li data-marpit-fragment="4">There can never be dangling references</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="6" data-marpit-fragments="5" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="6" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="the-catch">The Catch</h1>
<p>Getting code to compile is one thing. Understanding why is another...</p>
<ul>
<li data-marpit-fragment="1">Sometimes we follow the rules blindly
<ul>
<li data-marpit-fragment="2">When we break the rules, we may not fully understand why it is a problem in the first place</li>
</ul>
</li>
<li data-marpit-fragment="3">The compiler can be overly cautious
<ul>
<li data-marpit-fragment="4">Rejects code that seems safe</li>
<li data-marpit-fragment="5">Makes us prove safety, even when we &quot;know&quot; it's safe</li>
</ul>
</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="7" data-marpit-fragments="2" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="7" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="todays-objective">Today's Objective</h1>
<p>Today we're going to address these questions:</p>
<ul>
<li data-marpit-fragment="1">How do ownership rules prevent memory safety issues?</li>
<li data-marpit-fragment="2">What makes the borrow checker reject seemingly safe code?</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="8" data-marpit-fragments="1" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="8" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="defining-safety">Defining Safety</h1>
<p>What is safety?</p>
<ul>
<li data-marpit-fragment="1">Safety is the absence of <em>undefined behavior</em></li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="9" data-marpit-fragments="1" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="9" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="defining-unsafe">Defining Unsafe</h1>
<p>However, undefined behavior / unsafety can mean many things.</p>
<p><img src="../images/week8/rust-undefined.png" alt="list" /></p>
<ul>
<li data-marpit-fragment="1">Definition in the <a href="https://doc.rust-lang.org/reference/behavior-considered-undefined.html">Rust Reference</a> is much longer...</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="10" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="10" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="defining-unsafe-1">Defining Unsafe</h1>
<p>Simplification for today: <strong>Unsafety ⇒ Invalid Memory Access</strong></p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="11" data-marpit-fragments="4" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="11" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="unsafety-%E2%87%92-invalid-memory-access">Unsafety ⇒ Invalid Memory Access</h1>
<p>Memory access can be unsafe if we access memory that is:</p>
<ul>
<li data-marpit-fragment="1">Deallocated
<ul>
<li data-marpit-fragment="2">Ownership rules prevent this</li>
</ul>
</li>
<li data-marpit-fragment="3">Overwritten by &quot;someone else&quot;
<ul>
<li data-marpit-fragment="4">Borrowing rules prevent this</li>
</ul>
</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="12" data-marpit-fragments="3" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="12" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="unsafety-%E2%87%92-invalid-memory-access-1">Unsafety ⇒ Invalid Memory Access</h1>
<p>Memory access can be unsafe if we access <strong>deallocated</strong> or <strong>overwritten</strong> memory.</p>
<ul>
<li data-marpit-fragment="1">Immutable global variables are trivially safe
<ul>
<li data-marpit-fragment="2"><code>static</code> variables are read-only and valid for program's lifetime</li>
</ul>
</li>
<li data-marpit-fragment="3">Today, we'll focus on <em>local</em> variables</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="13" data-marpit-fragments="3" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="13" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="local-variables">Local Variables</h1>
<p>Local variables live in a function's <strong>stack frame</strong>.</p>
<p>The stack frame:</p>
<ul>
<li data-marpit-fragment="1">Contains everything needed for the function to run</li>
<li data-marpit-fragment="2">Is allocated on function call</li>
<li data-marpit-fragment="3">Is deallocated on function return</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="14" style="--paginate:true;--theme:rust;--marpit-advanced-background-split:50%;" data-marpit-pagination-total="102" data-marpit-advanced-background="background" data-marpit-advanced-background-split="right"><div data-marpit-advanced-background-container="true" data-marpit-advanced-background-direction="horizontal"><figure style="background-image:url(&quot;../images/week8/frames/0.png&quot;);background-size:50%;"></figure></div></section></foreignObject><foreignObject width="50%" height="720"><section id="14" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="14" style="--paginate:true;--theme:rust;--marpit-advanced-background-split:50%;" data-marpit-pagination-total="102" data-marpit-advanced-background="content" data-marpit-advanced-background-split="right">
<h1 id="the-stack-local-variables">The Stack: Local Variables</h1>

<p>Here is a representation of <code>main</code>'s stack frame.</p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-rust"><span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-keyword">let</span> <span class="hljs-variable">x</span> = <span class="hljs-number">1</span>;
}
</code></pre>
</section>
</foreignObject><foreignObject width="1280" height="720" data-marpit-advanced-background="pseudo"><section data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="14" style="" data-marpit-pagination-total="102" data-marpit-advanced-background="pseudo" data-marpit-advanced-background-split="right"></section></foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="15" style="--paginate:true;--theme:rust;--marpit-advanced-background-split:50%;" data-marpit-pagination-total="102" data-marpit-advanced-background="background" data-marpit-advanced-background-split="right"><div data-marpit-advanced-background-container="true" data-marpit-advanced-background-direction="horizontal"><figure style="background-image:url(&quot;../images/week8/frames/1.png&quot;);background-size:50%;"></figure></div></section></foreignObject><foreignObject width="50%" height="720"><section id="15" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="15" style="--paginate:true;--theme:rust;--marpit-advanced-background-split:50%;" data-marpit-pagination-total="102" data-marpit-advanced-background="content" data-marpit-advanced-background-split="right">
<h1 id="the-stack-local-variables-1">The Stack: Local Variables</h1>

<p>Now we call <code>my_function</code>, constructing its stack frame.</p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-rust"><span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-keyword">let</span> <span class="hljs-variable">x</span> = <span class="hljs-number">1</span>;
    <span class="hljs-title function_ invoke__">my_function</span>(x);
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">my_function</span>(arg: <span class="hljs-type">i32</span>) {
    <span class="hljs-keyword">let</span> <span class="hljs-variable">y</span> = <span class="hljs-number">2</span>;
    <span class="hljs-keyword">let</span> <span class="hljs-variable">z</span> = <span class="hljs-number">3</span>;
}
</code></pre>
</section>
</foreignObject><foreignObject width="1280" height="720" data-marpit-advanced-background="pseudo"><section data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="15" style="" data-marpit-pagination-total="102" data-marpit-advanced-background="pseudo" data-marpit-advanced-background-split="right"></section></foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="16" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="16" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="the-heap"><strong>The Heap</strong></h1>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="17" style="--paginate:true;--theme:rust;--marpit-advanced-background-split:50%;" data-marpit-pagination-total="102" data-marpit-advanced-background="background" data-marpit-advanced-background-split="right"><div data-marpit-advanced-background-container="true" data-marpit-advanced-background-direction="horizontal"><figure style="background-image:url(&quot;../images/week8/frames/0.png&quot;);background-size:50%;"></figure></div></section></foreignObject><foreignObject width="50%" height="720"><section id="17" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="17" style="--paginate:true;--theme:rust;--marpit-advanced-background-split:50%;" data-marpit-pagination-total="102" data-marpit-advanced-background="content" data-marpit-advanced-background-split="right">
<h1 id="big-data">Big Data</h1>

<p>What if instead of an integer on the stack (<code>x = 1</code>)...</p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-rust"><span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-keyword">let</span> <span class="hljs-variable">x</span> = <span class="hljs-number">1</span>;
    <span class="hljs-title function_ invoke__">my_function</span>(x);
}
</code></pre>
</section>
</foreignObject><foreignObject width="1280" height="720" data-marpit-advanced-background="pseudo"><section data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="17" style="" data-marpit-pagination-total="102" data-marpit-advanced-background="pseudo" data-marpit-advanced-background-split="right"></section></foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section data-marpit-fragments="1" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="18" style="--paginate:true;--theme:rust;--marpit-advanced-background-split:50%;" data-marpit-pagination-total="102" data-marpit-advanced-background="background" data-marpit-advanced-background-split="right"><div data-marpit-advanced-background-container="true" data-marpit-advanced-background-direction="horizontal"><figure style="background-image:url(&quot;../images/week8/frames/2.png&quot;);background-size:100%;"></figure></div></section></foreignObject><foreignObject width="50%" height="720"><section id="18" data-marpit-fragments="1" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="18" style="--paginate:true;--theme:rust;--marpit-advanced-background-split:50%;" data-marpit-pagination-total="102" data-marpit-advanced-background="content" data-marpit-advanced-background-split="right">
<h1 id="big-data-1">Big Data</h1>

<p>We have a 15 GB array?</p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-rust"><span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-keyword">let</span> <span class="hljs-variable">beef</span> =
        [<span class="hljs-number">0xDEADBEEF</span>; HUGE_NUMBER];

    <span class="hljs-title function_ invoke__">my_function</span>(beef);
}
</code></pre>
<ul>
<li data-marpit-fragment="1">15 GB = your Google Drive storage <img src="../images/week8/google-storage.png" alt="alt text" /></li>
</ul>
</section>
</foreignObject><foreignObject width="1280" height="720" data-marpit-advanced-background="pseudo"><section data-marpit-fragments="1" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="18" style="" data-marpit-pagination-total="102" data-marpit-advanced-background="pseudo" data-marpit-advanced-background-split="right"></section></foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section data-marpit-fragments="2" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="19" style="--paginate:true;--theme:rust;--marpit-advanced-background-split:45%;" data-marpit-pagination-total="102" data-marpit-advanced-background="background" data-marpit-advanced-background-split="right"><div data-marpit-advanced-background-container="true" data-marpit-advanced-background-direction="horizontal"><figure style="background-image:url(&quot;../images/week8/frames/3.png&quot;);background-size:100%;"></figure></div></section></foreignObject><foreignObject width="55%" height="720"><section id="19" data-marpit-fragments="2" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="19" style="--paginate:true;--theme:rust;--marpit-advanced-background-split:45%;" data-marpit-pagination-total="102" data-marpit-advanced-background="content" data-marpit-advanced-background-split="right">
<h1 id="big-data-2">Big Data</h1>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-rust"><span class="hljs-keyword">fn</span> <span class="hljs-title function_">my_function</span>(arg: [<span class="hljs-type">u32</span>; HUGE_NUMBER]) {
    &lt;-- snip -<span class="hljs-punctuation">-&gt;</span>
}
</code></pre>
<p>When we call <code>my_function</code>, we need to:</p>
<ul>
<li data-marpit-fragment="1">Allocate enough space in the stack frame</li>
<li data-marpit-fragment="2">Copy all 15 GB of <code>0xDEADBEEF</code>'s...</li>
</ul>
</section>
</foreignObject><foreignObject width="1280" height="720" data-marpit-advanced-background="pseudo"><section data-marpit-fragments="2" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="19" style="" data-marpit-pagination-total="102" data-marpit-advanced-background="pseudo" data-marpit-advanced-background-split="right"></section></foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="20" data-marpit-fragments="1" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="20" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="big-data-3">Big Data</h1>
<p>Imagine being required to recreate <code>beef</code> on every single stack frame.</p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-rust"><span class="hljs-keyword">let</span> <span class="hljs-variable">beef</span> = [<span class="hljs-number">0xDEADBEEF</span>; <span class="hljs-number">2_000_000_000</span>];

<span class="hljs-title function_ invoke__">my_function</span>(beef);
<span class="hljs-title function_ invoke__">my_function</span>(beef);
<span class="hljs-title function_ invoke__">my_function</span>(beef);
<span class="hljs-title function_ invoke__">my_function</span>(beef);
<span class="hljs-title function_ invoke__">my_function</span>(beef);
<span class="hljs-title function_ invoke__">my_function</span>(beef);
<span class="hljs-title function_ invoke__">my_function</span>(beef);
<span class="hljs-title function_ invoke__">my_function</span>(beef);
<span class="hljs-title function_ invoke__">my_function</span>(beef);
<span class="hljs-title function_ invoke__">my_function</span>(beef);
</code></pre>
<ul>
<li data-marpit-fragment="1">Unsustainable!</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="21" data-marpit-fragments="3" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="21" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="motivating-the-heap">Motivating the Heap</h1>
<p>We probably want to keep our <code>beef</code> array around for longer than a single function call.</p>
<ul>
<li data-marpit-fragment="1">We can say that it is <strong>long-lived</strong> data</li>
<li data-marpit-fragment="2">We want other functions to use this array, instead of just a single stack frame</li>
<li data-marpit-fragment="3">How do we persist this data across function calls?</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="22" style="--paginate:true;--theme:rust;--marpit-advanced-background-split:50%;" data-marpit-pagination-total="102" data-marpit-advanced-background="background" data-marpit-advanced-background-split="right"><div data-marpit-advanced-background-container="true" data-marpit-advanced-background-direction="horizontal"><figure style="background-image:url(&quot;../images/week8/frames/2.png&quot;);background-size:100%;"></figure></div></section></foreignObject><foreignObject width="50%" height="720"><section id="22" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="22" style="--paginate:true;--theme:rust;--marpit-advanced-background-split:50%;" data-marpit-pagination-total="102" data-marpit-advanced-background="content" data-marpit-advanced-background-split="right">
<h1 id="the-stack">The Stack?</h1>

<p>Instead of storing our array buffer on the stack...</p>
</section>
</foreignObject><foreignObject width="1280" height="720" data-marpit-advanced-background="pseudo"><section data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="22" style="" data-marpit-pagination-total="102" data-marpit-advanced-background="pseudo" data-marpit-advanced-background-split="right"></section></foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="23" style="--paginate:true;--theme:rust;--marpit-advanced-background-split:50%;" data-marpit-pagination-total="102" data-marpit-advanced-background="background" data-marpit-advanced-background-split="right"><div data-marpit-advanced-background-container="true" data-marpit-advanced-background-direction="horizontal"><figure style="background-image:url(&quot;../images/week8/frames/4.png&quot;);background-size:100%;"></figure></div></section></foreignObject><foreignObject width="50%" height="720"><section id="23" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="23" style="--paginate:true;--theme:rust;--marpit-advanced-background-split:50%;" data-marpit-pagination-total="102" data-marpit-advanced-background="content" data-marpit-advanced-background-split="right">
<h1 id="the-heap-1">The Heap</h1>

<p>Instead of storing our array buffer on the stack...</p>
<p>Let's put it on the <strong>heap</strong>!</p>
</section>
</foreignObject><foreignObject width="1280" height="720" data-marpit-advanced-background="pseudo"><section data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="23" style="" data-marpit-pagination-total="102" data-marpit-advanced-background="pseudo" data-marpit-advanced-background-split="right"></section></foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section data-marpit-fragments="2" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="24" style="--paginate:true;--theme:rust;--marpit-advanced-background-split:50%;" data-marpit-pagination-total="102" data-marpit-advanced-background="background" data-marpit-advanced-background-split="right"><div data-marpit-advanced-background-container="true" data-marpit-advanced-background-direction="horizontal"><figure style="background-image:url(&quot;../images/week8/frames/4.png&quot;);background-size:100%;"></figure></div></section></foreignObject><foreignObject width="50%" height="720"><section id="24" data-marpit-fragments="2" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="24" style="--paginate:true;--theme:rust;--marpit-advanced-background-split:50%;" data-marpit-pagination-total="102" data-marpit-advanced-background="content" data-marpit-advanced-background-split="right">
<h1 id="the-heap-2">The Heap</h1>

<ul>
<li data-marpit-fragment="1">If the data lives in the heap...</li>
<li data-marpit-fragment="2">The <strong>pointer</strong> lives on the stack</li>
</ul>
</section>
</foreignObject><foreignObject width="1280" height="720" data-marpit-advanced-background="pseudo"><section data-marpit-fragments="2" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="24" style="" data-marpit-pagination-total="102" data-marpit-advanced-background="pseudo" data-marpit-advanced-background-split="right"></section></foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="25" data-marpit-fragments="2" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="25" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="boxt"><code>Box&lt;T&gt;</code></h1>
<p>The simplest form of heap allocation is <code>Box&lt;T&gt;</code>.</p>
<p>Moving a value from stack to heap:</p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-rust"><span class="hljs-keyword">let</span> <span class="hljs-variable">val</span>: <span class="hljs-type">u8</span> = <span class="hljs-number">5</span>;
<span class="hljs-keyword">let</span> <span class="hljs-variable">boxed</span>: <span class="hljs-type">Box</span>&lt;<span class="hljs-type">u8</span>&gt; = <span class="hljs-type">Box</span>::<span class="hljs-title function_ invoke__">new</span>(val);
</code></pre>
<ul>
<li data-marpit-fragment="1">Can access value by dereferencing box as <code>*boxed</code></li>
<li data-marpit-fragment="2">Value is automatically dropped when <code>boxed</code> goes out of scope</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="26" data-marpit-fragments="2" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="26" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="boxt-1"><code>Box&lt;T&gt;</code></h1>
<p>Let's put our <code>beef</code> array in a <code>Box</code>:</p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-rust"><span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-comment">// Renamed to `v`.</span>
    <span class="hljs-keyword">let</span> <span class="hljs-variable">v</span> = <span class="hljs-type">Box</span>::<span class="hljs-title function_ invoke__">new</span>([<span class="hljs-number">0xDEADBEEF</span>; HUGE_NUMBER]);
    <span class="hljs-title function_ invoke__">my_function</span>(v);
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">my_function</span>(arg: <span class="hljs-type">Box</span>&lt;[<span class="hljs-type">u32</span>]&gt;) {
    &lt;-- snip -<span class="hljs-punctuation">-&gt;</span>
}
</code></pre>
<ul>
<li data-marpit-fragment="1">In reality, this allocates <code>beef</code> on the stack and then copies it to the heap
<ul>
<li data-marpit-fragment="2">Use <code>Vec&lt;T&gt;</code> and convert to a boxed slice instead!</li>
</ul>
</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="27" style="--paginate:true;--theme:rust;--marpit-advanced-background-split:40%;" data-marpit-pagination-total="102" data-marpit-advanced-background="background" data-marpit-advanced-background-split="right"><div data-marpit-advanced-background-container="true" data-marpit-advanced-background-direction="horizontal"><figure style="background-image:url(&quot;../images/week8/frames/5.png&quot;);background-size:100%;"></figure></div></section></foreignObject><foreignObject width="60%" height="720"><section id="27" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="27" style="--paginate:true;--theme:rust;--marpit-advanced-background-split:40%;" data-marpit-pagination-total="102" data-marpit-advanced-background="content" data-marpit-advanced-background-split="right">
<h1 id="the-heap-3">The Heap</h1>

<p>When we call <code>my_function</code>, we can copy the <em>pointer</em> into <code>arg</code>!</p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-rust"><span class="hljs-keyword">let</span> <span class="hljs-variable">v</span> =
    <span class="hljs-type">Box</span>::<span class="hljs-title function_ invoke__">new</span>([<span class="hljs-number">0xDEADBEEF</span>; HUGE_NUMBER]);

<span class="hljs-title function_ invoke__">my_function</span>(beef);
</code></pre>
</section>
</foreignObject><foreignObject width="1280" height="720" data-marpit-advanced-background="pseudo"><section data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="27" style="" data-marpit-pagination-total="102" data-marpit-advanced-background="pseudo" data-marpit-advanced-background-split="right"></section></foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="28" style="--paginate:true;--theme:rust;--marpit-advanced-background-split:40%;" data-marpit-pagination-total="102" data-marpit-advanced-background="background" data-marpit-advanced-background-split="right"><div data-marpit-advanced-background-container="true" data-marpit-advanced-background-direction="horizontal"><figure style="background-image:url(&quot;../images/week8/frames/5.png&quot;);background-size:100%;"></figure></div></section></foreignObject><foreignObject width="60%" height="720"><section id="28" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="28" style="--paginate:true;--theme:rust;--marpit-advanced-background-split:40%;" data-marpit-pagination-total="102" data-marpit-advanced-background="content" data-marpit-advanced-background-split="right">
<h1 id="the-heap-4">The Heap</h1>

<p><strong>Before:</strong> 15 GB per array</p>
<p><strong>After:</strong> 15 GB + 8 bytes per pointer</p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-rust"><span class="hljs-keyword">let</span> <span class="hljs-variable">v</span> =
    <span class="hljs-type">Box</span>::<span class="hljs-title function_ invoke__">new</span>([<span class="hljs-number">0xDEADBEEF</span>; HUGE_NUMBER]);

<span class="hljs-title function_ invoke__">my_function</span>(beef);
<span class="hljs-title function_ invoke__">my_function</span>(beef);
<span class="hljs-title function_ invoke__">my_function</span>(beef);
<span class="hljs-title function_ invoke__">my_function</span>(beef);
<span class="hljs-title function_ invoke__">my_function</span>(beef);
<span class="hljs-title function_ invoke__">my_function</span>(beef);
<span class="hljs-title function_ invoke__">my_function</span>(beef);
<span class="hljs-title function_ invoke__">my_function</span>(beef);
<span class="hljs-title function_ invoke__">my_function</span>(beef);
<span class="hljs-title function_ invoke__">my_function</span>(beef);
</code></pre>
</section>
</foreignObject><foreignObject width="1280" height="720" data-marpit-advanced-background="pseudo"><section data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="28" style="" data-marpit-pagination-total="102" data-marpit-advanced-background="pseudo" data-marpit-advanced-background-split="right"></section></foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section data-marpit-fragments="2" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="29" style="--paginate:true;--theme:rust;--marpit-advanced-background-split:50%;" data-marpit-pagination-total="102" data-marpit-advanced-background="background" data-marpit-advanced-background-split="right"><div data-marpit-advanced-background-container="true" data-marpit-advanced-background-direction="vertical"><figure style="background-image:url(&quot;../images/week8/frames/0.png&quot;);background-size:30%;"></figure><figure style="background-image:url(&quot;../images/week8/frames/4.png&quot;);background-size:100%;"></figure></div></section></foreignObject><foreignObject width="50%" height="720"><section id="29" data-marpit-fragments="2" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="29" style="--paginate:true;--theme:rust;--marpit-advanced-background-split:50%;" data-marpit-pagination-total="102" data-marpit-advanced-background="content" data-marpit-advanced-background-split="right">
<h1 id="recap-stack-vs-heap">Recap: Stack vs. Heap</h1>

<p>Variable placement:</p>
<ul>
<li data-marpit-fragment="1"><strong>Stack-allocated:</strong> Data lives on the stack</li>
<li data-marpit-fragment="2"><strong>Heap-allocated:</strong> Data lives on the heap, the <strong>pointer</strong> on stack</li>
</ul>
</section>
</foreignObject><foreignObject width="1280" height="720" data-marpit-advanced-background="pseudo"><section data-marpit-fragments="2" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="29" style="" data-marpit-pagination-total="102" data-marpit-advanced-background="pseudo" data-marpit-advanced-background-split="right"></section></foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="30" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="30" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="recap-stack-vs-heap-1">Recap: Stack vs. Heap</h1>
<table>
<thead>
<tr>
<th>Comparison</th>
<th>Stack</th>
<th>Heap</th>
</tr>
</thead>
<tbody>
<tr>
<td>Manages</td>
<td>Scalar data + Pointers</td>
<td>Dynamically-sized / long-lived data</td>
</tr>
<tr>
<td>Allocated on</td>
<td>Function call</td>
<td>Programmer request</td>
</tr>
<tr>
<td>Deallocated on</td>
<td>Function return</td>
<td>???</td>
</tr>
</tbody>
</table>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="31" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="31" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="motivating-ownership">Motivating Ownership</h1>
<p>Recall that accessing <strong>deallocated</strong> memory is unsafe.</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="32" data-marpit-fragments="6" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="32" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="motivating-ownership-1">Motivating Ownership</h1>
<p>When is memory deallocated?</p>
<ul>
<li data-marpit-fragment="1">Stack: deallocated when the function returns
<ul>
<li data-marpit-fragment="2">Valid, unless dangling pointer <img class="emoji" draggable="false" alt="✅" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/2705.svg" data-marp-twemoji=""/>
<ul>
<li data-marpit-fragment="3">We'll discuss more in the upcoming Lifetimes lecture...</li>
</ul>
</li>
</ul>
</li>
<li data-marpit-fragment="4">Heap: deallocated when ???
<ul>
<li data-marpit-fragment="5"><img class="emoji" draggable="false" alt="⚠️" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/26a0.svg" data-marp-twemoji=""/></li>
<li data-marpit-fragment="6">How can we be confident that heap memory is deallocated safely?</li>
</ul>
</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section data-marpit-fragments="4" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="33" style="--paginate:true;--theme:rust;--marpit-advanced-background-split:50%;" data-marpit-pagination-total="102" data-marpit-advanced-background="background" data-marpit-advanced-background-split="right"><div data-marpit-advanced-background-container="true" data-marpit-advanced-background-direction="horizontal"><figure style="background-image:url(&quot;../images/week8/frames/0.png&quot;);background-size:50%;"></figure></div></section></foreignObject><foreignObject width="50%" height="720"><section id="33" data-marpit-fragments="4" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="33" style="--paginate:true;--theme:rust;--marpit-advanced-background-split:50%;" data-marpit-pagination-total="102" data-marpit-advanced-background="content" data-marpit-advanced-background-split="right">
<h1 id="motivating-ownership-2">Motivating Ownership</h1>

<p>Recall the behavior of local variables on the stack:</p>
<ul>
<li data-marpit-fragment="1">Local variable lives in the function's <strong>stack frame</strong></li>
<li data-marpit-fragment="2">Allocated on function call</li>
<li data-marpit-fragment="3">Deallocated on function return
<ul>
<li data-marpit-fragment="4">Sound familiar?</li>
</ul>
</li>
</ul>
</section>
</foreignObject><foreignObject width="1280" height="720" data-marpit-advanced-background="pseudo"><section data-marpit-fragments="4" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="33" style="" data-marpit-pagination-total="102" data-marpit-advanced-background="pseudo" data-marpit-advanced-background-split="right"></section></foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section data-marpit-fragments="3" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="34" style="--paginate:true;--theme:rust;--marpit-advanced-background-split:50%;" data-marpit-pagination-total="102" data-marpit-advanced-background="background" data-marpit-advanced-background-split="right"><div data-marpit-advanced-background-container="true" data-marpit-advanced-background-direction="horizontal"><figure style="background-image:url(&quot;../images/week8/frames/0.png&quot;);background-size:50%;"></figure></div></section></foreignObject><foreignObject width="50%" height="720"><section id="34" data-marpit-fragments="3" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="34" style="--paginate:true;--theme:rust;--marpit-advanced-background-split:50%;" data-marpit-pagination-total="102" data-marpit-advanced-background="content" data-marpit-advanced-background-split="right">
<h1 id="motivating-ownership-3">Motivating Ownership</h1>

<p>What if we say that data is <strong>&quot;owned&quot;</strong> by the stack frame?</p>
<ul>
<li data-marpit-fragment="1">One stack frame (owner) per variable</li>
<li data-marpit-fragment="2">Data is dropped on function return</li>
<li data-marpit-fragment="3">Very similar to our previous model of ownership!</li>
</ul>
</section>
</foreignObject><foreignObject width="1280" height="720" data-marpit-advanced-background="pseudo"><section data-marpit-fragments="3" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="34" style="" data-marpit-pagination-total="102" data-marpit-advanced-background="pseudo" data-marpit-advanced-background-split="right"></section></foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="35" data-marpit-fragments="6" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="35" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="rules-of-ownership-1">Rules of Ownership</h1>
<p>Under this alternate ownership model, owners are stack frames:</p>
<ul>
<li data-marpit-fragment="1">Each value in Rust has an <em>owner</em>
<ul>
<li data-marpit-fragment="2">Owner is the <em>stack frame</em></li>
</ul>
</li>
<li data-marpit-fragment="3">A value can have only one owner at a time
<ul>
<li data-marpit-fragment="4">Variables can only be in one stack frame</li>
</ul>
</li>
<li data-marpit-fragment="5">When the owner goes out of scope, the value will be <em>dropped</em>
<ul>
<li data-marpit-fragment="6">When the function returns, the stack frame is cleaned up!</li>
</ul>
</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="36" data-marpit-fragments="2" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="36" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="ownership-of-closures">Ownership of Closures</h1>
<p>Let's re-examine <strong>closures</strong> again using this new ownership model:</p>
<ul>
<li data-marpit-fragment="1">What does the <code>move</code> keyword really do?</li>
<li data-marpit-fragment="2">Why are captured values dropped when they are?</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="37" data-marpit-fragments="2" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="37" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="ownership-of-closures-1">Ownership of Closures</h1>
<p>When is <code>my_str</code> dropped? Who has ownership of it?</p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-rust"><span class="hljs-keyword">let</span> <span class="hljs-variable">my_str</span> = <span class="hljs-type">String</span>::<span class="hljs-title function_ invoke__">from</span>(<span class="hljs-string">&quot;x&quot;</span>);

<span class="hljs-keyword">let</span> <span class="hljs-variable">take_and_give_back</span> = <span class="hljs-keyword">move</span> || { my_str };

<span class="hljs-built_in">assert_eq!</span>(<span class="hljs-title function_ invoke__">take_and_give_back</span>(), <span class="hljs-string">&quot;x&quot;</span>);
</code></pre>
<ul>
<li data-marpit-fragment="1">In <code>take_and_give_back</code>, <code>my_str</code> is dropped the first time the closure is called
<ul>
<li data-marpit-fragment="2">Can only be called once</li>
</ul>
</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="38" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="38" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="closure-internals">Closure Internals</h1>
<p>When we create a closure...</p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-rust"><span class="hljs-keyword">let</span> <span class="hljs-variable">do_nothing_closure</span> = |_x| {};
</code></pre>
<p>Think of it as a struct with an associated function:</p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-rust"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Closure</span>;

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">Closure</span> {
    <span class="hljs-comment">//          vvvvv Notice the immutable reference to `self`!</span>
    <span class="hljs-keyword">pub</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">call</span>(&amp;<span class="hljs-keyword">self</span>, _x: &amp;<span class="hljs-type">str</span>) <span class="hljs-punctuation">-&gt;</span> () {}
}
</code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="39" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="39" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="closure-internals-1">Closure Internals</h1>
<p>The <code>move</code> keyword tells the closure to take ownership of values from its environment.</p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-rust"><span class="hljs-keyword">let</span> <span class="hljs-variable">take_and_give_back</span> = <span class="hljs-keyword">move</span> || { my_str };

<span class="hljs-comment">// The `move` keyword tells compiler to put `my_str` in this `Closure`.</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Closure</span> {
    my_str: <span class="hljs-type">String</span>,
}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">Closure</span> {
    <span class="hljs-comment">//          vvvv Notice the owned `self` type!</span>
    <span class="hljs-keyword">pub</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">call</span>(<span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">String</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>.my_str;
    }
}
</code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="40" data-marpit-fragments="2" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="40" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="closure-internals-2">Closure Internals</h1>
<p>Then our code is equivalent to</p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-rust"><span class="hljs-keyword">let</span> <span class="hljs-variable">my_str</span> = <span class="hljs-type">String</span>::<span class="hljs-title function_ invoke__">from</span>(<span class="hljs-string">&quot;x&quot;</span>);

<span class="hljs-keyword">let</span> <span class="hljs-variable">take_and_give_back</span> = Closure { my_str };
<span class="hljs-comment">//                                 ^^^^^^ `my_str` is moved!</span>

<span class="hljs-keyword">let</span> <span class="hljs-variable">my_returned_str</span>: <span class="hljs-type">String</span> = take_and_give_back.<span class="hljs-title function_ invoke__">call</span>();
</code></pre>
<ul>
<li data-marpit-fragment="1">What happens when we <code>call</code> on the <code>Closure</code>?
<ul>
<li data-marpit-fragment="2"><em>Think about the stack frames</em></li>
</ul>
</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="41" style="--paginate:true;--theme:rust;--marpit-advanced-background-split:50%;" data-marpit-pagination-total="102" data-marpit-advanced-background="background" data-marpit-advanced-background-split="right"><div data-marpit-advanced-background-container="true" data-marpit-advanced-background-direction="horizontal"><figure style="background-image:url(&quot;../images/week8/closures/closure0.png&quot;);background-size:100%;"></figure></div></section></foreignObject><foreignObject width="50%" height="720"><section id="41" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="41" style="--paginate:true;--theme:rust;--marpit-advanced-background-split:50%;" data-marpit-pagination-total="102" data-marpit-advanced-background="content" data-marpit-advanced-background-split="right">
<h1 id="closure-example">Closure Example</h1>

<p>First, <code>my_str</code> is moved into our <code>Closure</code>.</p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-rust"><span class="hljs-keyword">let</span> <span class="hljs-variable">my_str</span> = <span class="hljs-type">String</span>::<span class="hljs-title function_ invoke__">from</span>(<span class="hljs-string">&quot;x&quot;</span>);

<span class="hljs-keyword">let</span> <span class="hljs-variable">take_and_give_back</span> =
    Closure { my_str };
</code></pre>
</section>
</foreignObject><foreignObject width="1280" height="720" data-marpit-advanced-background="pseudo"><section data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="41" style="" data-marpit-pagination-total="102" data-marpit-advanced-background="pseudo" data-marpit-advanced-background-split="right"></section></foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="42" style="--paginate:true;--theme:rust;--marpit-advanced-background-split:50%;" data-marpit-pagination-total="102" data-marpit-advanced-background="background" data-marpit-advanced-background-split="right"><div data-marpit-advanced-background-container="true" data-marpit-advanced-background-direction="horizontal"><figure style="background-image:url(&quot;../images/week8/closures/closure1.png&quot;);background-size:100%;"></figure></div></section></foreignObject><foreignObject width="50%" height="720"><section id="42" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="42" style="--paginate:true;--theme:rust;--marpit-advanced-background-split:50%;" data-marpit-pagination-total="102" data-marpit-advanced-background="content" data-marpit-advanced-background-split="right">
<h1 id="closure-example-1">Closure Example</h1>

<p>Next, we call our closure, which gives ownership of <code>my_str</code> to <code>Closure::call</code>'s stack frame.</p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-rust"><span class="hljs-keyword">let</span> <span class="hljs-variable">my_str</span> = <span class="hljs-type">String</span>::<span class="hljs-title function_ invoke__">from</span>(<span class="hljs-string">&quot;x&quot;</span>);

<span class="hljs-keyword">let</span> <span class="hljs-variable">take_and_give_back</span> =
    Closure { my_str };

<span class="hljs-keyword">let</span> <span class="hljs-variable">my_returned_str</span> =
    take_and_give_back.<span class="hljs-title function_ invoke__">call</span>();
</code></pre>
</section>
</foreignObject><foreignObject width="1280" height="720" data-marpit-advanced-background="pseudo"><section data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="42" style="" data-marpit-pagination-total="102" data-marpit-advanced-background="pseudo" data-marpit-advanced-background-split="right"></section></foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="43" style="--paginate:true;--theme:rust;--marpit-advanced-background-split:50%;" data-marpit-pagination-total="102" data-marpit-advanced-background="background" data-marpit-advanced-background-split="right"><div data-marpit-advanced-background-container="true" data-marpit-advanced-background-direction="horizontal"><figure style="background-image:url(&quot;../images/week8/closures/closure2.png&quot;);background-size:100%;"></figure></div></section></foreignObject><foreignObject width="50%" height="720"><section id="43" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="43" style="--paginate:true;--theme:rust;--marpit-advanced-background-split:50%;" data-marpit-pagination-total="102" data-marpit-advanced-background="content" data-marpit-advanced-background-split="right">
<h1 id="closure-example-2">Closure Example</h1>

<p><code>Closure::call</code> gives ownership back to <code>main</code>'s stack frame...</p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-rust"><span class="hljs-keyword">pub</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">call</span>(<span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">String</span> {
    <span class="hljs-comment">// Gives ownership back!</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>.my_str;
}
</code></pre>
</section>
</foreignObject><foreignObject width="1280" height="720" data-marpit-advanced-background="pseudo"><section data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="43" style="" data-marpit-pagination-total="102" data-marpit-advanced-background="pseudo" data-marpit-advanced-background-split="right"></section></foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section data-marpit-fragments="3" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="44" style="--paginate:true;--theme:rust;--marpit-advanced-background-split:50%;" data-marpit-pagination-total="102" data-marpit-advanced-background="background" data-marpit-advanced-background-split="right"><div data-marpit-advanced-background-container="true" data-marpit-advanced-background-direction="horizontal"><figure style="background-image:url(&quot;../images/week8/closures/closure3.png&quot;);background-size:100%;"></figure></div></section></foreignObject><foreignObject width="50%" height="720"><section id="44" data-marpit-fragments="3" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="44" style="--paginate:true;--theme:rust;--marpit-advanced-background-split:50%;" data-marpit-pagination-total="102" data-marpit-advanced-background="content" data-marpit-advanced-background-split="right">
<h1 id="closure-example-3">Closure Example</h1>

<ul>
<li data-marpit-fragment="1"><code>Closure</code>'s <code>my_str</code> is invalidated</li>
<li data-marpit-fragment="2"><code>my_str</code> is moved out of <code>Closure</code>'s &quot;body&quot;
<ul>
<li data-marpit-fragment="3">This is why it can only be called once!</li>
</ul>
</li>
</ul>
</section>
</foreignObject><foreignObject width="1280" height="720" data-marpit-advanced-background="pseudo"><section data-marpit-fragments="3" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="44" style="" data-marpit-pagination-total="102" data-marpit-advanced-background="pseudo" data-marpit-advanced-background-split="right"></section></foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="45" data-marpit-fragments="6" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="45" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="recap-closure-internals">Recap: Closure Internals</h1>
<ul>
<li data-marpit-fragment="1">New way of thinking about ownership
<ul>
<li data-marpit-fragment="2">Owners are stack frames</li>
</ul>
</li>
<li data-marpit-fragment="3">A closure is really a function that stores (&quot;captures&quot;) values in a struct
<ul>
<li data-marpit-fragment="4">Ways to capture values:
<ul>
<li data-marpit-fragment="5"><strong>Taking ownership:</strong> Store the value in the struct, via <code>move</code> keyword</li>
<li data-marpit-fragment="6"><strong>Borrowing:</strong> Store a reference to the value in the struct</li>
</ul>
</li>
</ul>
</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="46" data-marpit-fragments="1" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="46" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="motivating-borrowing-rules"><strong>Motivating Borrowing Rules</strong></h1>
<ul>
<li data-marpit-fragment="1">Recall that accessing <strong>overwritten</strong> memory is unsafe</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section data-marpit-fragments="1" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="47" style="--paginate:true;--theme:rust;--marpit-advanced-background-split:25%;" data-marpit-pagination-total="102" data-marpit-advanced-background="background" data-marpit-advanced-background-split="right"><div data-marpit-advanced-background-container="true" data-marpit-advanced-background-direction="horizontal"><figure style="background-image:url(&quot;../images/ferris_does_not_compile.svg&quot;);background-size:75%;"></figure></div></section></foreignObject><foreignObject width="75%" height="720"><section id="47" data-marpit-fragments="1" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="47" style="--paginate:true;--theme:rust;--marpit-advanced-background-split:25%;" data-marpit-pagination-total="102" data-marpit-advanced-background="content" data-marpit-advanced-background-split="right">
<h1 id="vector-pop">Vector Pop</h1>

<p>Suppose we want to write this code.</p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-rust"><span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">v</span> = <span class="hljs-built_in">vec!</span>[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>];

<span class="hljs-keyword">let</span> <span class="hljs-variable">x</span> = &amp;v[<span class="hljs-number">3</span>]; <span class="hljs-comment">// Get a reference to the last element</span>

v.<span class="hljs-title function_ invoke__">pop</span>(); <span class="hljs-comment">// Remove the last element in `v`</span>

<span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;{}&quot;</span>, x); <span class="hljs-comment">// What is `x`?</span>
</code></pre>
<ul>
<li data-marpit-fragment="1">What do you think the compiler will say?</li>
</ul>
</section>
</foreignObject><foreignObject width="1280" height="720" data-marpit-advanced-background="pseudo"><section data-marpit-fragments="1" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="47" style="" data-marpit-pagination-total="102" data-marpit-advanced-background="pseudo" data-marpit-advanced-background-split="right"></section></foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="48" data-marpit-fragments="2" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="48" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="vector-pop-1">Vector Pop</h1>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code>error[E0502]: cannot borrow `v` as mutable because it is also borrowed as immutable
 --&gt; src/main.rs:6:5
  |
4 |     let x = &amp;v[3]; // Get a reference to the last element
  |              - immutable borrow occurs here
5 |
6 |     v.pop(); // Remove the last element in `v`
  |     ^^^^^^^ mutable borrow occurs here
7 |
8 |     println!(&quot;{}&quot;, x); // What is `x`?
  |                    - immutable borrow later used here
</code></pre>
<ul>
<li data-marpit-fragment="1"><code>x</code> is invalid! <code>&amp;v[3]</code> could now be any value ⇒ undefined behavior</li>
<li data-marpit-fragment="2">We cannot mutate a value that someone else is borrowing</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section data-marpit-fragments="1" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="49" style="--paginate:true;--theme:rust;--marpit-advanced-background-split:25%;" data-marpit-pagination-total="102" data-marpit-advanced-background="background" data-marpit-advanced-background-split="right"><div data-marpit-advanced-background-container="true" data-marpit-advanced-background-direction="horizontal"><figure style="background-image:url(&quot;../images/ferris_does_not_compile.svg&quot;);background-size:75%;"></figure></div></section></foreignObject><foreignObject width="75%" height="720"><section id="49" data-marpit-fragments="1" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="49" style="--paginate:true;--theme:rust;--marpit-advanced-background-split:25%;" data-marpit-pagination-total="102" data-marpit-advanced-background="content" data-marpit-advanced-background-split="right">
<h1 id="vector-push">Vector Push</h1>

<p>What if instead of removing the last element, we <em>add</em> an element to the end?</p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-rust"><span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">v</span> = <span class="hljs-built_in">vec!</span>[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>];

<span class="hljs-keyword">let</span> <span class="hljs-variable">x</span> = &amp;v[<span class="hljs-number">3</span>]; <span class="hljs-comment">// Get a reference to the last element</span>

v.<span class="hljs-title function_ invoke__">push</span>(<span class="hljs-number">5</span>); <span class="hljs-comment">// Instead of popping, let&#x27;s push!</span>

<span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;{}&quot;</span>, x); <span class="hljs-comment">// What is `x`?</span>
</code></pre>
<ul>
<li data-marpit-fragment="1">Surely nothing will happen to <code>x</code> this time?</li>
</ul>
</section>
</foreignObject><foreignObject width="1280" height="720" data-marpit-advanced-background="pseudo"><section data-marpit-fragments="1" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="49" style="" data-marpit-pagination-total="102" data-marpit-advanced-background="pseudo" data-marpit-advanced-background-split="right"></section></foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="50" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="50" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="vector-push-1">Vector Push</h1>
<p>Why isn't this okay???</p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code>error[E0502]: cannot borrow `v` as mutable because it is also borrowed as immutable
 --&gt; src/main.rs:6:5
  |
4 |     let x = &amp;v[3]; // Get a reference to the last element
  |              - immutable borrow occurs here
5 |
6 |     v.push(5); // Instead of popping, let's push!
  |     ^^^^^^^^^ mutable borrow occurs here
7 |
8 |     println!(&quot;{}&quot;, x); // What is `x`?
  |                    - immutable borrow later used here
</code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section data-marpit-fragments="1" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="51" style="--paginate:true;--theme:rust;--marpit-advanced-background-split:50%;" data-marpit-pagination-total="102" data-marpit-advanced-background="background" data-marpit-advanced-background-split="right"><div data-marpit-advanced-background-container="true" data-marpit-advanced-background-direction="horizontal"><figure style="background-image:url(&quot;../images/String_layout.svg&quot;);background-size:90%;"></figure></div></section></foreignObject><foreignObject width="50%" height="720"><section id="51" data-marpit-fragments="1" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="51" style="--paginate:true;--theme:rust;--marpit-advanced-background-split:50%;" data-marpit-pagination-total="102" data-marpit-advanced-background="content" data-marpit-advanced-background-split="right">
<h1 id="vector-layout">Vector Layout</h1>

<p>Recall that vectors are <em>dynamic arrays</em>.</p>
<ul>
<li data-marpit-fragment="1"><em>This is technically a <code>String</code>, but recall that <code>String</code> is implemented with a <code>Vec&lt;u8&gt;</code></em></li>
</ul>
</section>
</foreignObject><foreignObject width="1280" height="720" data-marpit-advanced-background="pseudo"><section data-marpit-fragments="1" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="51" style="" data-marpit-pagination-total="102" data-marpit-advanced-background="pseudo" data-marpit-advanced-background-split="right"></section></foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section data-marpit-fragments="6" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="52" style="--paginate:true;--theme:rust;--marpit-advanced-background-split:35%;" data-marpit-pagination-total="102" data-marpit-advanced-background="background" data-marpit-advanced-background-split="right"><div data-marpit-advanced-background-container="true" data-marpit-advanced-background-direction="horizontal"><figure style="background-image:url(&quot;../images/String_layout.svg&quot;);background-size:95%;"></figure></div></section></foreignObject><foreignObject width="65%" height="720"><section id="52" data-marpit-fragments="6" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="52" style="--paginate:true;--theme:rust;--marpit-advanced-background-split:35%;" data-marpit-pagination-total="102" data-marpit-advanced-background="content" data-marpit-advanced-background-split="right">
<h1 id="mutating-vectors">Mutating Vectors</h1>

<ul>
<li data-marpit-fragment="1">What if pushing <code>5</code> onto <code>v</code> triggers a resize?</li>
<li data-marpit-fragment="2">Resizing means:
<ul>
<li data-marpit-fragment="3">Allocate new memory for <code>v</code></li>
<li data-marpit-fragment="4">Copy data to new location</li>
<li data-marpit-fragment="5"><strong>Deallocate old memory location</strong></li>
</ul>
</li>
<li data-marpit-fragment="6"><code>x</code> would no longer point to valid memory!</li>
</ul>
</section>
</foreignObject><foreignObject width="1280" height="720" data-marpit-advanced-background="pseudo"><section data-marpit-fragments="6" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="52" style="" data-marpit-pagination-total="102" data-marpit-advanced-background="pseudo" data-marpit-advanced-background-split="right"></section></foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="53" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="53" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="mutating-vectors-1">Mutating Vectors</h1>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code>error[E0502]: cannot borrow `v` as mutable because it is also borrowed as immutable
 --&gt; src/main.rs:6:5
  |
4 |     let x = &amp;v[3]; // Get a reference to the last element
  |              - immutable borrow occurs here
5 |
6 |     v.push(5); // Instead of popping, let's push!
  |     ^^^^^^^^^ mutable borrow occurs here
7 |
8 |     println!(&quot;{}&quot;, x); // What is `x`?
  |                    - immutable borrow later used here
</code></pre>
<p>Even though this error may seem unreasonable, the borrow checker is actually preventing you from making a hard-to-find mistake!</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="54" data-marpit-fragments="2" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="54" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="we-know-better">We Know Better...</h1>
<p>What if you knew that this <code>push</code> doesn't resize?</p>
<ul>
<li data-marpit-fragment="1">You as the programmer have vetted the implementation of <code>push</code></li>
<li data-marpit-fragment="2">You can <em>guarantee</em> that resizing only happens with more elements</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="55" data-marpit-fragments="2" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="55" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="sneak-peek-unsafe">Sneak Peek: <code>unsafe</code></h1>
<p>You can use an <code>unsafe</code> block to tell the compiler that you know better.</p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-rust"><span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">v</span>: <span class="hljs-type">Vec</span>&lt;<span class="hljs-type">i32</span>&gt; = <span class="hljs-built_in">vec!</span>[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>];
<span class="hljs-comment">// SAFETY: We know that `v` has 4 elements, so adding `3 * size_of::&lt;i32&gt;()`</span>
<span class="hljs-comment">// cannot overflow (wrap around the address space).</span>
<span class="hljs-keyword">let</span> <span class="hljs-variable">p</span>: *<span class="hljs-keyword">const</span> <span class="hljs-type">i32</span> = <span class="hljs-keyword">unsafe</span> { v.<span class="hljs-title function_ invoke__">as_ptr</span>().<span class="hljs-title function_ invoke__">add</span>(<span class="hljs-number">3</span>) };

v.<span class="hljs-title function_ invoke__">push</span>(<span class="hljs-number">5</span>);

<span class="hljs-comment">// SAFETY: We have checked that a resize will never happen with only</span>
<span class="hljs-comment">// 5 elements, so this dereference is safe.</span>
<span class="hljs-keyword">let</span> <span class="hljs-variable">elem</span>: <span class="hljs-type">i32</span> = <span class="hljs-keyword">unsafe</span> { *p };
<span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;{}&quot;</span>, elem);
</code></pre>
<ul>
<li data-marpit-fragment="1">Think of <code>unsafe</code> blocks as &quot;trust me bro&quot; blocks</li>
<li data-marpit-fragment="2">We will talk about <code>unsafe</code> in a few weeks!</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="56" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="56" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<p>Note that this is what the <code>unsafe</code> code should <em>really</em> look like:</p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-rust"><span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">v</span>: <span class="hljs-type">Vec</span>&lt;<span class="hljs-type">i32</span>&gt; = <span class="hljs-built_in">vec!</span>[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>];

<span class="hljs-comment">// SAFETY: We know that `v` has 4 valid elements, which means that the pointers at</span>
<span class="hljs-comment">// offsets +1, +2, and +3 are all valid pointers that point to values of type `i32`.</span>
<span class="hljs-comment">// This also means it cannot be the case that adding `3 * size_of::&lt;i32&gt;()` to</span>
<span class="hljs-comment">// `v.as_ptr()` overflows, otherwise that last element could not even exist in the</span>
<span class="hljs-comment">// first place. With these two guarantees, we fulfill `add`&#x27;s safety contract.</span>
<span class="hljs-keyword">let</span> <span class="hljs-variable">p</span>: *<span class="hljs-keyword">const</span> <span class="hljs-type">i32</span> = <span class="hljs-keyword">unsafe</span> { v.<span class="hljs-title function_ invoke__">as_ptr</span>().<span class="hljs-title function_ invoke__">add</span>(<span class="hljs-number">3</span>) };

v.<span class="hljs-title function_ invoke__">push</span>(<span class="hljs-number">5</span>);

<span class="hljs-comment">// SAFETY: We showed above that `p` was a valid pointer to an `i32` value. We have</span>
<span class="hljs-comment">// also checked in the code of `Vec::push` that a resize and reallocation</span>
<span class="hljs-comment">// **cannot** happen when there are only 5 elements. So since there is no</span>
<span class="hljs-comment">// reallocation, and `v` is still in scope (so the memory has not been freed), this</span>
<span class="hljs-comment">// dereference of `p` to an `i32` value is valid.</span>
<span class="hljs-keyword">let</span> <span class="hljs-variable">elem</span>: <span class="hljs-type">i32</span> = <span class="hljs-keyword">unsafe</span> { *p };

<span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;{}&quot;</span>, elem);
</code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="57" data-marpit-fragments="3" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="57" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="unsafe-vs-borrow-checking"><code>unsafe</code> vs. Borrow Checking</h1>
<p>You should <em>never</em> resort to using <code>unsafe</code> just to get past the borrow checker.</p>
<ul>
<li data-marpit-fragment="1"><code>unsafe</code> should be used sparingly and intentionally</li>
<li data-marpit-fragment="2">You must understand <em>why</em> you need to bypass the borrow checker</li>
<li data-marpit-fragment="3">Therefore, you <em>must</em> understand the borrow checker!</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="58" data-marpit-fragments="3" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="58" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="the-borrow-checker">The Borrow Checker</h1>
<p>The Borrow Checker prevents you from writing unsafe code.</p>
<p>This leads to some questions:</p>
<ul>
<li data-marpit-fragment="1">How do I know if my program is unsafe?
<ul>
<li data-marpit-fragment="2">How did the borrow checker conclude this?</li>
</ul>
</li>
<li data-marpit-fragment="3">How can I tell if my program is safe even if the borrow checker rejects it?</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="59" data-marpit-fragments="4" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="59" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="unveiling-the-borrow-checker">Unveiling the Borrow Checker</h1>
<blockquote>
<p>&quot;His blade works so smoothly that the ox does not feel it.&quot; - The Dextrous Butcher</p>
</blockquote>
<ul>
<li data-marpit-fragment="1">Understand the borrow checker, and you'll speak its language fluently:
<ul>
<li data-marpit-fragment="2">&quot;My program is unsafe, and here's how I'll fix it&quot;</li>
<li data-marpit-fragment="3">And occasionally...
<ul>
<li data-marpit-fragment="4">&quot;My program is actually safe, let me tell you why&quot;</li>
</ul>
</li>
</ul>
</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="60" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="60" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="permissions"><strong>Permissions</strong></h1>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="61" data-marpit-fragments="1" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="61" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="permissions-of-places">Permissions of Places</h1>
<p>Denote the left side of assignments as <strong>places</strong>.</p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-rust"><span class="hljs-keyword">let</span> <span class="hljs-variable">x</span> = &amp;v[<span class="hljs-number">3</span>];
<span class="hljs-comment">//  ^ place</span>
</code></pre>
<ul>
<li data-marpit-fragment="1">The borrow checker checks the permissions of <strong>places</strong></li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="62" data-marpit-fragments="5" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="62" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="permissions-of-places-1">Permissions of Places</h1>
<p>Places include:</p>
<ul>
<li data-marpit-fragment="1">Variables, like <code>a</code></li>
<li data-marpit-fragment="2">Dereferences of places, like <code>*a</code></li>
<li data-marpit-fragment="3">Array accesses of places, like <code>a[0]</code></li>
<li data-marpit-fragment="4">Fields of places, like <code>a.0</code>, <code>a.field</code></li>
<li data-marpit-fragment="5">Any combination of the above, like <code>*a.x[i].y</code></li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="63" data-marpit-fragments="3" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="63" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="permissions-of-variables">Permissions of Variables</h1>
<p>When declared, a variable has the permissions:</p>
<ul>
<li data-marpit-fragment="1">Read: can be copied</li>
<li data-marpit-fragment="2">Write: can be mutated (if declared with <code>mut</code>)</li>
<li data-marpit-fragment="3">Own: can be moved or dropped</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="64" data-marpit-fragments="2" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="64" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="references-and-permissions">References and Permissions</h1>
<ul>
<li data-marpit-fragment="1">Variables have the permissions Read (<strong>R</strong>), Write (<strong>W</strong>), and Own (<strong>O</strong>)</li>
<li data-marpit-fragment="2">Using references can <em>temporarily remove these permissions</em></li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="65" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="65" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="example-immutable-references">Example: Immutable References</h1>
<p>Let's revisit our vector pop example.</p>
<div class = "container">
<div class = "col">
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-rust"><span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">v</span> = <span class="hljs-built_in">vec!</span>[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>];
</code></pre>
</div>
<div class = "col">
<table>
<thead>
<tr>
<th>Place</th>
<th>R</th>
<th>W</th>
<th>O</th>
</tr>
</thead>
<tbody>
<tr>
<td>v</td>
<td>?</td>
<td>?</td>
<td>?</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="66" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="66" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="example-immutable-references-1">Example: Immutable References</h1>
<div class = "container">
<div class = "col">
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-rust"><span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">v</span> = <span class="hljs-built_in">vec!</span>[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>];
</code></pre>
</div>
<div class = "col">
<table>
<thead>
<tr>
<th>Place</th>
<th>R</th>
<th>W</th>
<th>O</th>
</tr>
</thead>
<tbody>
<tr>
<td>v</td>
<td>?</td>
<td>?</td>
<td>?</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>We declare <code>v</code>, giving it:</p>
<ul>
<li>?</li>
<li>?</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="67" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="67" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="example-immutable-references-2">Example: Immutable References</h1>
<div class = "container">
<div class = "col">
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-rust"><span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">v</span> = <span class="hljs-built_in">vec!</span>[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>]; <span class="hljs-comment">// &lt;-</span>
</code></pre>
</div>
<div class = "col">
<table>
<thead>
<tr>
<th>Place</th>
<th>R</th>
<th>W</th>
<th>O</th>
</tr>
</thead>
<tbody>
<tr>
<td>v</td>
<td><strong>+R</strong></td>
<td>?</td>
<td><strong>+O</strong></td>
</tr>
</tbody>
</table>
</div>
</div>
<p>We declare <code>v</code>, giving it:</p>
<ul>
<li>R, O due to variable declaration</li>
<li>?</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="68" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="68" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="example-immutable-references-3">Example: Immutable References</h1>
<div class = "container">
<div class = "col">
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-rust"><span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">v</span> = <span class="hljs-built_in">vec!</span>[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>]; <span class="hljs-comment">// &lt;-</span>
</code></pre>
</div>
<div class = "col">
<table>
<thead>
<tr>
<th>Place</th>
<th>R</th>
<th>W</th>
<th>O</th>
</tr>
</thead>
<tbody>
<tr>
<td>v</td>
<td>+R</td>
<td><strong>+W</strong></td>
<td>+O</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>We declare <code>v</code>, giving it:</p>
<ul>
<li>R, O due to variable declaration</li>
<li>W because <code>mut</code></li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="69" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="69" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="example-immutable-references-4">Example: Immutable References</h1>
<div class = "container">
<div class = "col">
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-rust"><span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">v</span> = <span class="hljs-built_in">vec!</span>[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>];

<span class="hljs-keyword">let</span> <span class="hljs-variable">x</span> = &amp;v[<span class="hljs-number">3</span>]; <span class="hljs-comment">// &lt;-</span>
</code></pre>
</div>
<div class = "col">
<table>
<thead>
<tr>
<th>Place</th>
<th>R</th>
<th>W</th>
<th>O</th>
</tr>
</thead>
<tbody>
<tr>
<td>v</td>
<td>R</td>
<td>W</td>
<td>O</td>
</tr>
<tr>
<td>x</td>
<td>?</td>
<td>-</td>
<td>?</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>When we create a reference <code>x</code> to <code>v</code>, we:</p>
<ul>
<li>?</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="70" data-marpit-fragments="2" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="70" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="example-immutable-references-5">Example: Immutable References</h1>
<div class = "container">
<div class = "col">
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-rust"><span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">v</span> = <span class="hljs-built_in">vec!</span>[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>];

<span class="hljs-keyword">let</span> <span class="hljs-variable">x</span> = &amp;v[<span class="hljs-number">3</span>]; <span class="hljs-comment">// &lt;- x gets R, O</span>
</code></pre>
</div>
<div class = "col">
<table>
<thead>
<tr>
<th>Place</th>
<th>R</th>
<th>W</th>
<th>O</th>
</tr>
</thead>
<tbody>
<tr>
<td>v</td>
<td>R</td>
<td>W</td>
<td>O</td>
</tr>
<tr>
<td>x</td>
<td><strong>+R</strong></td>
<td>-</td>
<td><strong>+O</strong></td>
</tr>
</tbody>
</table>
</div>
</div>
<p>When we create a reference <code>x</code> to <code>v</code>, we:</p>
<ul>
<li>Give <code>x</code> R, O due to variable declaration
<ul>
<li data-marpit-fragment="1">We can think of <code>v</code> &quot;giving&quot; R to <code>x</code></li>
<li data-marpit-fragment="2"><code>x</code>'s permissions are for the <em>reference</em>, not the data it is referring to</li>
</ul>
</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="71" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="71" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="example-immutable-references-6">Example: Immutable References</h1>
<div class = "container">
<div class = "col">
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-rust"><span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">v</span> = <span class="hljs-built_in">vec!</span>[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>];

<span class="hljs-keyword">let</span> <span class="hljs-variable">x</span> = &amp;v[<span class="hljs-number">3</span>]; <span class="hljs-comment">// &lt;-</span>
</code></pre>
</div>
<div class = "col">
<table>
<thead>
<tr>
<th>Place</th>
<th>R</th>
<th>W</th>
<th>O</th>
</tr>
</thead>
<tbody>
<tr>
<td>v</td>
<td>R</td>
<td>W?</td>
<td>O?</td>
</tr>
<tr>
<td>x</td>
<td>R</td>
<td>-</td>
<td>O</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Creating a reference <code>x</code> to <code>v</code> also changes the permissions of <code>v</code>:</p>
<ul>
<li>?</li>
<li>?</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="72" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="72" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="example-immutable-references-7">Example: Immutable References</h1>
<div class = "container">
<div class = "col">
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-rust"><span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">v</span> = <span class="hljs-built_in">vec!</span>[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>];

<span class="hljs-keyword">let</span> <span class="hljs-variable">x</span> = &amp;v[<span class="hljs-number">3</span>]; <span class="hljs-comment">// &lt;- v loses W</span>
</code></pre>
</div>
<div class = "col">
<table>
<thead>
<tr>
<th>Place</th>
<th>R</th>
<th>W</th>
<th>O</th>
</tr>
</thead>
<tbody>
<tr>
<td>v</td>
<td>R</td>
<td>W?</td>
<td><strong>-</strong></td>
</tr>
<tr>
<td>x</td>
<td>R</td>
<td>-</td>
<td>O</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Creating a reference <code>x</code> to <code>v</code> also changes the permissions of <code>v</code>:</p>
<ul>
<li>Removes W</li>
<li>?</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="73" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="73" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="example-immutable-references-8">Example: Immutable References</h1>
<div class = "container">
<div class = "col">
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-rust"><span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">v</span> = <span class="hljs-built_in">vec!</span>[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>];

<span class="hljs-keyword">let</span> <span class="hljs-variable">x</span> = &amp;v[<span class="hljs-number">3</span>]; <span class="hljs-comment">// &lt;- v loses W, O</span>
</code></pre>
</div>
<div class = "col">
<table>
<thead>
<tr>
<th>Place</th>
<th>R</th>
<th>W</th>
<th>O</th>
</tr>
</thead>
<tbody>
<tr>
<td>v</td>
<td>R</td>
<td><strong>-</strong></td>
<td>-</td>
</tr>
<tr>
<td>x</td>
<td>R</td>
<td>-</td>
<td>O</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Creating a reference <code>x</code> to <code>v</code> also changes the permissions of <code>v</code>:</p>
<ul>
<li>Removes W</li>
<li>Removes O</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="74" data-marpit-fragments="3" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="74" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="example-immutable-references-9">Example: Immutable References</h1>
<div class = "container">
<div class = "col">
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-rust"><span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">v</span> = <span class="hljs-built_in">vec!</span>[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>];

<span class="hljs-keyword">let</span> <span class="hljs-variable">x</span> = &amp;v[<span class="hljs-number">3</span>];

<span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;{}&quot;</span>, *x); <span class="hljs-comment">// &lt;-</span>
</code></pre>
</div>
<div class = "col">
<table>
<thead>
<tr>
<th>Place</th>
<th>R</th>
<th>W</th>
<th>O</th>
</tr>
</thead>
<tbody>
<tr>
<td>v</td>
<td>R</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>x</td>
<td>R</td>
<td>-</td>
<td>O</td>
</tr>
<tr>
<td>*x</td>
<td>R</td>
<td>-</td>
<td>-</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>We can access what our reference <code>x</code> is referring by dereferencing it as <code>*x</code>.</p>
<ul>
<li data-marpit-fragment="1"><code>*x</code>'s permissions are different from <code>x</code>'s!</li>
<li data-marpit-fragment="2">Can only dereference if <code>*x</code> has R permissions</li>
<li data-marpit-fragment="3"><code>*x</code> can only have R if <code>v</code> has R</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="75" data-marpit-fragments="3" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="75" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="example-immutable-references-10">Example: Immutable References</h1>
<div class = "container">
<div class = "col">
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-rust"><span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">v</span> = <span class="hljs-built_in">vec!</span>[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>];

<span class="hljs-keyword">let</span> <span class="hljs-variable">x</span> = &amp;v[<span class="hljs-number">3</span>];

<span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;{}&quot;</span>, *x); <span class="hljs-comment">// &lt;-</span>
</code></pre>
</div>
<div class = "col">
<table>
<thead>
<tr>
<th>Place</th>
<th>R</th>
<th>W</th>
<th>O</th>
</tr>
</thead>
<tbody>
<tr>
<td>v</td>
<td>R</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>x</td>
<td>R</td>
<td>-</td>
<td>O</td>
</tr>
<tr>
<td>*x</td>
<td>R</td>
<td>-</td>
<td>-</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>We can no longer mutate <code>v</code>, since we created a reference <code>x</code> to it.</p>
<p>When does <code>v</code> regain W, O? Either:</p>
<ul>
<li data-marpit-fragment="1">All references become unused (Case 1)</li>
<li data-marpit-fragment="2">Mutate <code>v</code> before <em>any</em> reference is used (Case 2)
<ul>
<li data-marpit-fragment="3">Revokes permissions of references</li>
</ul>
</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="76" data-marpit-fragments="3" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="76" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="example-immutable-references-11">Example: Immutable References</h1>
<div class = "container">
<div class = "col">
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-rust"><span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">v</span> = <span class="hljs-built_in">vec!</span>[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>];

<span class="hljs-keyword">let</span> <span class="hljs-variable">x</span> = &amp;v[<span class="hljs-number">3</span>];

v.<span class="hljs-title function_ invoke__">pop</span>(); <span class="hljs-comment">// &lt;- v revokes x&#x27;s permissions</span>
</code></pre>
</div>
<div class = "col">
<table>
<thead>
<tr>
<th>Place</th>
<th>R</th>
<th>W</th>
<th>O</th>
</tr>
</thead>
<tbody>
<tr>
<td>v</td>
<td>R</td>
<td><strong>+W</strong></td>
<td><strong>+O</strong></td>
</tr>
<tr>
<td>x</td>
<td><strong>-</strong></td>
<td>-</td>
<td><strong>-</strong></td>
</tr>
<tr>
<td>*x</td>
<td><strong>-</strong></td>
<td>-</td>
<td>-</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>This <code>v.pop()</code> is safe (Case 2).</p>
<ul>
<li data-marpit-fragment="1"><code>v</code> requests W before any references are used (Case 2)
<ul>
<li data-marpit-fragment="2"><code>v</code> regains W, O, <em>revokes permissions of all references</em></li>
<li data-marpit-fragment="3">Temporarily: <code>x</code> loses R and O, <code>*x</code> loses R</li>
</ul>
</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="77" data-marpit-fragments="3" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="77" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="example-immutable-references-12">Example: Immutable References</h1>
<div class = "container">
<div class = "col">
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-rust"><span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">v</span> = <span class="hljs-built_in">vec!</span>[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>];

<span class="hljs-keyword">let</span> <span class="hljs-variable">x</span> = &amp;v[<span class="hljs-number">3</span>];

<span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;{}&quot;</span>, *x); <span class="hljs-comment">// Requires R on *x</span>

<span class="hljs-comment">// x and *x lose all permissions</span>

v.<span class="hljs-title function_ invoke__">pop</span>(); <span class="hljs-comment">// &lt;- v regains W and O</span>
</code></pre>
</div>
<div class = "col">
<table>
<thead>
<tr>
<th>Place</th>
<th>R</th>
<th>W</th>
<th>O</th>
</tr>
</thead>
<tbody>
<tr>
<td>v</td>
<td>R</td>
<td><strong>+W</strong></td>
<td><strong>+O</strong></td>
</tr>
<tr>
<td>x</td>
<td><strong>-</strong></td>
<td>-</td>
<td><strong>-</strong></td>
</tr>
<tr>
<td>*x</td>
<td><strong>-</strong></td>
<td>-</td>
<td>-</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>This <code>v.pop()</code> is also safe (Case 1)!</p>
<ul>
<li data-marpit-fragment="1"><code>v</code> requests W after all references become unused (Case 1)
<ul>
<li data-marpit-fragment="2">Permanently: <code>x</code> loses R and O, <code>*x</code> loses R</li>
<li data-marpit-fragment="3"><code>v</code> regains W, O</li>
</ul>
</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="78" data-marpit-fragments="1" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="78" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="example-immutable-references-13">Example: Immutable References</h1>
<p>However, we cannot access <code>*x</code> anymore, as its permissions have been revoked.</p>
<div class = "container">
<div class = "col">
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-rust"><span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">v</span> = <span class="hljs-built_in">vec!</span>[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>];

<span class="hljs-keyword">let</span> <span class="hljs-variable">x</span> = &amp;v[<span class="hljs-number">3</span>];

v.<span class="hljs-title function_ invoke__">pop</span>(); <span class="hljs-comment">// Revokes permissions!</span>

<span class="hljs-comment">// THIS DOES NOT COMPILE!!!</span>
<span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;{}&quot;</span>, *x); <span class="hljs-comment">// Requires R on *x</span>
</code></pre>
</div>
<div class = "col">
<table>
<thead>
<tr>
<th>Place</th>
<th>R</th>
<th>W</th>
<th>O</th>
</tr>
</thead>
<tbody>
<tr>
<td>v</td>
<td>R</td>
<td>W</td>
<td>O</td>
</tr>
<tr>
<td>x</td>
<td>R</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>*x</td>
<td><strong>-</strong></td>
<td>-</td>
<td>-</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li data-marpit-fragment="1">This code causes an error because we don't have permissions on <code>*x</code></li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="79" data-marpit-fragments="7" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="79" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="recap-immutable-references">Recap: Immutable References</h1>
<ul>
<li data-marpit-fragment="1">Declaring a variable <code>v</code> gives it R, O permissions, W if <code>mut</code></li>
<li data-marpit-fragment="2">Creating an immutable reference <code>x</code> to <code>v</code>
<ul>
<li data-marpit-fragment="3">Gives <code>x</code> R, O permissions</li>
<li data-marpit-fragment="4">Removes <code>v</code>'s W, O permissions</li>
</ul>
</li>
<li data-marpit-fragment="5">Permissions are restored when either:
<ul>
<li data-marpit-fragment="6">References become <strong>unused</strong></li>
<li data-marpit-fragment="7">We mutate <code>v</code> <em>before</em> any reference is used</li>
</ul>
</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="80" data-marpit-fragments="5" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="80" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="mutable-references">Mutable References</h1>
<ul>
<li data-marpit-fragment="1"><strong><code>x</code> and <code>*x</code> have different permissions</strong>
<ul>
<li data-marpit-fragment="2">Notice how revoking permissions removes R from <code>*x</code>, but <em>keeps</em> R on <code>x</code></li>
<li data-marpit-fragment="3">We can create as many references as we want...
<ul>
<li data-marpit-fragment="4">We just can't <em>access</em> them without the correct permissions</li>
</ul>
</li>
</ul>
</li>
<li data-marpit-fragment="5">Mutable references further illustrate this</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="81" data-marpit-fragments="4" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="81" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="example-mutable-references">Example: Mutable References</h1>
<div class = "container">
<div class = "col">
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-rust"><span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">v</span> = <span class="hljs-built_in">vec!</span>[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>];

<span class="hljs-keyword">let</span> <span class="hljs-variable">x</span> = &amp;v[<span class="hljs-number">3</span>]; <span class="hljs-comment">// &lt;-</span>
</code></pre>
</div>
<div class = "col">
<table>
<thead>
<tr>
<th>Place</th>
<th>R</th>
<th>W</th>
<th>O</th>
</tr>
</thead>
<tbody>
<tr>
<td>v</td>
<td>R</td>
<td><strong>-</strong></td>
<td><strong>-</strong></td>
</tr>
<tr>
<td>x</td>
<td>R</td>
<td>-</td>
<td>O</td>
</tr>
<tr>
<td>*x</td>
<td><strong>R</strong></td>
<td>-</td>
<td>-</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Recall that when we create an immutable reference <code>x = &amp;v[3]</code>:</p>
<ul>
<li data-marpit-fragment="1"><code>v</code> loses W and O permissions
<ul>
<li data-marpit-fragment="2"><code>v</code> gives <code>x</code> R</li>
</ul>
</li>
<li data-marpit-fragment="3"><code>x</code> gains R and O permissions</li>
<li data-marpit-fragment="4"><code>*x</code> gains R permissions</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="82" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="82" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="example-mutable-references-1">Example: Mutable References</h1>
<div class = "container">
<div class = "col">
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-rust"><span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">v</span> = <span class="hljs-built_in">vec!</span>[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>];

<span class="hljs-keyword">let</span> <span class="hljs-variable">x</span> = &amp;<span class="hljs-keyword">mut</span> v[<span class="hljs-number">3</span>]; <span class="hljs-comment">// &lt;-</span>
<span class="hljs-comment">//      ^^^^</span>
</code></pre>
</div>
<div class = "col">
<table>
<thead>
<tr>
<th>Place</th>
<th>R</th>
<th>W</th>
<th>O</th>
</tr>
</thead>
<tbody>
<tr>
<td>v</td>
<td>R?</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>x</td>
<td>R</td>
<td>-</td>
<td>O</td>
</tr>
<tr>
<td>*x</td>
<td>R</td>
<td>-?</td>
<td>-</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>However, when <code>x</code> is a mutable reference:</p>
<ul>
<li>?</li>
<li>?</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="83" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="83" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="example-mutable-references-2">Example: Mutable References</h1>
<div class = "container">
<div class = "col">
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-rust"><span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">v</span> = <span class="hljs-built_in">vec!</span>[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>];

<span class="hljs-keyword">let</span> <span class="hljs-variable">x</span> = &amp;<span class="hljs-keyword">mut</span> v[<span class="hljs-number">3</span>]; <span class="hljs-comment">// &lt;-</span>
<span class="hljs-comment">//      ^^^^</span>
</code></pre>
</div>
<div class = "col">
<table>
<thead>
<tr>
<th>Place</th>
<th>R</th>
<th>W</th>
<th>O</th>
</tr>
</thead>
<tbody>
<tr>
<td>v</td>
<td><strong>-</strong></td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>x</td>
<td>R</td>
<td>-</td>
<td>O</td>
</tr>
<tr>
<td>*x</td>
<td>R</td>
<td>-?</td>
<td>-</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>However, when <code>x</code> is a mutable reference:</p>
<ul>
<li><code>v</code> loses <em>all</em> permissions, including R</li>
<li>?</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="84" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="84" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="example-mutable-references-3">Example: Mutable References</h1>
<div class = "container">
<div class = "col">
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-rust"><span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">v</span> = <span class="hljs-built_in">vec!</span>[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>];

<span class="hljs-keyword">let</span> <span class="hljs-variable">x</span> = &amp;<span class="hljs-keyword">mut</span> v[<span class="hljs-number">3</span>]; <span class="hljs-comment">// &lt;-</span>
<span class="hljs-comment">//      ^^^^</span>
</code></pre>
</div>
<div class = "col">
<table>
<thead>
<tr>
<th>Place</th>
<th>R</th>
<th>W</th>
<th>O</th>
</tr>
</thead>
<tbody>
<tr>
<td>v</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>x</td>
<td>R</td>
<td>-</td>
<td>O</td>
</tr>
<tr>
<td>*x</td>
<td>R</td>
<td><strong>W</strong></td>
<td>-</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>However, when <code>x</code> is a mutable reference:</p>
<ul>
<li><code>v</code> loses <em>all</em> permissions, including R</li>
<li><code>*x</code> (<em>not</em> <code>x</code>) gains W permissions</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="85" data-marpit-fragments="3" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="85" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="example-mutable-references-4">Example: Mutable References</h1>
<div class = "container">
<div class = "col">
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-rust"><span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">v</span> = <span class="hljs-built_in">vec!</span>[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>];

<span class="hljs-keyword">let</span> <span class="hljs-variable">x</span> = &amp;<span class="hljs-keyword">mut</span> v[<span class="hljs-number">3</span>]; <span class="hljs-comment">// &lt;-</span>
<span class="hljs-comment">//      ^^^^</span>
</code></pre>
</div>
<div class = "col">
<table>
<thead>
<tr>
<th>Place</th>
<th>R</th>
<th>W</th>
<th>O</th>
</tr>
</thead>
<tbody>
<tr>
<td>v</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>x</td>
<td>R</td>
<td>-</td>
<td>O</td>
</tr>
<tr>
<td>*x</td>
<td>R</td>
<td><strong>W</strong></td>
<td>-</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li><code>v</code> loses <em>all</em> permissions, including R
<ul>
<li data-marpit-fragment="1">Prevents creation of other references (both mutable and immutable)</li>
<li data-marpit-fragment="2">Avoids simultaneous <strong>aliasing</strong> and mutation</li>
</ul>
</li>
<li><code>*x</code> (<em>not</em> <code>x</code>) gains W permission
<ul>
<li data-marpit-fragment="3">We can write to the data, but we can't reassign <code>x</code></li>
</ul>
</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="86" data-marpit-fragments="5" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="86" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="recap-mutable-references">Recap: Mutable References</h1>
<p>An immutable reference <code>x</code> of <code>v</code>:</p>
<ul>
<li data-marpit-fragment="1">Removes W and O permissions for <code>v</code> (keeps R)</li>
<li data-marpit-fragment="2"><code>*x</code> can only take R if <code>v</code> has R</li>
</ul>
<p>A mutable reference <code>x</code> to <code>v</code>:</p>
<ul>
<li data-marpit-fragment="3">Removes <em>all</em> permissions for <code>v</code> (including R)
<ul>
<li data-marpit-fragment="4">Prevents creation of any other references</li>
</ul>
</li>
<li data-marpit-fragment="5"><code>*x</code> (not <code>x</code>) gains W permission</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="87" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="87" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="fixing-programs"><strong>Fixing Programs</strong></h1>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="88" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="88" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="arrays-and-slices">Arrays and Slices</h1>
<p>Suppose we have a vector of numbers:</p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-rust"><span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">v</span> = <span class="hljs-built_in">vec!</span>[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>];
</code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="89" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="89" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="arrays-and-slices-1">Arrays and Slices</h1>
<p>We want to take this number <code>2</code>...</p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-rust"><span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">v</span> = <span class="hljs-built_in">vec!</span>[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>];
<span class="hljs-comment">//                  ^</span>
</code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="90" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="90" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="arrays-and-slices-2">Arrays and Slices</h1>
<p>We want to take this number <code>2</code>...and add it to the number in the first index.</p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-rust"><span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">v</span> = <span class="hljs-built_in">vec!</span>[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>];
<span class="hljs-comment">//               ^</span>
</code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="91" style="--paginate:true;--theme:rust;--marpit-advanced-background-split:25%;" data-marpit-pagination-total="102" data-marpit-advanced-background="background" data-marpit-advanced-background-split="right"><div data-marpit-advanced-background-container="true" data-marpit-advanced-background-direction="horizontal"><figure style="background-image:url(&quot;../images/ferris_does_not_compile.svg&quot;);background-size:75%;"></figure></div></section></foreignObject><foreignObject width="75%" height="720"><section id="91" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="91" style="--paginate:true;--theme:rust;--marpit-advanced-background-split:25%;" data-marpit-pagination-total="102" data-marpit-advanced-background="content" data-marpit-advanced-background-split="right">
<h1 id="arrays-and-slices-3">Arrays and Slices</h1>

<p>Here is a seemingly reasonable solution:</p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-rust"><span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">v</span> = <span class="hljs-built_in">vec!</span>[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>];

<span class="hljs-keyword">let</span> <span class="hljs-variable">slot1</span> = &amp;<span class="hljs-keyword">mut</span> v[<span class="hljs-number">0</span>];

<span class="hljs-keyword">let</span> <span class="hljs-variable">slot2</span> = &amp;v[<span class="hljs-number">1</span>];

*slot1 += *slot2;
</code></pre>
</section>
</foreignObject><foreignObject width="1280" height="720" data-marpit-advanced-background="pseudo"><section data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="91" style="" data-marpit-pagination-total="102" data-marpit-advanced-background="pseudo" data-marpit-advanced-background-split="right"></section></foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="92" data-marpit-fragments="1" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="92" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="arrays-and-slices-problem">Arrays and Slices: Problem</h1>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code>error[E0502]: cannot borrow `v` as immutable because it is also borrowed as mutable
  --&gt; src/main.rs:9:18
   |
8  |     let slot1 = &amp;mut v[0];
   |                      - mutable borrow occurs here
9  |     let slot2 = &amp;v[1];
   |                  ^ immutable borrow occurs here
10 |     *slot1 += *slot2;
   |     ---------------- mutable borrow later used here
   |
   = help: use `.split_at_mut(position)` to obtain
           two mutable non-overlapping sub-slices
</code></pre>
<ul>
<li data-marpit-fragment="1">Let's break down the permissions</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="93" data-marpit-fragments="2" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="93" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="arrays-and-slices-permissions">Arrays and Slices: Permissions</h1>
<div class = "container">
<div class = "col">
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-rust"><span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">v</span> = <span class="hljs-built_in">vec!</span>[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>];

<span class="hljs-keyword">let</span> <span class="hljs-variable">slot1</span> = &amp;<span class="hljs-keyword">mut</span> v[<span class="hljs-number">0</span>]; <span class="hljs-comment">// &lt;-</span>

<span class="hljs-keyword">let</span> <span class="hljs-variable">slot2</span> = &amp;v[<span class="hljs-number">1</span>];

*slot1 += *slot2;
</code></pre>
</div>
<div class = "col">
<table>
<thead>
<tr>
<th>Place</th>
<th>R</th>
<th>W</th>
<th>O</th>
</tr>
</thead>
<tbody>
<tr>
<td>v</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>*slot1</td>
<td>R</td>
<td>W</td>
<td>-</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Recall that when we create a mutable reference <code>slot1 = &amp;mut v[0]</code>:</p>
<ul>
<li data-marpit-fragment="1"><code>v</code> loses all permissions</li>
<li data-marpit-fragment="2"><code>*slot1</code> gains R, W permissions</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="94" data-marpit-fragments="3" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="94" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="arrays-and-slices-permissions-1">Arrays and Slices: Permissions</h1>
<div class = "container">
<div class = "col">
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-rust"><span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">v</span> = <span class="hljs-built_in">vec!</span>[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>];

<span class="hljs-keyword">let</span> <span class="hljs-variable">slot1</span> = &amp;<span class="hljs-keyword">mut</span> v[<span class="hljs-number">0</span>];

<span class="hljs-keyword">let</span> <span class="hljs-variable">slot2</span> = &amp;v[<span class="hljs-number">1</span>]; <span class="hljs-comment">// &lt;-</span>

*slot1 += *slot2;
</code></pre>
</div>
<div class = "col">
<table>
<thead>
<tr>
<th>Place</th>
<th>R</th>
<th>W</th>
<th>O</th>
</tr>
</thead>
<tbody>
<tr>
<td>v</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>*slot1</td>
<td>R</td>
<td>W</td>
<td>-</td>
</tr>
<tr>
<td>*slot2</td>
<td>?</td>
<td>?</td>
<td>?</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Recall that when we create an immutable reference <code>slot2 = &amp;v[1]</code>:</p>
<ul>
<li data-marpit-fragment="1"><code>v</code> loses W and O permissions (didn't have it anyways)</li>
<li data-marpit-fragment="2"><code>v</code> gives <code>x</code> R since <code>x</code> needs R on line 4
<ul>
<li data-marpit-fragment="3">But <code>v</code> doesn't have R!</li>
</ul>
</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="95" data-marpit-fragments="5" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="95" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="arrays-and-slices-permissions-2">Arrays and Slices: Permissions</h1>
<div class = "container">
<div class = "col">
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-rust"><span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">v</span> = <span class="hljs-built_in">vec!</span>[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>];

<span class="hljs-keyword">let</span> <span class="hljs-variable">slot1</span> = &amp;<span class="hljs-keyword">mut</span> v[<span class="hljs-number">0</span>];

<span class="hljs-keyword">let</span> <span class="hljs-variable">slot2</span> = &amp;v[<span class="hljs-number">1</span>]; <span class="hljs-comment">// &lt;-</span>

*slot1 += *slot2; <img class="emoji" draggable="false" alt="❌" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/274c.svg" data-marp-twemoji=""/>
</code></pre>
</div>
<div class = "col">
<table>
<thead>
<tr>
<th>Place</th>
<th>R</th>
<th>W</th>
<th>O</th>
</tr>
</thead>
<tbody>
<tr>
<td>v</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>*slot1</td>
<td>R</td>
<td>W</td>
<td>-</td>
</tr>
<tr>
<td>*slot2</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li data-marpit-fragment="1">Mutating <code>*slot1</code> requires R, W
<ul>
<li data-marpit-fragment="2"><code>*slot1</code> has both <img class="emoji" draggable="false" alt="✅" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/2705.svg" data-marp-twemoji=""/></li>
</ul>
</li>
<li data-marpit-fragment="3">Reading <code>*slot2</code> requires R
<ul>
<li data-marpit-fragment="4"><code>*slot2</code> doesn't have R <img class="emoji" draggable="false" alt="❌" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/274c.svg" data-marp-twemoji=""/></li>
<li data-marpit-fragment="5"><code>v</code> &quot;gave&quot; R to <code>*slot1</code>!</li>
</ul>
</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="96" data-marpit-fragments="3" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="96" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="arrays-and-slices-permissions-3">Arrays and Slices: Permissions</h1>
<div class = "container">
<div class = "col">
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-rust"><span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">v</span> = <span class="hljs-built_in">vec!</span>[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>];

<span class="hljs-keyword">let</span> <span class="hljs-variable">slot1</span> = &amp;<span class="hljs-keyword">mut</span> v[<span class="hljs-number">0</span>];

<span class="hljs-keyword">let</span> <span class="hljs-variable">slot2</span> = &amp;v[<span class="hljs-number">1</span>]; <span class="hljs-comment">// &lt;-</span>

*slot1 += *slot2; <img class="emoji" draggable="false" alt="❌" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/274c.svg" data-marp-twemoji=""/>
</code></pre>
</div>
<div class = "col">
<table>
<thead>
<tr>
<th>Place</th>
<th>R</th>
<th>W</th>
<th>O</th>
</tr>
</thead>
<tbody>
<tr>
<td>v</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>*slot1</td>
<td>R</td>
<td>W</td>
<td>-</td>
</tr>
<tr>
<td>*slot2</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The main issue here is that the single place <code>v</code> represents the <em>entire</em> vector.</p>
<ul>
<li data-marpit-fragment="1">Borrow checker does not see each index / element as a different place</li>
<li data-marpit-fragment="2">Borrow checker can't know that this code is safe
<ul>
<li data-marpit-fragment="3">But we (as humans) do!</li>
</ul>
</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="97" data-marpit-fragments="2" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="97" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="fixing-a-safe-program">Fixing a Safe Program</h1>
<p>Solution 1: Don't use explicit references.</p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-rust"><span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">v</span> = <span class="hljs-built_in">vec!</span>[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>];

v[<span class="hljs-number">0</span>] += v[<span class="hljs-number">1</span>];

<span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;{:?}&quot;</span>, v);
</code></pre>
<ul>
<li data-marpit-fragment="1">This works because we mutate only <code>v[0]</code>
<ul>
<li data-marpit-fragment="2"><em>Program evaluation is right to left</em></li>
</ul>
</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="98" data-marpit-fragments="4" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="98" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="fixing-a-safe-program-1">Fixing a Safe Program</h1>
<p>Solution 2: Drop into <code>unsafe</code> code.</p>
<p><code>split_at_mut</code> uses <code>unsafe</code> under the hood:</p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-rust"><span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">v</span> = [<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">3</span>, <span class="hljs-number">0</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>];

<span class="hljs-keyword">let</span> (left, right) = v.<span class="hljs-title function_ invoke__">split_at_mut</span>(<span class="hljs-number">2</span>);

<span class="hljs-built_in">assert_eq!</span>(left, [<span class="hljs-number">1</span>, <span class="hljs-number">0</span>]);
<span class="hljs-built_in">assert_eq!</span>(right, [<span class="hljs-number">3</span>, <span class="hljs-number">0</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>]);
</code></pre>
<ul>
<li data-marpit-fragment="1">Divides a mutable slice into two mutable slices at index <code>mid</code>
<ul>
<li data-marpit-fragment="2"><code>left</code> contains <code>[0, mid)</code></li>
<li data-marpit-fragment="3"><code>right</code> contains <code>[mid, len)</code></li>
</ul>
</li>
<li data-marpit-fragment="4">We will talk about this in a few weeks!</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="99" data-marpit-fragments="6" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="99" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="sound-vs-complete">Sound vs. Complete</h1>
<p>The borrow checker is <strong>sound</strong>, but not <strong>complete</strong>. This means that the borrow checker sometimes can't figure out if your program is safe.</p>
<ul>
<li data-marpit-fragment="1">If you conclude it is actually safe:
<ul>
<li data-marpit-fragment="2">After reasoning about stack frames</li>
<li data-marpit-fragment="3">After reasoning about permissions</li>
<li data-marpit-fragment="4">Repeating all steps several times</li>
<li data-marpit-fragment="5">Consider <em>potentially</em> using <code>unsafe</code></li>
<li data-marpit-fragment="6">And then tell yourself that you probably don't need to use <code>unsafe</code></li>
</ul>
</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="100" data-marpit-fragments="5" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="100" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="ownership-recap">Ownership Recap</h1>
<ul>
<li data-marpit-fragment="1">Ownership rules prevent access to deallocated memory
<ul>
<li data-marpit-fragment="2">Think of owners as <strong>stack frames</strong></li>
</ul>
</li>
<li data-marpit-fragment="3">Borrow checker checks <strong>permissions</strong> of <strong>places</strong>
<ul>
<li data-marpit-fragment="4">References temporarily remove permissions</li>
</ul>
</li>
<li data-marpit-fragment="5">The borrow checker is your friend!</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="101" data-marpit-fragments="7" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="101" style="--paginate:true;--theme:rust;" data-marpit-pagination-total="102">
<h1 id="homework-8">Homework 8</h1>
<ul>
<li data-marpit-fragment="1">This homework is a Gradescope Quiz!</li>
<li data-marpit-fragment="2">30 questions from the <a href="https://rust-book.cs.brown.edu/">Brown Rust Book</a></li>
<li data-marpit-fragment="3">Read through chapter 4 on ownership
<ul>
<li data-marpit-fragment="4">Answer the quiz questions on the web page as you go through it</li>
<li data-marpit-fragment="5">All answers will be revealed after you attempt!</li>
</ul>
</li>
<li data-marpit-fragment="6">Each question is worth 5 points, so you don't need to do everything</li>
<li data-marpit-fragment="7">Focus on <em>understanding</em> rather than the questions themselves</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="102" style="--paginate:true;--theme:rust;--marpit-advanced-background-split:30%;" data-marpit-pagination-total="102" data-marpit-advanced-background="background" data-marpit-advanced-background-split="right"><div data-marpit-advanced-background-container="true" data-marpit-advanced-background-direction="horizontal"><figure style="background-image:url(&quot;../images/ferris_happy.svg&quot;);background-size:80%;"></figure></div></section></foreignObject><foreignObject width="70%" height="720"><section id="102" data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="102" style="--paginate:true;--theme:rust;--marpit-advanced-background-split:30%;" data-marpit-pagination-total="102" data-marpit-advanced-background="content" data-marpit-advanced-background-split="right">
<h1 id="next-lecture-lifetimes">Next Lecture: Lifetimes</h1>

<p>Thanks for coming!</p>
<br />
<p><em>Slides created by:</em><br />
Connor Tsui, Benjamin Owad, David Rudo,<br />
Jessica Ruan, Fiona Fisher, Terrance Chen</p>
</section>
<script>!function(){"use strict";const t={h1:{proto:()=>HTMLHeadingElement,attrs:{role:"heading","aria-level":"1"},style:"display: block; font-size: 2em; margin-block-start: 0.67em; margin-block-end: 0.67em; margin-inline-start: 0px; margin-inline-end: 0px; font-weight: bold;"},h2:{proto:()=>HTMLHeadingElement,attrs:{role:"heading","aria-level":"2"},style:"display: block; font-size: 1.5em; margin-block-start: 0.83em; margin-block-end: 0.83em; margin-inline-start: 0px; margin-inline-end: 0px; font-weight: bold;"},h3:{proto:()=>HTMLHeadingElement,attrs:{role:"heading","aria-level":"3"},style:"display: block; font-size: 1.17em; margin-block-start: 1em; margin-block-end: 1em; margin-inline-start: 0px; margin-inline-end: 0px; font-weight: bold;"},h4:{proto:()=>HTMLHeadingElement,attrs:{role:"heading","aria-level":"4"},style:"display: block; margin-block-start: 1.33em; margin-block-end: 1.33em; margin-inline-start: 0px; margin-inline-end: 0px; font-weight: bold;"},h5:{proto:()=>HTMLHeadingElement,attrs:{role:"heading","aria-level":"5"},style:"display: block; font-size: 0.83em; margin-block-start: 1.67em; margin-block-end: 1.67em; margin-inline-start: 0px; margin-inline-end: 0px; font-weight: bold;"},h6:{proto:()=>HTMLHeadingElement,attrs:{role:"heading","aria-level":"6"},style:"display: block; font-size: 0.67em; margin-block-start: 2.33em; margin-block-end: 2.33em; margin-inline-start: 0px; margin-inline-end: 0px; font-weight: bold;"},span:{proto:()=>HTMLSpanElement},pre:{proto:()=>HTMLElement,style:"display: block; font-family: monospace; white-space: pre; margin: 1em 0; --marp-auto-scaling-white-space: pre;"}},e="data-marp-auto-scaling-wrapper",i="data-marp-auto-scaling-svg",n="data-marp-auto-scaling-container";class s extends HTMLElement{container;containerSize;containerObserver;svg;svgComputedStyle;svgPreserveAspectRatio="xMinYMid meet";wrapper;wrapperSize;wrapperObserver;constructor(){super();const t=t=>([e])=>{const{width:i,height:n}=e.contentRect;this[t]={width:i,height:n},this.updateSVGRect()};this.attachShadow({mode:"open"}),this.containerObserver=new ResizeObserver(t("containerSize")),this.wrapperObserver=new ResizeObserver(((...e)=>{t("wrapperSize")(...e),this.flushSvgDisplay()}))}static get observedAttributes(){return["data-downscale-only"]}connectedCallback(){this.shadowRoot.innerHTML=`\n<style>\n  svg[${i}] { display: block; width: 100%; height: auto; vertical-align: top; }\n  span[${n}] { display: table; white-space: var(--marp-auto-scaling-white-space, nowrap); width: max-content; }\n</style>\n<div ${e}>\n  <svg part="svg" ${i}>\n    <foreignObject><span ${n}><slot></slot></span></foreignObject>\n  </svg>\n</div>\n    `.split(/\n\s*/).join(""),this.wrapper=this.shadowRoot.querySelector(`div[${e}]`)??void 0;const t=this.svg;this.svg=this.wrapper?.querySelector(`svg[${i}]`)??void 0,this.svg!==t&&(this.svgComputedStyle=this.svg?window.getComputedStyle(this.svg):void 0),this.container=this.svg?.querySelector(`span[${n}]`)??void 0,this.observe()}disconnectedCallback(){this.svg=void 0,this.svgComputedStyle=void 0,this.wrapper=void 0,this.container=void 0,this.observe()}attributeChangedCallback(){this.observe()}flushSvgDisplay(){const{svg:t}=this;t&&(t.style.display="inline",requestAnimationFrame((()=>{t.style.display=""})))}observe(){this.containerObserver.disconnect(),this.wrapperObserver.disconnect(),this.wrapper&&this.wrapperObserver.observe(this.wrapper),this.container&&this.containerObserver.observe(this.container),this.svgComputedStyle&&this.observeSVGStyle(this.svgComputedStyle)}observeSVGStyle(t){const e=()=>{const i=(()=>{const e=t.getPropertyValue("--preserve-aspect-ratio");if(e)return e.trim();return`x${(({textAlign:t,direction:e})=>{if(t.endsWith("left"))return"Min";if(t.endsWith("right"))return"Max";if("start"===t||"end"===t){let i="rtl"===e;return"end"===t&&(i=!i),i?"Max":"Min"}return"Mid"})(t)}YMid meet`})();i!==this.svgPreserveAspectRatio&&(this.svgPreserveAspectRatio=i,this.updateSVGRect()),t===this.svgComputedStyle&&requestAnimationFrame(e)};e()}updateSVGRect(){let t=Math.ceil(this.containerSize?.width??0);const e=Math.ceil(this.containerSize?.height??0);void 0!==this.dataset.downscaleOnly&&(t=Math.max(t,this.wrapperSize?.width??0));const i=this.svg?.querySelector(":scope > foreignObject");if(i?.setAttribute("width",`${t}`),i?.setAttribute("height",`${e}`),this.svg&&(this.svg.setAttribute("viewBox",`0 0 ${t} ${e}`),this.svg.setAttribute("preserveAspectRatio",this.svgPreserveAspectRatio),this.svg.style.height=t<=0||e<=0?"0":""),this.container){const t=this.svgPreserveAspectRatio.toLowerCase();this.container.style.marginLeft=t.startsWith("xmid")||t.startsWith("xmax")?"auto":"0",this.container.style.marginRight=t.startsWith("xmi")?"auto":"0"}}}const r=(t,{attrs:e={},style:i})=>class extends t{constructor(...t){super(...t);for(const[t,i]of Object.entries(e))this.hasAttribute(t)||this.setAttribute(t,i);this._shadow()}static get observedAttributes(){return["data-auto-scaling"]}connectedCallback(){this._update()}attributeChangedCallback(){this._update()}_shadow(){if(!this.shadowRoot)try{this.attachShadow({mode:"open"})}catch(t){if(!(t instanceof Error&&"NotSupportedError"===t.name))throw t}return this.shadowRoot}_update(){const t=this._shadow();if(t){const e=i?`<style>:host { ${i} }</style>`:"";let n="<slot></slot>";const{autoScaling:s}=this.dataset;if(void 0!==s){n=`<marp-auto-scaling exportparts="svg:auto-scaling" ${"downscale-only"===s?"data-downscale-only":""}>${n}</marp-auto-scaling>`}t.innerHTML=e+n}}};let o;const a=Symbol();let l;const c="marpitSVGPolyfill:setZoomFactor,",d=Symbol(),h=Symbol();const g=()=>{const t="Apple Computer, Inc."===navigator.vendor,e=t?[u]:[],i={then:e=>(t?(async()=>{if(void 0===l){const t=document.createElement("canvas");t.width=10,t.height=10;const e=t.getContext("2d"),i=new Image(10,10),n=new Promise((t=>{i.addEventListener("load",(()=>t()))}));i.crossOrigin="anonymous",i.src="data:image/svg+xml;charset=utf8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2210%22%20height%3D%2210%22%20viewBox%3D%220%200%201%201%22%3E%3CforeignObject%20width%3D%221%22%20height%3D%221%22%20requiredExtensions%3D%22http%3A%2F%2Fwww.w3.org%2F1999%2Fxhtml%22%3E%3Cdiv%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F1999%2Fxhtml%22%20style%3D%22width%3A%201px%3B%20height%3A%201px%3B%20background%3A%20red%3B%20position%3A%20relative%22%3E%3C%2Fdiv%3E%3C%2FforeignObject%3E%3C%2Fsvg%3E",await n,e.drawImage(i,0,0),l=e.getImageData(5,5,1,1).data[3]<128}return l})().then((t=>{null==e||e(t?[u]:[])})):null==e||e([]),i)};return Object.assign(e,i)};let p,m;function u(t){const e="object"==typeof t&&t.target||document,i="object"==typeof t?t.zoom:t;window[h]||(Object.defineProperty(window,h,{configurable:!0,value:!0}),document.body.style.zoom=1.0001,document.body.offsetHeight,document.body.style.zoom=1,window.addEventListener("message",(({data:t,origin:e})=>{if(e===window.origin)try{if(t&&"string"==typeof t&&t.startsWith(c)){const[,e]=t.split(","),i=Number.parseFloat(e);Number.isNaN(i)||(m=i)}}catch(t){console.error(t)}})));let n=!1;Array.from(e.querySelectorAll("svg[data-marpit-svg]"),(t=>{var e,s,r,o;t.style.transform||(t.style.transform="translateZ(0)");const a=i||m||t.currentScale||1;p!==a&&(p=a,n=a);const l=t.getBoundingClientRect(),{length:c}=t.children;for(let i=0;i<c;i+=1){const n=t.children[i];if(n.getScreenCTM){const t=n.getScreenCTM();if(t){const i=null!==(s=null===(e=n.x)||void 0===e?void 0:e.baseVal.value)&&void 0!==s?s:0,c=null!==(o=null===(r=n.y)||void 0===r?void 0:r.baseVal.value)&&void 0!==o?o:0,d=n.children.length;for(let e=0;e<d;e+=1){const s=n.children[e];if("SECTION"===s.tagName){const{style:e}=s;e.transformOrigin||(e.transformOrigin=`${-i}px ${-c}px`),e.transform=`scale(${a}) matrix(${t.a}, ${t.b}, ${t.c}, ${t.d}, ${t.e-l.left}, ${t.f-l.top}) translateZ(0.0001px)`;break}}}}}})),!1!==n&&Array.from(e.querySelectorAll("iframe"),(({contentWindow:t})=>{null==t||t.postMessage(`${c}${n}`,"null"===window.origin?"*":window.origin)}))}function v({once:t=!1,target:e=document}={}){const i=function(t=document){if(t[d])return t[d];let e=!0;const i=()=>{e=!1,delete t[d]};Object.defineProperty(t,d,{configurable:!0,value:i});let n=[],s=!1;(async()=>{try{n=await g()}finally{s=!0}})();const r=()=>{for(const e of n)e({target:t});s&&0===n.length||e&&window.requestAnimationFrame(r)};return r(),i}(e);return t?(i(),()=>{}):i}p=1,m=void 0;const w=Symbol(),b=(e=document)=>{if("undefined"==typeof window)throw new Error("Marp Core's browser script is valid only in browser context.");if(((e=document)=>{const i=window[a];i||customElements.define("marp-auto-scaling",s);for(const n of Object.keys(t)){const s=`marp-${n}`,a=t[n].proto();(o??(o=!!document.createElement("div",{is:"marp-auto-scaling"}).outerHTML.startsWith("<div is"),o))&&a!==HTMLElement?i||customElements.define(s,r(a,{style:t[n].style}),{extends:n}):(i||customElements.define(s,r(HTMLElement,t[n])),e.querySelectorAll(`${n}[is="${s}"]`).forEach((t=>{t.outerHTML=t.outerHTML.replace(new RegExp(`^<${n}`,"i"),`<${s}`).replace(new RegExp(`</${n}>$`,"i"),`</${s}>`)})))}window[a]=!0})(e),e[w])return e[w];const i=v({target:e}),n=()=>{i(),delete e[w]},l=Object.assign(n,{cleanup:n,update:()=>b(e)});return Object.defineProperty(e,w,{configurable:!0,value:l}),l},y=document.currentScript;b(y?y.getRootNode():document)}();
</script></foreignObject><foreignObject width="1280" height="720" data-marpit-advanced-background="pseudo"><section data-paginate="true" data-theme="rust" lang="en-US" data-marpit-pagination="102" style="" data-marpit-pagination-total="102" data-marpit-advanced-background="pseudo" data-marpit-advanced-background-split="right"></section></foreignObject></svg></div><div class="bespoke-marp-note" data-index="0" tabindex="0"><p>Many images in this lecture were generated with https://cel.cs.brown.edu/aquascope/</p></div><div class="bespoke-marp-note" data-index="1" tabindex="0"><p>Instead of _against_ the borrow checker</p></div><div class="bespoke-marp-note" data-index="6" tabindex="0"><p>Speaker note:
First, we have to understand what makes a program unsafe.
Why do we have these rules in the first place?
What sorts of behavior is the compiler trying to prevent?</p></div><div class="bespoke-marp-note" data-index="8" tabindex="0"><p>Speaker note:
Undefined behavior can encapsulate a lot of things,
so we'll simplify it and say that</p></div><div class="bespoke-marp-note" data-index="9" tabindex="0"><p>Speaker note:
Our program is unsafe if we make an invalid memory access
Double asterisk, see Rust Reference for full definition</p></div><div class="bespoke-marp-note" data-index="10" tabindex="0"><p>Speaker note:
The &quot;someone else&quot; will be further explained in Parallelism lecture, but it is also possible
that &quot;someone else&quot; can overwrite in a single-threaded context (vector mutation example)</p></div><div class="bespoke-marp-note" data-index="11" tabindex="0"><p>Immutable global variables are by definition never be deallocated and never written to.</p></div><div class="bespoke-marp-note" data-index="14" tabindex="0"><p>For `my_function`'s stack frame, we
- Copy `x` to create `arg`
- Create the locals `y`, `z`
Emphasize the copying of `x`</p></div><div class="bespoke-marp-note" data-index="17" tabindex="0"><p>Just to be super clear, we would actually need 2^31 64-bit integers to occupy 16 GB, but
this gets the point across.</p></div><div class="bespoke-marp-note" data-index="19" tabindex="0"><p>Speaker note:
If we call this function 10 times, we're copying 10 Google Drives! Unsustainable!

Just 1 of these is likely going to cause you to run out of RAM (16 GB RAM is standard
nowadays, but many laptops have only 8 GB of memory).

Make it clear that this is not a recursive function, it's just super expensive to do this every function call.

To transition to next slide, emphasize that
this inefficiency is not just with function calls.
What if we resize our vector?</p></div><div class="bespoke-marp-note" data-index="25" tabindex="0"><p>Speaker note:
If students ask about type annotation of `arg`:
    * `v` is coerced from a fixed-size array `Box&lt;[u32; HUGE_NUMBER]&gt;` to a boxed slice `Box&lt;[u32]&gt;`
If students ask when we'd use `Box`, seeing as this is not recommended:
    * We usually use `Box` when defining recursive types, like tree nodes that have nodes for children. Rust needs to know the size of every type at compile time, but recursive types have an unknown, potentially infinite size. `Box` is used to break the infinite size problem, since its size is always a fixed pointer size</p></div><div class="bespoke-marp-note" data-index="29" tabindex="0"><p>Scalar data being integers and floating points</p></div><div class="bespoke-marp-note" data-index="31" tabindex="0"><p>Let's put that question on hold for a few slides...</p></div><div class="bespoke-marp-note" data-index="33" tabindex="0"><p>Speaker notes:
We draw inspiration from stack memory!
Why are stack deallocations safe?
Well, do you notice that in stack allocations,
each value on the stack has an &quot;owner&quot;?
Each value is allocated when we enter the function,
and each value is deallocated when we exit the function?
You can think of it as the value being &quot;owned&quot; by the function,
    and it's valid when we're in the function,
    and dropped when we exit the function!

What if we take this idea of ownership for stacks,
    and apply it to the heap?
Before, in C-land, heap memory is laissez-faire for the programmer.
Now we impose the following rules:</p></div><div class="bespoke-marp-note" data-index="36" tabindex="0"><p>Speaker note:
    Q: Bonus points if you can tell us which Traits this closure implements:
    (FnOnce only)</p></div><div class="bespoke-marp-note" data-index="38" tabindex="0"><p>Make sure to spend time on this! If students do not understand this, they are not going to
understand the entire section.

Normally you wouldn't do `return self.my_str;` and instead just do `self.my_str`, but this makes it
clear what is happening</p></div><div class="bespoke-marp-note" data-index="45" tabindex="0"><p>So we just explained another way to think about ownership rules.
Is there another way to think about borrowing rules?</p></div><div class="bespoke-marp-note" data-index="46" tabindex="0"><p>Explain this code directly:
Suppose we have a `Vec`, and we take a reference `x` to its last element, remove the last element, and print `x`.

Ask audience!!</p></div><div class="bespoke-marp-note" data-index="48" tabindex="0"><p>Speaker note: Ask audience!!</p></div><div class="bespoke-marp-note" data-index="52" tabindex="0"><p>Ask students how easy you can make this mistake in other languages (namely C++)</p></div><div class="bespoke-marp-note" data-index="53" tabindex="0"><p>What if you, as the programmer, knew that this push doesn't resize?
    e.g. vector is power of 2

You can calm the compiler with a special keyword, `unsafe`
We will talk about `unsafe` in the later weeks.</p></div><div class="bespoke-marp-note" data-index="58" tabindex="0"><p>Work so smoothly the borrow checker does not feel it :-)</p></div><div class="bespoke-marp-note" data-index="59" tabindex="0"><p>This section is supposed to be a preview of what students will actually read in the Brown Rust
Book. Make sure to tell them that it is okay if they do not fully understand everything in this
section, as it is not easy to understand quickly (just like Rust)!</p></div><div class="bespoke-marp-note" data-index="74" tabindex="0"><p>(Only if time!)

Before 2018: Rust used a more restrictive model called &quot;lexical lifetimes,&quot;
where the borrow's lifetime lasted until the end of the lexical scope in which
the reference was declared. A yucky workaround was creating extra scopes with
curly braces to end borrows early

After 2018: Non-lexical lifetimes (NLL) were introduced!
Instead of using lexical scopes to determine lifetimes, the compiler analyzes
the control flow to determine when the reference was last used, hence more
intuitive behavior

We'll talk more in the Lifetimes lecture, alongside more &quot;Dark Ages&quot; tales!</p></div><div class="bespoke-marp-note" data-index="75" tabindex="0"><p>This is technically both cases because line 2 is dead code...</p></div><div class="bespoke-marp-note" data-index="78" tabindex="0"><p>Speaker note: &quot;unused&quot; will be clarified in Lifetimes lecture</p></div><div class="bespoke-marp-note" data-index="82" tabindex="0"><p>Speaker note:
Losing R is equivalent to &quot;locking&quot; other references from taking R
    =&gt; no more immutable references</p></div><div class="bespoke-marp-note" data-index="83" tabindex="0"><p>Prevents data races:
* `v` loses all access permissions *including* R, since the old
memory location may be invalidated. Remember our vector resizing example!
* The variable holding the reference / pointer is immutable (`x`),
so that we can't reassign it to point elsewhere while the value
it points to (*x) is being modified</p></div><div class="bespoke-marp-note" data-index="84" tabindex="0"><p>Speaker note:
Aliasing: accessing same data through different variables

Removing R permission is like &quot;locking&quot; other references from taking R
Combined with &quot;*x can only take R if v has R&quot;,
    =&gt; no more immutable references

Analogous to reader-writer locks
- the R permission is like the internal reader mutex</p></div><div class="bespoke-marp-note" data-index="89" tabindex="0"><p>Speaker note:
    Q: &quot;What's ONE plus TWO, boys and girls???&quot;
    A: Three, I hope!</p></div><div class="bespoke-marp-note" data-index="94" tabindex="0"><p>Speaker note:
v regains R after slot1 becomes unused, BUT
slot1 becomes unused after reading *slot2</p></div><div class="bespoke-marp-note" data-index="97" tabindex="0"><p>Make sure to mention that here, `left` and `right` are now different places so we can get a
mutable reference to one and an immutable reference to the other.</p></div><div class="bespoke-marp-note" data-index="98" tabindex="0"><p>If you are wondering if you need unsafe, you probably don't need it.
Usually you can be pretty sure when you need it vs. when you don't.</p></div><script>/*!! License: https://unpkg.com/@marp-team/marp-cli@4.2.3/lib/bespoke.js.LICENSE.txt */
!function(){"use strict";function e(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var t,n,r=(n||(n=1,t={from:function(e,t){var n,r=1===(e.parent||e).nodeType?e.parent||e:document.querySelector(e.parent||e),o=[].filter.call("string"==typeof e.slides?r.querySelectorAll(e.slides):e.slides||r.children,function(e){return"SCRIPT"!==e.nodeName}),a={},i=function(e,t){return(t=t||{}).index=o.indexOf(e),t.slide=e,t},s=function(e,t){a[e]=(a[e]||[]).filter(function(e){return e!==t})},c=function(e,t){return(a[e]||[]).reduce(function(e,n){return e&&!1!==n(t)},!0)},l=function(e,t){o[e]&&(n&&c("deactivate",i(n,t)),n=o[e],c("activate",i(n,t)))},d=function(e,t){var r=o.indexOf(n)+e;c(e>0?"next":"prev",i(n,t))&&l(r,t)},u={off:s,on:function(e,t){return(a[e]||(a[e]=[])).push(t),s.bind(null,e,t)},fire:c,slide:function(e,t){if(!arguments.length)return o.indexOf(n);c("slide",i(o[e],t))&&l(e,t)},next:d.bind(null,1),prev:d.bind(null,-1),parent:r,slides:o,destroy:function(e){c("destroy",i(n,e)),a={}}};return(t||[]).forEach(function(e){e(u)}),n||l(0),u}}),t),o=e(r);const a=document.body,i=(...e)=>history.replaceState(...e),s="",c="presenter",l="next",d=["",c,l],u="bespoke-marp-",f=`data-${u}`,m=(e,{protocol:t,host:n,pathname:r,hash:o}=location)=>{const a=e.toString();return`${t}//${n}${r}${a?"?":""}${a}${o}`},g=()=>a.dataset.bespokeView,p=e=>new URLSearchParams(location.search).get(e),v=(e,t={})=>{const n={location,setter:i,...t},r=new URLSearchParams(n.location.search);for(const t of Object.keys(e)){const n=e[t];"string"==typeof n?r.set(t,n):r.delete(t)}try{n.setter({...window.history.state??{}},"",m(r,n.location))}catch(e){console.error(e)}},h=(()=>{const e="bespoke-marp";try{return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch{return!1}})(),y=e=>{try{return localStorage.getItem(e)}catch{return null}},b=(e,t)=>{try{return localStorage.setItem(e,t),!0}catch{return!1}},w=e=>{try{return localStorage.removeItem(e),!0}catch{return!1}},x=(e,t)=>{const n="aria-hidden";t?e.setAttribute(n,"true"):e.removeAttribute(n)},k=e=>{e.parent.classList.add(`${u}parent`),e.slides.forEach(e=>e.classList.add(`${u}slide`)),e.on("activate",t=>{const n=`${u}active`,r=t.slide,o=r.classList,a=!o.contains(n);if(e.slides.forEach(e=>{e.classList.remove(n),x(e,!0)}),o.add(n),x(r,!1),a){const e=`${n}-ready`;o.add(e),document.body.clientHeight,o.remove(e)}})},$=e=>{let t=0,n=0;Object.defineProperty(e,"fragments",{enumerable:!0,value:e.slides.map(e=>[null,...e.querySelectorAll("[data-marpit-fragment]")])});const r=r=>void 0!==e.fragments[t][n+r],o=(r,o)=>{t=r,n=o,e.fragments.forEach((e,t)=>{e.forEach((e,n)=>{if(null==e)return;const a=t<r||t===r&&n<=o;e.setAttribute(`${f}fragment`,(a?"":"in")+"active");const i=`${f}current-fragment`;t===r&&n===o?e.setAttribute(i,"current"):e.removeAttribute(i)})}),e.fragmentIndex=o;const a={slide:e.slides[r],index:r,fragments:e.fragments[r],fragmentIndex:o};e.fire("fragment",a)};e.on("next",({fragment:a=!0})=>{if(a){if(r(1))return o(t,n+1),!1;const a=t+1;e.fragments[a]&&o(a,0)}else{const r=e.fragments[t].length;if(n+1<r)return o(t,r-1),!1;const a=e.fragments[t+1];a&&o(t+1,a.length-1)}}),e.on("prev",({fragment:a=!0})=>{if(r(-1)&&a)return o(t,n-1),!1;const i=t-1;e.fragments[i]&&o(i,e.fragments[i].length-1)}),e.on("slide",({index:t,fragment:n})=>{let r=0;if(void 0!==n){const o=e.fragments[t];if(o){const{length:e}=o;r=-1===n?e-1:Math.min(Math.max(n,0),e-1)}}o(t,r)}),o(0,0)},E=document,L=()=>!(!E.fullscreenEnabled&&!E.webkitFullscreenEnabled),S=()=>!(!E.fullscreenElement&&!E.webkitFullscreenElement),P=e=>{e.fullscreen=()=>{L()&&(async()=>{S()?(E.exitFullscreen||E.webkitExitFullscreen)?.call(E):((e=E.body)=>{(e.requestFullscreen||e.webkitRequestFullscreen)?.call(e)})()})()},document.addEventListener("keydown",t=>{"f"!==t.key&&"F11"!==t.key||t.altKey||t.ctrlKey||t.metaKey||!L()||(e.fullscreen(),t.preventDefault())})},_=`${u}inactive`,T=(e=2e3)=>({parent:t,fire:n})=>{const r=t.classList,o=e=>n(`marp-${e?"":"in"}active`);let a;const i=()=>{a&&clearTimeout(a),a=setTimeout(()=>{r.add(_),o()},e),r.contains(_)&&(r.remove(_),o(!0))};for(const e of["mousedown","mousemove","touchend"])document.addEventListener(e,i);setTimeout(i,0)},I=["AUDIO","BUTTON","INPUT","SELECT","TEXTAREA","VIDEO"],M=e=>{e.parent.addEventListener("keydown",e=>{if(!e.target)return;const t=e.target;(I.includes(t.nodeName)||"true"===t.contentEditable)&&e.stopPropagation()})},O=e=>{window.addEventListener("load",()=>{for(const t of e.slides){const e=t.querySelector("marp-auto-scaling, [data-auto-scaling], [data-marp-fitting]");t.setAttribute(`${f}load`,e?"":"hideable")}})},A=({interval:e=250}={})=>t=>{document.addEventListener("keydown",e=>{if(" "===e.key&&e.shiftKey)t.prev();else if("ArrowLeft"===e.key||"ArrowUp"===e.key||"PageUp"===e.key)t.prev({fragment:!e.shiftKey});else if(" "!==e.key||e.shiftKey)if("ArrowRight"===e.key||"ArrowDown"===e.key||"PageDown"===e.key)t.next({fragment:!e.shiftKey});else if("End"===e.key)t.slide(t.slides.length-1,{fragment:-1});else{if("Home"!==e.key)return;t.slide(0)}else t.next();e.preventDefault()});let n,r,o=0;t.parent.addEventListener("wheel",a=>{let i=!1;const s=(e,t)=>{e&&(i=i||((e,t)=>((e,t)=>{const n="X"===t?"Width":"Height";return e[`client${n}`]<e[`scroll${n}`]})(e,t)&&((e,t)=>{const{overflow:n}=e,r=e[`overflow${t}`];return"auto"===n||"scroll"===n||"auto"===r||"scroll"===r})(getComputedStyle(e),t))(e,t)),e?.parentElement&&s(e.parentElement,t)};if(0!==a.deltaX&&s(a.target,"X"),0!==a.deltaY&&s(a.target,"Y"),i)return;a.preventDefault();const c=Math.sqrt(a.deltaX**2+a.deltaY**2);if(void 0!==a.wheelDelta){if(void 0===a.webkitForce&&Math.abs(a.wheelDelta)<40)return;if(a.deltaMode===a.DOM_DELTA_PIXEL&&c<4)return}else if(a.deltaMode===a.DOM_DELTA_PIXEL&&c<12)return;r&&clearTimeout(r),r=setTimeout(()=>{n=0},e);const l=Date.now()-o<e,d=c<=n;if(n=c,l||d)return;let u;(a.deltaX>0||a.deltaY>0)&&(u="next"),(a.deltaX<0||a.deltaY<0)&&(u="prev"),u&&(t[u](),o=Date.now())})},C=(e=`.${u}osc`)=>{const t=document.querySelector(e);if(!t)return()=>{};const n=(e,n)=>{t.querySelectorAll(`[${f}osc=${JSON.stringify(e)}]`).forEach(n)};return L()||n("fullscreen",e=>e.style.display="none"),h||n("presenter",e=>{e.disabled=!0,e.title="Presenter view is disabled due to restricted localStorage."}),e=>{t.addEventListener("click",t=>{if(t.target instanceof HTMLElement){const{bespokeMarpOsc:n}=t.target.dataset;n&&t.target.blur();const r={fragment:!t.shiftKey};"next"===n?e.next(r):"prev"===n?e.prev(r):"fullscreen"===n?e?.fullscreen():"presenter"===n&&e.openPresenterView()}}),e.parent.appendChild(t),e.on("activate",({index:t})=>{n("page",n=>n.textContent=`Page ${t+1} of ${e.slides.length}`)}),e.on("fragment",({index:t,fragments:r,fragmentIndex:o})=>{n("prev",e=>e.disabled=0===t&&0===o),n("next",n=>n.disabled=t===e.slides.length-1&&o===r.length-1)}),e.on("marp-active",()=>x(t,!1)),e.on("marp-inactive",()=>x(t,!0)),L()&&(e=>{for(const t of["","webkit"])E.addEventListener(t+"fullscreenchange",e)})(()=>n("fullscreen",e=>e.classList.toggle("exit",L()&&S())))}},D=e=>{window.addEventListener("message",t=>{if(t.origin!==window.origin)return;const[n,r]=t.data.split(":");if("navigate"===n){const[t,n]=r.split(",");let o=Number.parseInt(t,10),a=Number.parseInt(n,10)+1;a>=e.fragments[o].length&&(o+=1,a=0),e.slide(o,{fragment:a})}})};var N,B,q,K,F,j,V,U={exports:{}},X=(N||(N=1,U.exports=(B=["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"],q=function(e){return String(e).replace(/[&<>"']/g,function(e){return"&"+K[e]+";"})},K={"&":"amp","<":"lt",">":"gt",'"':"quot","'":"apos"},F="dangerouslySetInnerHTML",j={className:"class",htmlFor:"for"},V={},function(e,t){var n=[],r="";t=t||{};for(var o=arguments.length;o-- >2;)n.push(arguments[o]);if("function"==typeof e)return t.children=n.reverse(),e(t);if(e){if(r+="<"+e,t)for(var a in t)!1!==t[a]&&null!=t[a]&&a!==F&&(r+=" "+(j[a]?j[a]:q(a))+'="'+q(t[a])+'"');r+=">"}if(-1===B.indexOf(e)){if(t[F])r+=t[F].__html;else for(;n.length;){var i=n.pop();if(i)if(i.pop)for(var s=i.length;s--;)n.push(i[s]);else r+=!0===V[i]?i:q(i)}r+=e?"</"+e+">":""}return V[r]=!0,r})),U.exports),H=e(X);const R=({children:e})=>H(null,null,...e),W=`${u}presenter-`,J={container:`${W}container`,dragbar:`${W}dragbar-container`,next:`${W}next`,nextContainer:`${W}next-container`,noteContainer:`${W}note-container`,noteWrapper:`${W}note-wrapper`,noteButtons:`${W}note-buttons`,infoContainer:`${W}info-container`,infoPage:`${W}info-page`,infoPageText:`${W}info-page-text`,infoPagePrev:`${W}info-page-prev`,infoPageNext:`${W}info-page-next`,noteButtonsBigger:`${W}note-bigger`,noteButtonsSmaller:`${W}note-smaller`,infoTime:`${W}info-time`,infoTimer:`${W}info-timer`},Y=e=>{const{title:t}=document;document.title="[Presenter view]"+(t?` - ${t}`:"");const n={},r=e=>(n[e]=n[e]||document.querySelector(`.${e}`),n[e]);document.body.appendChild((e=>{const t=document.createElement("div");return t.className=J.container,t.appendChild(e),t.insertAdjacentHTML("beforeend",H(R,null,H("div",{class:J.nextContainer},H("iframe",{class:J.next,src:"?view=next"})),H("div",{class:J.dragbar}),H("div",{class:J.noteContainer},H("div",{class:J.noteWrapper}),H("div",{class:J.noteButtons},H("button",{class:J.noteButtonsSmaller,tabindex:"-1",title:"Smaller notes font size"},"Smaller notes font size"),H("button",{class:J.noteButtonsBigger,tabindex:"-1",title:"Bigger notes font size"},"Bigger notes font size"))),H("div",{class:J.infoContainer},H("div",{class:J.infoPage},H("button",{class:J.infoPagePrev,tabindex:"-1",title:"Previous"},"Previous"),H("span",{class:J.infoPageText}),H("button",{class:J.infoPageNext,tabindex:"-1",title:"Next"},"Next")),H("time",{class:J.infoTime,title:"Current time"}),H("time",{class:J.infoTimer,title:"Timer"})))),t})(e.parent)),(e=>{let t=!1;r(J.dragbar).addEventListener("mousedown",()=>{t=!0,r(J.dragbar).classList.add("active")}),window.addEventListener("mouseup",()=>{t=!1,r(J.dragbar).classList.remove("active")}),window.addEventListener("mousemove",e=>{if(!t)return;const n=e.clientX/document.documentElement.clientWidth*100;r(J.container).style.setProperty("--bespoke-marp-presenter-split-ratio",`${Math.max(0,Math.min(100,n))}%`)}),r(J.nextContainer).addEventListener("click",()=>e.next());const n=r(J.next),o=(a=n,(e,t)=>a.contentWindow?.postMessage(`navigate:${e},${t}`,"null"===window.origin?"*":window.origin));var a;n.addEventListener("load",()=>{r(J.nextContainer).classList.add("active"),o(e.slide(),e.fragmentIndex),e.on("fragment",({index:e,fragmentIndex:t})=>o(e,t))});const i=document.querySelectorAll(".bespoke-marp-note");i.forEach(e=>{e.addEventListener("keydown",e=>e.stopPropagation()),r(J.noteWrapper).appendChild(e)}),e.on("activate",()=>i.forEach(t=>t.classList.toggle("active",t.dataset.index==e.slide())));let s=0;const c=e=>{s=Math.max(-5,s+e),r(J.noteContainer).style.setProperty("--bespoke-marp-note-font-scale",(1.2**s).toFixed(4))},l=()=>c(1),d=()=>c(-1),u=r(J.noteButtonsBigger),f=r(J.noteButtonsSmaller);u.addEventListener("click",()=>{u.blur(),l()}),f.addEventListener("click",()=>{f.blur(),d()}),document.addEventListener("keydown",e=>{"+"===e.key&&l(),"-"===e.key&&d()},!0),e.on("activate",({index:t})=>{r(J.infoPageText).textContent=`${t+1} / ${e.slides.length}`});const m=r(J.infoPagePrev),g=r(J.infoPageNext);m.addEventListener("click",t=>{m.blur(),e.prev({fragment:!t.shiftKey})}),g.addEventListener("click",t=>{g.blur(),e.next({fragment:!t.shiftKey})}),e.on("fragment",({index:t,fragments:n,fragmentIndex:r})=>{m.disabled=0===t&&0===r,g.disabled=t===e.slides.length-1&&r===n.length-1});let p=new Date;const v=()=>{const e=new Date,t=e=>`${Math.floor(e)}`.padStart(2,"0"),n=e.getTime()-p.getTime(),o=t(n/1e3%60),a=t(n/1e3/60%60),i=t(n/36e5%24);r(J.infoTime).textContent=e.toLocaleTimeString(),r(J.infoTimer).textContent=`${i}:${a}:${o}`};v(),setInterval(v,250),r(J.infoTimer).addEventListener("click",()=>{p=new Date})})(e)},z=e=>{if(!(e=>e.syncKey&&"string"==typeof e.syncKey)(e))throw new Error("The current instance of Bespoke.js is invalid for Marp bespoke presenter plugin.");Object.defineProperties(e,{openPresenterView:{enumerable:!0,value:G},presenterUrl:{enumerable:!0,get:Q}}),h&&document.addEventListener("keydown",t=>{"p"!==t.key||t.altKey||t.ctrlKey||t.metaKey||(t.preventDefault(),e.openPresenterView())})};function G(){const{max:e,floor:t}=Math,n=e(t(.85*window.innerWidth),640),r=e(t(.85*window.innerHeight),360);return window.open(this.presenterUrl,W+this.syncKey,`width=${n},height=${r},menubar=no,toolbar=no`)}function Q(){const e=new URLSearchParams(location.search);return e.set("view","presenter"),e.set("sync",this.syncKey),m(e)}const Z=e=>{const t=g();return t===l&&e.appendChild(document.createElement("span")),{[s]:z,[c]:Y,[l]:D}[t]},ee=e=>{e.on("activate",t=>{document.querySelectorAll(".bespoke-progress-parent > .bespoke-progress-bar").forEach(n=>{n.style.flexBasis=100*t.index/(e.slides.length-1)+"%"})})},te=e=>{const t=Number.parseInt(e,10);return Number.isNaN(t)?null:t},ne=(e={})=>{const t={history:!0,...e};return e=>{let n=!0;const r=e=>{const t=n;try{return n=!0,e()}finally{n=t}},o=(t={fragment:!0})=>{let n=t.fragment?te(p("f")||""):null;((t,n)=>{const{min:r,max:o}=Math,{fragments:a,slides:i}=e,s=o(0,r(t,i.length-1)),c=o(0,r(n||0,a[s].length-1));s===e.slide()&&c===e.fragmentIndex||e.slide(s,{fragment:c})})((()=>{if(location.hash){const[t]=location.hash.slice(1).split(":~:");if(/^\d+$/.test(t))return(te(t)??1)-1;const r=document.getElementById(t)||document.querySelector(`a[name="${CSS.escape(t)}"]`);if(r){const{length:t}=e.slides;for(let o=0;o<t;o+=1)if(e.slides[o].contains(r)){const t=e.fragments?.[o],a=r.closest("[data-marpit-fragment]");if(t&&a){const e=t.indexOf(a);e>=0&&(n=e)}return o}}}return 0})(),n)};e.on("fragment",({index:e,fragmentIndex:r})=>{n||v({f:0===r||r.toString()},{location:{...location,hash:`#${e+1}`},setter:(...e)=>t.history?history.pushState(...e):history.replaceState(...e)})}),setTimeout(()=>{o(),window.addEventListener("hashchange",()=>r(()=>{o({fragment:!1}),v({f:void 0})})),window.addEventListener("popstate",()=>{n||r(()=>o())}),n=!1},0)}},re=(e={})=>{const t=e.key||window.history.state?.marpBespokeSyncKey||Math.random().toString(36).slice(2),n=`bespoke-marp-sync-${t}`;var r;r={marpBespokeSyncKey:t},v({},{setter:(e,...t)=>i({...e,...r},...t)});const o=()=>{const e=y(n);return e?JSON.parse(e):Object.create(null)},a=e=>{const t=o(),r={...t,...e(t)};return b(n,JSON.stringify(r)),r},s=()=>{window.removeEventListener("pageshow",s),a(e=>({reference:(e.reference||0)+1}))};return e=>{s(),Object.defineProperty(e,"syncKey",{value:t,enumerable:!0});let r=!0;setTimeout(()=>{e.on("fragment",e=>{r&&a(()=>({index:e.index,fragmentIndex:e.fragmentIndex}))})},0),window.addEventListener("storage",t=>{if(t.key===n&&t.oldValue&&t.newValue){const n=JSON.parse(t.oldValue),o=JSON.parse(t.newValue);if(n.index!==o.index||n.fragmentIndex!==o.fragmentIndex)try{r=!1,e.slide(o.index,{fragment:o.fragmentIndex,forSync:!0})}finally{r=!0}}});const i=()=>{const{reference:e}=o();void 0===e||e<=1?w(n):a(()=>({reference:e-1}))};window.addEventListener("pagehide",e=>{e.persisted&&window.addEventListener("pageshow",s),i()}),e.on("destroy",i)}},{PI:oe,abs:ae,sqrt:ie,atan2:se}=Math,ce={passive:!0},le=({slope:e=-.7,swipeThreshold:t=30}={})=>n=>{let r;const o=n.parent,a=e=>{const t=o.getBoundingClientRect();return{x:e.pageX-(t.left+t.right)/2,y:e.pageY-(t.top+t.bottom)/2}};o.addEventListener("touchstart",({touches:e})=>{r=1===e.length?a(e[0]):void 0},ce),o.addEventListener("touchmove",e=>{if(r)if(1===e.touches.length){e.preventDefault();const t=a(e.touches[0]),n=t.x-r.x,o=t.y-r.y;r.delta=ie(ae(n)**2+ae(o)**2),r.radian=se(n,o)}else r=void 0}),o.addEventListener("touchend",o=>{if(r){if(r.delta&&r.delta>=t&&r.radian){const t=(r.radian-e+oe)%(2*oe)-oe;n[t<0?"next":"prev"](),o.stopPropagation()}r=void 0}},ce)},de=new Map;de.clear(),de.set("none",{backward:{both:void 0,incoming:void 0,outgoing:void 0},forward:{both:void 0,incoming:void 0,outgoing:void 0}});const ue={both:"",outgoing:"outgoing-",incoming:"incoming-"},fe={forward:"",backward:"-backward"},me=e=>`--marp-bespoke-transition-animation-${e}`,ge=e=>`--marp-transition-${e}`,pe=me("name"),ve=me("duration"),he=e=>new Promise(t=>{const n={},r=document.createElement("div"),o=e=>{r.remove(),t(e)};r.addEventListener("animationstart",()=>o(n)),Object.assign(r.style,{animationName:e,animationDuration:"1s",animationFillMode:"both",animationPlayState:"paused",position:"absolute",pointerEvents:"none"}),document.body.appendChild(r);const a=getComputedStyle(r).getPropertyValue(ge("duration"));a&&Number.parseFloat(a)>=0&&(n.defaultDuration=a),((e,t)=>{requestAnimationFrame(()=>{e.style.animationPlayState="running",requestAnimationFrame(()=>t(void 0))})})(r,o)}),ye=async e=>de.has(e)?de.get(e):(e=>{const t={},n=[];for(const[r,o]of Object.entries(ue))for(const[a,i]of Object.entries(fe)){const s=`marp-${o}transition${i}-${e}`;n.push(he(s).then(e=>{t[a]=t[a]||{},t[a][r]=e?{...e,name:s}:void 0}))}return Promise.all(n).then(()=>t)})(e).then(t=>(de.set(e,t),t)),be=e=>Object.values(e).flatMap(Object.values).every(e=>!e),we=(e,{type:t,backward:n})=>{const r=e[n?"backward":"forward"],o=(()=>{const e=r[t],n=e=>({[pe]:e.name});if(e)return n(e);if(r.both){const e=n(r.both);return"incoming"===t&&(e[me("direction")]="reverse"),e}})();return!o&&n?we(e,{type:t,backward:!1}):o||{[pe]:"__bespoke_marp_transition_no_animation__"}},xe=e=>{if(e)try{const t=JSON.parse(e);if((e=>{if("object"!=typeof e)return!1;const t=e;return"string"==typeof t.name&&(void 0===t.duration||"string"==typeof t.duration)})(t))return t}catch{}},ke="_tSId",$e="_tA",Ee="bespoke-marp-transition-warming-up",Le=window.matchMedia("(prefers-reduced-motion: reduce)"),Se="__bespoke_marp_transition_reduced_outgoing__",Pe="__bespoke_marp_transition_reduced_incoming__",_e={forward:{both:void 0,incoming:{name:Pe},outgoing:{name:Se}},backward:{both:void 0,incoming:{name:Pe},outgoing:{name:Se}}},Te=e=>{if(!document.startViewTransition)return;const t=t=>(void 0!==t&&(e._tD=t),e._tD);let n;t(!1),((...e)=>{CSS.registerProperty({name:ge("duration"),syntax:"<time>",inherits:!0,initialValue:"-1s"});const t=[...new Set(e).values()];return Promise.all(t.map(e=>ye(e))).then()})(...Array.from(document.querySelectorAll("section[data-transition], section[data-transition-back]")).flatMap(e=>[e.dataset.transition,e.dataset.transitionBack].flatMap(e=>{const t=xe(e);return[t?.name,t?.builtinFallback?`__builtin__${t.name}`:void 0]}).filter(e=>!!e))).then(()=>{document.querySelectorAll("style").forEach(e=>{e.innerHTML=e.innerHTML.replace(/--marp-transition-duration:[^;}]*[;}]/g,e=>e.slice(0,-1)+"!important"+e.slice(-1))})});const r=(n,{back:r,cond:o})=>a=>{const i=t();if(i)return!!a[$e]||!("object"!=typeof i||(i.skipTransition(),!a.forSync));if(!o(a))return!0;const s=e.slides[e.slide()],c=()=>a.back??r,l="data-transition"+(c()?"-back":""),d=s.querySelector(`section[${l}]`);if(!d)return!0;const u=xe(d.getAttribute(l)??void 0);return!u||((async(e,{builtinFallback:t=!0}={})=>{let n=await ye(e);if(be(n)){if(!t)return;return n=await ye(`__builtin__${e}`),be(n)?void 0:n}return n})(u.name,{builtinFallback:u.builtinFallback}).then(e=>{if(!e){t(!0);try{n(a)}finally{t(!1)}return}let r=e;Le.matches&&(console.warn("Use a constant animation to transition because preferring reduced motion by viewer has detected."),r=_e);const o=document.getElementById(ke);o&&o.remove();const i=document.createElement("style");i.id=ke,document.head.appendChild(i),((e,t)=>{const n=[`:root{${ge("direction")}:${t.backward?-1:1};}`,":root:has(.bespoke-marp-inactive){cursor:none;}"],r=t=>{const n=e[t].both?.defaultDuration||e[t].outgoing?.defaultDuration||e[t].incoming?.defaultDuration;return"forward"===t?n:n||r("forward")},o=t.duration||r(t.backward?"backward":"forward");void 0!==o&&n.push(`::view-transition-group(*){${ve}:${o};}`);const a=e=>Object.entries(e).map(([e,t])=>`${e}:${t};`).join("");return n.push(`::view-transition-old(root){${a(we(e,{...t,type:"outgoing"}))}}`,`::view-transition-new(root){${a(we(e,{...t,type:"incoming"}))}}`),n})(r,{backward:c(),duration:u.duration}).forEach(e=>i.sheet?.insertRule(e));const s=document.documentElement.classList;s.add(Ee);let l=!1;const d=()=>{l||(n(a),l=!0,s.remove(Ee))},f=()=>{t(!1),i.remove(),s.remove(Ee)};try{t(!0);const e=document.startViewTransition(d);t(e),e.finished.finally(f)}catch(e){console.error(e),d(),f()}}),!1)};e.on("prev",r(t=>e.prev({...t,[$e]:!0}),{back:!0,cond:e=>e.index>0&&!((e.fragment??1)&&n.fragmentIndex>0)})),e.on("next",r(t=>e.next({...t,[$e]:!0}),{cond:t=>t.index+1<e.slides.length&&!(n.fragmentIndex+1<n.fragments.length)})),setTimeout(()=>{e.on("slide",r(t=>e.slide(t.index,{...t,[$e]:!0}),{cond:t=>{const n=e.slide();return t.index!==n&&(t.back=t.index<n,!0)}}))},0),e.on("fragment",e=>{n=e})};let Ie;const Me=()=>(void 0===Ie&&(Ie="wakeLock"in navigator&&navigator.wakeLock),Ie),Oe=async()=>{const e=Me();if(e)try{return await e.request("screen")}catch(e){console.warn(e)}return null},Ae=async()=>{if(!Me())return;let e;const t=()=>{e&&"visible"===document.visibilityState&&Oe()};for(const e of["visibilitychange","fullscreenchange"])document.addEventListener(e,t);return e=await Oe(),e};((e=document.getElementById(":$p"))=>{(()=>{const e=p("view");a.dataset.bespokeView=e===l||e===c?e:""})();const t=(e=>{const t=p(e);return v({[e]:void 0}),t})("sync")||void 0;o.from(e,((...e)=>{const t=d.findIndex(e=>g()===e);return e.map(([e,n])=>e[t]&&n).filter(e=>e)})([[1,1,0],re({key:t})],[[1,1,1],Z(e)],[[1,1,0],M],[[1,1,1],k],[[1,0,0],T()],[[1,1,1],O],[[1,1,1],ne({history:!1})],[[1,1,0],A()],[[1,1,0],P],[[1,0,0],ee],[[1,1,0],le()],[[1,0,0],C()],[[1,0,0],Te],[[1,1,1],$],[[1,1,0],Ae]))})()}();</script></body></html>